---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Support

## Summary

## Recon

Let's start, as always, with a [port scan](../../../tools/tools/port-scanners/nmap.md#nmap-flow) (Figure 1).

```bash
nmap-scan.sh 10.10.11.174
Creating directory...
Performing initial scan...
Extracting ports...
Performing an aggresive scan on open ports...
All done! See results: less scans/aggressive_scan.nmap
```

<figure><img src="../../../.gitbook/assets/support_nmap.png" alt=""><figcaption><p>Figure 1: Services listening on the Support machine.</p></figcaption></figure>

Let's note some things down based on the Nmap's output:

1. The yellow-highlighted ports inform us that we are dealing with a DC[^1].
2. The FQDN[^2] of the machine is `DC.SUPPORT.HTB`. The hostname (`DC`) also confirms our first point!

Before moving on enumerating the services, we should add the hostname (`dc`), the domain (`support.htb`), and the FQDN (`dc.support.htb`) to our local DNS file.

```bash
grep support /etc/hosts
10.10.11.174    dc support.htb dc.support.htb
```

### SMB

The SMB server allows to query a lot of information via a guest session, such as shares (Figure 1) and usernames (Figure 2).

```bash
# enumerating SMB shares
nxc smb 10.10.11.174 -u 'guest' -p '' --shares
# enumerating domain users
nxc smb 10.10.11.174 -u 'guest' -p '' --rid-brute
```

<figure><img src="../../../.gitbook/assets/support_shares.png" alt=""><figcaption><p>Figure 1: Enumerating SMB shares.</p></figcaption></figure>

<figure><img src="../../../.gitbook/assets/support_users.png" alt=""><figcaption><p>Figure 2: Enumerating users via RID brute-forcing.</p></figcaption></figure>

There is only one non-default share (`support-tools`) which we have `READ` access. Let's first create a username list to have handy for a potential ASREPRoasting and/or password spraying attack, and then start poking within the share (Figure 3),

```bash
# converting netexec's output to a username list
cat nxc_users | awk '{print $6}' | awk -F'\' 'NR>3 {print $2}' | uniq > dom_users
# spidering the share
nxc smb 10.10.11.174 -u 'guest' -p '' --spider support-tools --regex . --depth 2
```

<figure><img src="../../../.gitbook/assets/support_spider.png" alt=""><figcaption><p>Figure 3: Spidering the <code>support-tools</code> share.</p></figcaption></figure>

This share contains 4 executable and 3 compressed files; we will download all of them, so we can examine them locally (Figure 4).

{% code overflow="wrap" %}
```bash
nxc smb 10.10.11.174 -u guest -p '' -M spider_plus -o DOWNLOAD_FLAG=True MAX_FILE_SIZE=45000000 OUTPUT_FOLDER=./
```
{% endcode %}

<figure><img src="../../../.gitbook/assets/support_share_dl.png" alt=""><figcaption><p>Figure 4: Downloading the <code>support-tools</code> share.</p></figcaption></figure>



[^1]: Domain Controller

[^2]: Fully Qualified Domain Name
