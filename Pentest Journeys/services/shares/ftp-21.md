# 21 - FTP

## Usage

FTP operates in **two modes for data transfer**:&#x20;

* In active mode, the client opens a port and listens while the server connects back to the client to transfer data.&#x20;
* In passive mode, the server opens a port and the client initiates the connection, which helps navigate firewalls or NAT restrictions more easily.

FTP also supports **two data transfer types**:

* Binary mode transfers files byte-for-byte, preserving exact file contents, which is essential for non-text files like images or executables.
* ASCII mode converts line endings and text formatting to match the target system, suitable for plain text files but potentially corrupting binary data.

{% tabs %}
{% tab title="Connect" %}
```bash
# Connect to FTP server
ftp <target>

# No auto login (useful for scripts)
ftp -n <targetp> 

# Verbose mode         
ftp -v <target>          

# Log in as a specific user
ftp <user>@<target>
```
{% endtab %}

{% tab title="Banner Grabbing" %}
```bash
telnet <target> 21
nc <target> 21
```
{% endtab %}

{% tab title="Basic Commands" %}
```bash
# List all (including hidden) files
ls -a
dir -a                   

# Change directory
cd <directory>              

# Change local directory
lcd <local_directory>                      

# Delete file
delete <file>               

# Create directory
mkdir <directory>           

# Remove directory
rmdir <directory>           

# Show remote current directory
pwd                         

# Disconnect
bye / quit / exit           
```
{% endtab %}

{% tab title="Enumeration" %}
```bash
# Get OS type
quote SYST

# Check for passive mode
quote PASV                  

# List server supported commands
quote HELP                  

# Server status
quote STAT                  

# List server features
quote FEAT                  

# Site-specific commands
quote SITE HELP             
```
{% endtab %}

{% tab title="Transfer" %}
```bash
# Download file
get <file>                  

# Download multiple files
mget <files>                

# Upload file
put <file>                  

# Upload multiple files
mput <files> 

# Download an FTP directory
wget -r ftp://username:password@<target-ip></directory/>
```
{% endtab %}
{% endtabs %}

## Attacks

{% tabs %}
{% tab title="Anon" %}
Sometimes are configured to accept passwordless anonymous and/or default logins:

```bash
ftp ftp@<server-ip>
ftp anonymous@<server-ip>
```
{% endtab %}

{% tab title="BFA" %}
```bash
# Using hydra
hydra -l <user> -P <passlist> ftp://<target> 

# Using medusa
medusa -h <target> -u <user> -P <passlist> -M ftp

# Using nmap 
nmap -p 21 --script ftp-brute <target>
```
{% endtab %}

{% tab title="Vulnerability Recon" %}
{% code overflow="wrap" %}
```bash
nmap -p 21 --script ftp-anon,ftp-bounce,ftp-vsftpd-backdoor,ftp-proftpd-backdoor <target>
```
{% endcode %}
{% endtab %}

{% tab title="File Exfil" %}
```bash
# File exfiltration / upload with command-line FTP
echo "open <target>" > script.txt
echo "user anonymous anonymous" >> script.txt
echo "binary" >> script.txt
echo "get secret.txt" >> script.txt
echo "bye" >> script.txt
ftp -n -s:script.txt
```
{% endtab %}
{% endtabs %}
