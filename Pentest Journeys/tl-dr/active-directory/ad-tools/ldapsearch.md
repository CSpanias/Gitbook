# LDAPsearch

[Ldapsearch](https://bmaupin.github.io/wiki/applications/misc/ldapsearch.html) is a command-line utility that queries Lightweight Directory Access Protocol (LDAP) directories, including those used in Active Directory environments. It allows retrieval of information such as users, groups, organizational units, and schema details. For adversary simulation, ldapsearch is often used to enumerate directory contents without requiring privileged access, making it an effective tool for reconnaissance and information gathering prior to privilege escalation or lateral movement.

## Usage

{% tabs %}
{% tab title="Naming Contexts" %}
```bash
ldapsearch -x -H ldap://test.domain.com -s base namingcontexts
```
{% endtab %}

{% tab title="Dump Base" %}
```bash
ldapsearch -x -H ldap://test.domain.com -s sub -b 'DC=HTB,DC=LOCAL'
```
{% endtab %}

{% tab title="Simple Auth" %}
{% code overflow="wrap" %}
```bash
ldapsearch -x -b 'cn=Users,dc=support,dc=htb' -H ldap://10.10.11.174 -D support\\ldap -w '<pass>'
```
{% endcode %}
{% endtab %}

{% tab title="Users" %}
Domain users can be enumerated as follows:

{% code overflow="wrap" %}
```bash
ldapsearch -x -h 192.168.45.122 -D '' -w '' -b "DC=x7331,DC=local" | grep sAMAccountName:

ldapsearch -v -x -b "DC=x7331,DC=local" -H "ldap://192.168.45.108" "(objectclass=*)"
```
{% endcode %}
{% endtab %}

{% tab title="LAPS" %}
{% code overflow="wrap" %}
```bash
ldapsearch -v -x -D x7331@domain.local -w Pass123! -b "DC=x7331,DC=local" -h 192.168.45.108 "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Analysis

{% tabs %}
{% tab title="Anomalies" %}
```bash
cat ldapsearch_output | awk '{print $1}' | sort | uniq -c | sort -n | grep ':'
```
{% endtab %}
{% endtabs %}
