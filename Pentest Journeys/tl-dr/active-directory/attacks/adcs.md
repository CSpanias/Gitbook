---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# ADCS

**Active Directory Certificate Services (ADCS)** is like an internal digital ID system for a Windows domain. Instead of printing physical ID cards, it **issues digital certificates** **that users and computers can use to log in**, encrypt communications, or sign data. These certificates are trusted across the domain, so if an attacker can trick ADCS into giving them a certificate, it's similar to getting a valid employee badge — they can **impersonate someone else** and gain access.

The terms **ESC1**, **ESC4**, etc., come from a **threat model and classification system** introduced by SpecterOps. These labels don’t stand for acronyms — **ESC** simply means **ESCalation** — and they’re followed by a number to identify different types of attack paths related to ADCS.

<table><thead><tr><th width="79.6666259765625">Label</th><th width="375.3333740234375">Description</th><th>Key Risk</th></tr></thead><tbody><tr><td><strong>ESC1</strong></td><td>Weak template allows users to request certs for others (incl. admins)</td><td>Identity impersonation</td></tr><tr><td><strong>ESC4</strong></td><td>Control over Cert Publisher user lets attacker modify templates</td><td>Template abuse (e.g., leads to ESC1)</td></tr></tbody></table>

## ESC4

**ESC4** is a misconfiguration where a low-privileged user has control over another user account (e.g., via `WriteOwner`), and that account is a member of the `Cert Publishers` group. Members of this group can manage certificate templates — the blueprints that define how certificates are issued and who can request them. This leads to ESC1, an identity impersonation attack.

## ESC1

With control over a `Cert Publishers` member, an attacker can modify a certificate template to make it vulnerable to ESC1. This involves weakening the template’s security settings so it allows certificate requests without validating the requester's identity, permits client authentication, and skips approval checks — essentially creating a backdoor.

Once the template is misconfigured, the attacker can request a certificate for a high-privileged user such as a `Domain Admin`. Since the template doesn’t enforce proper validation, ADCS issues a valid certificate for that account. The attacker can then use the certificate to authenticate as the admin, extract sensitive credentials (like NTLM hashes), and escalate privileges — gaining full control of the domain.

This attack path (ESC4 → ESC1) is particularly dangerous because it **abuses legitimate Windows features**, making it hard to detect. Certificates can also remain valid for years, offering **persistent access** unless specifically revoked. For an example of this attack chain see [EscapeTwo](https://x7331.gitbook.io/boxes/boxes/easy/escapetwo#privilege-escalation).

## Resources

* SpecterOps _Certified Pre-Owned (2021)_ whitepaper ([article](https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf))
* RBT's in depth article and video walkthrough about the ESC4 attack ([article](https://www.rbtsec.com/blog/active-directory-certificate-services-adcs-esc4/))
