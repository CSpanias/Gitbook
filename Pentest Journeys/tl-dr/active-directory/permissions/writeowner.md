---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# WriteOwner

## Information

This permission has the ability to modify the owner of the user, i.e, give the [`Owns`](owns.md) permission, which can then being used to modify object security descriptors, regardless of permissions on the object's DACL.

## Shadow Credentials

The **Shadow Credentials** attack abuses the `msDS-KeyCredentialLink` attribute in AD to add a malicious authentication certificate to an account ‚Äî typically a service or privileged account. This allows the attacker to **impersonate** the target account via certificate-based authentication (PKINIT), **without needing their password or hash**.

```bash
certipy shadow auto -u <user@domain> -p <pass> -account 'ca_svc' -dc-ip <dc-ip>
```

#### üß™ **What does `certipy shadow auto` do?**

The `auto` mode simplifies the attack by:

1. Authenticating with the specified credentials.
2. Injecting a certificate credential into the target account.
3. Modifying the `msDS-KeyCredentialLink` attribute of the target account.
4. Requesting a certificate for the attacker that is tied to the target account.
5. Generating **`.ccache`** and **`.pfx`** files that allow the attacker to authenticate as the target account.

#### ‚ö†Ô∏è Requirements for Success:

* The attacker **must have write access** to the target's `msDS-KeyCredentialLink` attribute.
* ADCS must be configured to allow **certificate-based authentication (PKINIT)**.

#### ‚úÖ What You Get:

* A `.ccache` file: usable with tools like `impacket` to impersonate the target account.
* A `.pfx` file: contains the cert and private key.
* Access to the target account **without knowing its password or hash**.

## ?

{% code overflow="wrap" %}
```powershell
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\\dfm.a', $SecPassword)
# Set the ownership of the target object with PowerView
Set-DomainObjectOwner -Credential $Cred -TargetIdentity "Domain Admins" -OwnerIdentity harmj0y
```
{% endcode %}

For subsequent exploitation steps check [`WriteDACL`](writedacl.md).
