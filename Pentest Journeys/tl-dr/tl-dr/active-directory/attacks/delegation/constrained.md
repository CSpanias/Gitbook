---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Constrained

{% hint style="info" %}
All information found below has been adapted from [Attl4s](https://attl4s.github.io/) [video-presentation](https://www.youtube.com/watch?v=gzqq2r6cZjc) and its corresponding [slide deck](https://attl4s.github.io/assets/pdf/You\_do\_\(not\)\_Understand\_Kerberos\_Delegation.pdf).
{% endhint %}

## Theory

Constrained delegation does not leverage TGTs, and thus, cannot impersonate a user freely on any service (`msds-allowedtodelegateto`). Instead, it uses the `S4U2Self` and `S4U2Proxy` Keberos extensions.

### S4U2Proxy

Allow a service to obtain a ST on behalf of a client to another service. The initial client ST is required as evidence that the client has authenticated.

<figure><img src="../../../../../.gitbook/assets/cd_wireshark.png" alt=""><figcaption><p>Figure 1: <code>S4U2Proxy</code> process (<em>image taken from</em><a href="https://attl4s.github.io/assets/pdf/You_do_(not)_Understand_Kerberos_Delegation.pdf"> <em>here</em></a><em>)</em>.</p></figcaption></figure>

### Exploitation

This process requires only a ST (evidence/additional) as a requirement to invoke it.

### S4U2Self

Allows a service to obtain a ST to itself as evidence that a client has authenticated. Any services (SPN account) can invoke `S4U2Self`.
