---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# MFA

## Simple 2FA Bypass <a href="#simple-2fa-bypass" id="simple-2fa-bypass"></a>

> _The example below is based on PostSwigger's_ [_2FA simple bypass_](https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-simple-bypass) _lab._

We first need to login in as a normal user and understand how the 2FA process works (Figure 1).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_1.png" alt=""><figcaption><p>Figure 1: Using the application as intended and understanding its behaviour.</p></figcaption></figure>

We can also inspect what's happening behind the scene during this 2FA process (Figure 2).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_2.avif" alt=""><figcaption><p>Figure 2: Intercepting the traffic of the 2FA process.</p></figcaption></figure>

It seems that each authentication step issues a different session cookie (Figure 2). There is a chance that we can use either of the two cookies to access the user's account. If this is the case, it means that the second authentication step is redundant and can be skipped altogether.&#x20;

We can test this by logging in as `carlos` and intercept the traffic, get the first session cookie, and then use it to access his account (Figure 3).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_3.avif" alt=""><figcaption><p>Figure 3: Bypassing the second authentication step &#x26; accessing <code>carlos</code>'s account.</p></figcaption></figure>

## Broken 2FA logic <a href="#broken-2fa-logic" id="broken-2fa-logic"></a>

> _The example below is based on PostSwigger's_ [_2FA broken logic_](https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-broken-logic) _lab._

As before, the first thing we need to do, is to try and understand how the authentication process works (Figure 4 & 5).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_4.avif" alt=""><figcaption><p>Figure 4: Logging in as <code>wiener</code> and inspecting how the first part of the authentication process works.</p></figcaption></figure>

<figure><img src="../../../.gitbook/assets/web_auth_mfa_5.png" alt=""><figcaption><p>Figure 5: Logging in as <code>wiener</code> and inspecting how the second part of the authentication process works.</p></figcaption></figure>

We can tamper with the cookie generated for use in the second step of the authentication process, and essentially create a valid session cookie tied in the account `carlos` (Figure 6).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_6.png" alt=""><figcaption><p>Figure 6: Creating a valid session cookie tied to <code>carlos</code>.</p></figcaption></figure>

Next, we can use this cookie to brute-force `carlos` code for the second step of the authentication process (Figure 7).

<figure><img src="../../../.gitbook/assets/web_auth_mfa_7.avif" alt=""><figcaption><p>Figure 7: Brute-forcing <code>carlos</code>'s 4-digit code.</p></figcaption></figure>

Finally, we can use this cookie and impersonate `carlos` (Figure 8).

> _The final cookie changed from Figure 7 to Figure 8 due to a lab reset._

<figure><img src="../../../.gitbook/assets/web_auth_mfa_8.png" alt=""><figcaption><p>Figure 8: Impersonating user <code>carlos</code>.</p></figcaption></figure>
