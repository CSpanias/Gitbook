---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# John

## Common Formats

| Type             | Mode        |
| ---------------- | ----------- |
| `$krb5asrep$23$` | `krb5asrep` |
| `$krb5tgs$23$`   | `krb5tgs`   |
| `NTLMv2`         | `netntlmv2` |
| `NTLM`           | `netntlm`   |

## Usage

{% tabs %}
{% tab title="Usage" %}
{% code overflow="wrap" %}
```bash
john --format=<FORMAT> --wordlist=/usr/share/wordlists/rockyou.txt --fork=4 hash
```
{% endcode %}
{% endtab %}

{% tab title="Formats" %}
```bash
john --list=formats | grep <FORMAT>
```
{% endtab %}

{% tab title="Show" %}
```bash
john --show passwd.txt
```
{% endtab %}
{% endtabs %}

## Files

### zip

```bash
# convert zip file
zip2john <file.zip> > zip.hash
# crack password
john --wordlist=rockyou.txt zip.hash
# show
john zip.hash --show
# unzip the file
unzip <file.zip>
```

We can also use [`fcrackzip`](https://github.com/foreni-packages/fcrackzip)(deprecated):

```bash
# verbose, unzip, Dictionary, file
$ fcrackzip -v -u -D -p /usr/share/wordlists/rockyou save.zip
```

### pfx (File Certificate)

```bash
# converting file to a format suitable for john
pfx2john legacyy_dev_auth.pfx > pfx_hash
# cracking the hash
john pfx_hash --wordlist=/usr/share/wordlists/rockyou
```

The extraction and decryption process from a `.pfx` file can be found [here](https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file). The PEM pass phrase is set by us and later used to decrypt the key. It can be anything as long as it is > than 3 characters.

{% code overflow="wrap" %}
```bash
# extracting the key and setting a PEM pass phrase
openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key-enc
Enter Import Password:
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
# decrypting the key using the PEM pass phrase we set above
openssl rsa -in legacyy_dev_auth.key-enc -out legacyy_dev_auth.key
Enter pass phrase for legacyy_dev_auth.key-enc:
writing RSA key
# extracting the certificate
openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacyy_dev_auth.crt
Enter Import Password:
# checking the everything is there
ls legacyy_dev_auth.*
legacyy_dev_auth.crt  legacyy_dev_auth.key  legacyy_dev_auth.key-enc  legacyy_dev_auth.pfx
```
{% endcode %}

The `.crt` and `.key` files can be used to access a Windows host via WinRM.

```bash
evil-winrm -i 10.10.11.152 -S -k legacyy_dev_auth.key -c legacyy_dev_auth.crt
```

### kdbx (KeePass)

The KeePass databases are stored in `.kdbx` files.

{% tabs %}
{% tab title="1. Convertion" %}
```bash
keepass2john Database.kdbx > keepass.hash
```
{% endtab %}

{% tab title="2. Inspect & Format" %}
{% code overflow="wrap" %}
```bash
$ cat keepass.hash
Database:$keepass$*2*60*0*d74e29a727e9338717d27a7d457ba3486d20dec73a9db1a7fbc7a068c9aec6bd*04b0bfd787898d8dcd4d463ee768e55337ff001ddfac98c961219d942fb0cfba*5273cc73b9584fbd843d1ee309d2ba47*1dcad0a3e50f684510c5ab14e1eecbb63671acae14a77eff9aa319b63d71ddb9*17c3ebc9c4c3535689cb9cb501284203b7c66b0ae2fbf0c2763ee920277496c1

# removing the username "Database"
$ nano keepass.hash
$ cat keepass.hash
$keepass$*2*60*0*d74e29a727e9338717d27a7d457ba3486d20dec73a9db1a7fbc7a068c9aec6bd*04b0bfd787898d8dcd4d463ee768e55337ff001ddfac98c961219d942fb0cfba*5273cc73b9584fbd843d1ee309d2ba47*1dcad0a3e50f684510c5ab14e1eecbb63671acae14a77eff9aa319b63d71ddb9*17c3ebc9c4c3535689cb9cb501284203b7c66b0ae2fbf0c2763ee920277496c1
```
{% endcode %}
{% endtab %}

{% tab title="3. Crack" %}
{% code overflow="wrap" %}
```bash
$ hashcat --help | grep -i 'KeePass'
13400 | KeePass 1 (AES/Twofish) and KeePass 2 (AES) | Password Manager

$ hashcat -m13400 keepass.hash /usr/share/wordlists/rockyou.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Resources

{% tabs %}
{% tab title="GitHub" %}
{% embed url="https://github.com/openwall/john" %}
{% endtab %}

{% tab title="GUI" %}
{% embed url="https://openwall.info/wiki/john/johnny" %}
{% endtab %}
{% endtabs %}
