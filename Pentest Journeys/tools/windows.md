---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Windows

> _For automated enumeration scripts like `winPEAS`, `seatbelt`, and `jaws` can be used._

## Situational Awareness

{% code overflow="wrap" %}
```powershell
# username and hostname
> whoami
clientwk220\dave # can be used to infer the purpose and type of the machine

# group memberships of the current user
> whoami /groups

# existing users
> net user
> Get-LocalUser

# existing groups
> net localgroup
> Get-LocalGroup

# group members
> net localgroup <group-name>
> Get-LocalGroupMember <group-name>

# operating system, version and architecture
> systeminfo

# network information
> ipconfig /all
> route print
# all active TCP connections,disable name resolution,show the process ID
> netstat -ano

# installed applications (registry key queries)
# 32-bit apps
> Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
> GCI 'c:\program files (x86)'
# 64-bit apps
> Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname
> GCI 'c:\program files'

# running processes
> Get-Process
# details about a specific process
> Get-Process -Name <process-name> | Format-list *

# Clipboard
Get-Clipboard
```
{% endcode %}

## File Enumeration

{% code overflow="wrap" %}
```powershell
# Keys, hidden folders
GCI C:\Users\User -Force # All dirs and files
GCI C:\Users\User\ -Hidden # Only hidden files

# Config files, temp saves
GCI C:\Users\User\AppData

# searching for KeePass database files
> Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue

# searching for XAMPP configuration files
> Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue

# searching for documents in dave's home directory
> Get-ChildItem -Path C:\Users\dave\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
```
{% endcode %}

## Whitelisted and writable directories.

{% tabs %}
{% tab title="1. Dirs" %}
{% code overflow="wrap" %}
```powershell
C:\Windows\System32\spool\drivers\color
C:\Windows\Tasks
# similar to \Temp but more stealthy
C:\Users\Public
# all users have rwx
C:\Windows\Temp
# similar to above, but user-only
C:\Users\<user>\AppData\Local\Temp
C:\windows\tracing
C:\Windows\Registration\CRMLog
C:\Windows\System32\FxsTmp
C:\Windows\System32\com\dmp
C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys
C:\Windows\System32\spool\PRINTERS
C:\Windows\System32\spool\SERVERS
C:\Windows\System32\Tasks\Microsoft\Windows\SyncCenter
C:\Windows\System32\Tasks_Migrated
C:\Windows\SysWOW64\FxsTmp
C:\Windows\SysWOW64\com\dmp
C:\Windows\SysWOW64\Tasks\Microsoft\Windows\SyncCenter
C:\Windows\SysWOW64\Tasks\Microsoft\Windows\PLA\System
```
{% endcode %}
{% endtab %}

{% tab title="2. Test" %}
```powershell
# create a file
echo test > test
# delete the file
del test
```
{% endtab %}
{% endtabs %}

## PowerShell

By default, Windows logs minimal PS activity. However, two key logging mechanisms can be enabled:

1. **PowerShell Transcription** – Logs everything a user types, like an "over-the-shoulder" view. Saved as transcript files in user directories or network shares.
2. **Script Block Logging** – Records executed commands and script blocks as events, including decoded versions of encoded scripts.

> _`Clear-History` does not clear the command history recorded by `PSReadline`._

{% code overflow="wrap" %}
```powershell
# get powershell history
> Get-History

# PSReadline history's file path
> (Get-PSReadlineOption).HistorySavePath

# History files
GC C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline\ConsoleHost_history.txt
```
{% endcode %}

> _Administrators can prevent PSReadline from recording commands by setting the `-HistorySaveStyle` option to `SaveNothing` with the `Set-PSReadlineOption` Cmdlet. Alternatively, they can clear the history file manually._

To find **Script Block Logging events** on Event Viewer:

1. Press **`Win + R`**, type **`eventvwr.msc`**, and press **Enter**.
2. In the left panel, go to: _Applications and Services Logs_ > _Microsoft_ > _Windows_ > _PowerShell_ > _Operational_.
3. Click _Filter Current Log_ (on the right panel), in the _Event IDs_ field enter: `4104`, and click _OK_.
4. On the right panel click _Find_ and search for interesting keywords, such as `pass`, `key`, `secret` etc.
5. Open relevant events and check the _Details_ tab for logged script content.

If searching manually isn’t effective, export the logs and analyze them with PowerShell:

{% code overflow="wrap" %}
```powershell
powershellCopyEditGet-WinEvent -LogName "Microsoft-Windows-PowerShell/Operational" | Where-Object { $_.Message -match "password" }
```
{% endcode %}

## Use another user's credentials

{% code overflow="wrap" %}
```powershell
$user_pass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
$user_creds = New-Object System.Management.Automation.PSCredential('<DOMAIN\user', $user_pass)
# adding a member to a group
Add-DomainGroupMember -Identity '<GROUP>' -Members '<USER>' -Credential $user_creds -verbose
```
{% endcode %}

## Permissions

```powershell
# check permissions
icacls c:\windows\myfolder
# grant full permissions
icacls c:\windows\myfolder /grant <USER>:f
# remove permissions
icacls c:\users /remove <USER>
```

## Binaries

`strings` with 16-bit encoding for Windows binaries.

```bash
strings -eb <FILE> | grep pass
```
